(self.webpackChunkclicker=self.webpackChunkclicker||[]).push([[6871],{6871:(e,s,a)=>{"use strict";a.r(s),a.d(s,{MessagePageModule:()=>b});var t=a(8583),i=a(665),o=a(2859),l=a(9493),c=a(8002),n=a(7716),d=a(9829),r=a(3946),g=a(2482),h=a(6274);function _(e,s){if(1&e&&(n.TgZ(0,"ion-card"),n.TgZ(1,"ion-card-header",7),n.TgZ(2,"ion-card-subtitle",8),n._uU(3),n.ALo(4,"date"),n.qZA(),n.TgZ(5,"p",9),n._uU(6),n.qZA(),n.TgZ(7,"p"),n._uU(8),n.qZA(),n.qZA(),n.qZA()),2&e){const e=s.$implicit;n.xp6(3),n.Oqu(n.xi3(4,3,1e3*e.mail_data,"HH:mm:ss")),n.xp6(3),n.Oqu(e.mail_user_name),n.xp6(2),n.Oqu(e.mail_text)}}function u(e,s){if(1&e){const e=n.EpF();n.TgZ(0,"div"),n.TgZ(1,"ion-button",10),n.NdJ("click",function(){return n.CHM(e),n.oxw().add_message_to_dialog()}),n._UZ(2,"ion-icon",11),n._uU(3," \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0432 \u043b\u0441 "),n.qZA(),n.qZA()}}function m(e,s){if(1&e){const e=n.EpF();n.TgZ(0,"div"),n.TgZ(1,"ion-button",10),n.NdJ("click",function(){return n.CHM(e),n.oxw().add_message_to_chat()}),n._UZ(2,"ion-icon",11),n._uU(3," \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0432 \u0447\u0430\u0442 "),n.qZA(),n.qZA()}}const p=[{path:"",component:(()=>{class e{constructor(e,s,a,t,i,o,l,c){this.route=e,this.firebaseAuth=s,this.activatedRoute=a,this.afs=t,this.ideaService=i,this.geocoderService=o,this.toastCtrl=l,this.router=c,this.idea={login:"",name:"",notes:"",DateTime:"",user:"",uid:"",address:"",coordinates:"",team:[]},this.checkbox=!1}ngOnInit(){this.route.queryParams.subscribe(e=>{this.param1=e.uid,this.dialog_chat_id=e.id_dialog,null!=this.param1?this.checkbox=!0:null!=this.dialog_chat_id&&(this.checkbox=!1),console.log(this.param1),console.log(this.dialog_chat_id),this.firebaseAuth.onAuthStateChanged(e=>{this.afs.collection("users").doc(e.uid).valueChanges().subscribe(e=>{this.my_name=e.name})}),this.afs.collection("users").doc(this.param1).valueChanges().subscribe(e=>{if(this.all_infa_user=e,console.log(this.all_infa_user),null!=this.param1)console.log("\u0447\u0430\u0442 \u0441 \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u043e\u043c"),this.firebaseAuth.onAuthStateChanged(e=>{var s=this.afs.collection("users").doc(e.uid).collection("messages").snapshotChanges().pipe((0,c.U)(e=>e.map(e=>{const s=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},s)}))),a=this.afs.collection("users").doc(this.param1).collection("messages").snapshotChanges().pipe((0,c.U)(e=>e.map(e=>{const s=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},s)})));a.subscribe(e=>{this.all_dialog=e,""==this.all_dialog?(console.log("\u043f\u0443\u0441\u0442\u043e ,  \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f 1 \u0444\u0443\u043d\u043a\u0446\u0438\u044f - create_adresatu_messages"),this.create_adresatu_messages()):(console.log("\u0435\u0441\u0442\u044c"),this.dialog_andresat=this.all_dialog.find(e=>e.destination==this.param1),console.log(this.dialog_andresat))}),s.subscribe(e=>{this.all_dialog=e,""==this.all_dialog?(console.log("\u043d\u0435\u0442 \u0434\u0438\u0430\u043b\u043e\u0433\u043e\u0432 \u0432\u044b\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f 2 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 1- create_adresatu_messages , 2- create_collection_messages"),this.create_collection_messages()):(this.all_dialog=e,this.dialog=this.all_dialog.find(e=>e.destination==this.param1),this.dialog?(console.log("\u0422\u0430\u043a\u043e\u0439 \u0434\u0438\u0430\u043b\u043e\u0433 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f 1 \u0444\u0443\u043d\u043a\u0446\u0438\u044f - get_all_messages"),this.get_all_messages(this.dialog.id)):(console.log("\u0422\u0430\u043a\u043e\u0433\u043e \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043d\u0435\u0442  2 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 1- create_adresatu_messages , 2- create_collection_messages"),this.create_adresatu_messages(),this.create_collection_messages()),console.log(this.dialog))})});else if(null!=this.dialog_chat_id){console.log("\u043e\u0431\u0449\u0438\u0439 \u0447\u0430\u0442"),this.firebaseAuth.onAuthStateChanged(e=>{this.afs.collection("users").doc(e.uid).valueChanges().subscribe(e=>{this.all_infa_user=e})}),console.log(this.dialog_chat_id),this.get_all_messages_chat(this.dialog_chat_id);var s=this.afs.collection("ideas").doc(this.dialog_chat_id).collection("message").snapshotChanges().pipe((0,c.U)(e=>e.map(e=>{const s=e.payload.doc.data();return Object.assign({id:e.payload.doc.id},s)})));s.subscribe(e=>{console.log(e)})}})})}get_all_messages_chat(e){this.afs.collection("ideas").doc(e).collection("message").valueChanges().subscribe(e=>{console.log(e),this.all_message=e;var s=this.all_message.sort(function(e,s){return e.mail_data-s.mail_data});console.log(s)})}get_all_messages(e){console.log("get_all_messages"),this.firebaseAuth.onAuthStateChanged(s=>{this.afs.collection("users").doc(s.uid).collection("messages").doc(e).collection("message").valueChanges().subscribe(e=>{console.log(e),this.all_message=e,this.all_message.sort(function(e,s){return e.mail_data-s.mail_data})})})}add_message_to_dialog(){console.log("add_message_to_dialog");var e=new Date;this.firebaseAuth.onAuthStateChanged(s=>{this.afs.collection("users").doc(s.uid).collection("messages").doc(this.dialog.id).collection("message").add({mail_data:e.getTime()/1e3,mail_id:"",mail_status:!1,mail_text:this.idea.notes,mail_user_id_from:s.uid,mail_user_id_to:this.param1,mail_user_name:this.all_infa_user.name}).then(a=>{console.log(a.id),this.afs.collection("users").doc(s.uid).collection("messages").doc(this.dialog.id).collection("message").doc(a.id).update({mail_id:a.id}).then(e=>{console.log("\u0443\u0441\u043f\u0435\u0448\u043d\u043e")}),this.afs.collection("users").doc(s.uid).collection("messages").doc(this.dialog.id).update({last_message:this.idea.notes}),console.log(this.dialog_andresat),this.afs.collection("users").doc(this.param1).collection("messages").doc(this.dialog_andresat.id).collection("message").add({mail_data:e.getTime()/1e3,mail_id:"",mail_status:!1,mail_text:this.idea.notes,mail_user_id_from:s.uid,mail_user_id_to:this.param1,mail_user_name:this.all_infa_user.name}).then(e=>{this.afs.collection("users").doc(this.param1).collection("messages").doc(this.dialog_andresat.id).collection("message").doc(e.id).update({mail_id:e.id}).then(e=>{console.log("\u0443\u0441\u043f\u0435\u0448\u043d\u043e")}),this.afs.collection("users").doc(this.param1).collection("messages").doc(this.dialog_andresat.id).update({last_message:this.idea.notes}),console.log(e)})}).catch(e=>{console.log(e)})})}create_collection_messages(){console.log("create_collection_messages"),this.firebaseAuth.onAuthStateChanged(e=>{this.afs.collection("users").doc(e.uid).collection("messages").add({author:e.uid,create_date:"22 \u0438\u044e\u043d\u044f",last_message:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",destination:this.param1,name_adresat:this.all_infa_user.name}).then(s=>{console.log(s.id),this.afs.collection("users").doc(e.uid).collection("messages").doc(s.id).update({id:s.id}).then(e=>{console.log("\u0443\u0441\u043f\u0435\u0448\u043d\u043e")})})})}create_adresatu_messages(){console.log("create_adresatu_messages"),this.firebaseAuth.onAuthStateChanged(e=>{this.afs.collection("users").doc(this.param1).collection("messages").add({author:e.uid,create_date:"25 \u0438\u044e\u043d\u044f",last_message:"\u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",destination:this.param1,name_adresat:this.my_name}).then(e=>{console.log(e.id),this.dialog_andresat=e,this.afs.collection("users").doc(this.param1).collection("messages").doc(e.id).update({id:e.id}).then(e=>{console.log("\u0443\u0441\u043f\u0435\u0448\u043d\u043e")})})})}add_message_to_chat(){var e=new Date;console.log(this.dialog_chat_id),this.afs.collection("ideas").doc(this.dialog_chat_id).collection("message").add({mail_data:e.getTime()/1e3,mail_id:"",mail_status:!1,mail_text:this.idea.notes,mail_user_id_from:"from",mail_user_id_to:"to",mail_user_name:this.all_infa_user.name}).then(e=>{console.log(e.id)})}}return e.\u0275fac=function(s){return new(s||e)(n.Y36(l.gz),n.Y36(d.zQ),n.Y36(l.gz),n.Y36(r.ST),n.Y36(g.h),n.Y36(h.iS),n.Y36(o.yF),n.Y36(l.F0))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-message"]],decls:11,vars:4,consts:[[1,"border_top_mobile"],[1,"header","mt_20"],[1,"title"],[1,"verif_text"],[4,"ngFor","ngForOf"],["rows","8",2,"border","solid 2px red",3,"ngModel","ngModelChange"],[4,"ngIf"],[2,"padding-right","0px"],[1,"red"],[2,"color","green"],["expand","full","fill","clear","color","light",2,"background-color","black",3,"click"],["name","checkmark","slot","start"]],template:function(e,s){1&e&&(n.TgZ(0,"ion-content"),n._UZ(1,"div",0),n.TgZ(2,"div",1),n.TgZ(3,"h1",2),n._uU(4,"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"),n.qZA(),n.TgZ(5,"p",3),n._uU(6,"\u041d\u0430 \u0434\u0430\u043d\u043d\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u044b \u0432\u0441\u0435 \u0432\u0430\u0448\u0438 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"),n.qZA(),n.qZA(),n.YNc(7,_,9,6,"ion-card",4),n.TgZ(8,"ion-textarea",5),n.NdJ("ngModelChange",function(e){return s.idea.notes=e}),n.qZA(),n.YNc(9,u,4,0,"div",6),n.YNc(10,m,4,0,"div",6),n.qZA()),2&e&&(n.xp6(7),n.Q6J("ngForOf",s.all_message),n.xp6(1),n.Q6J("ngModel",s.idea.notes),n.xp6(1),n.Q6J("ngIf",s.checkbox),n.xp6(1),n.Q6J("ngIf",!s.checkbox))},directives:[o.W2,t.sg,o.g2,o.j9,i.JJ,i.On,t.O5,o.PM,o.Zi,o.tO,o.YG,o.gu],pipes:[t.uU],styles:[""]}),e})()}];let f=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[l.Bz.forChild(p)],l.Bz]}),e})(),b=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[t.ez,i.u5,o.Pc,f]]}),e})()}}]);