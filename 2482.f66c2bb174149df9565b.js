(self.webpackChunkclicker=self.webpackChunkclicker||[]).push([[2482],{3946:(t,e,n)=>{"use strict";n.d(e,{ST:()=>ip});var r=n(7716),i=n(3637),o=n(8891),s=n(4402),a=n(5917),u=n(9761),c=n(9328),h=n(8002),l=n(2145),f=n(7519),d=n(5435),p=n(6136),y=n(57),v=n(8583),g=n(2329),m=n(9759),_=n(4762),w=n(4685),b=n(300),T=function(t,e){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},T(t,e)};function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var E,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S=S||{},N=C||self;function k(){}function D(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function x(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),A=0;function R(t,e,n){return t.call.apply(t.bind,arguments)}function O(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function L(t,e,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?R:O).apply(null,arguments)}function F(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function M(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function q(){this.s=this.s,this.o=this.o}var U={};q.prototype.s=!1,q.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++A)}(this);delete U[t]}},q.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var W,z=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function H(t,e){return t<e?-1:t>e?1:0}t:{var J=N.navigator;if(J){var Y=J.userAgent;if(Y){W=Y;break t}}W=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e={};for(var n in t)e[n]=t[n];return e}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<X.length;o++)n=X[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=k;var nt,rt,it=Q(W,"Opera"),ot=Q(W,"Trident")||Q(W,"MSIE"),st=Q(W,"Edge"),at=st||ot,ut=Q(W,"Gecko")&&!(Q(W.toLowerCase(),"webkit")&&!Q(W,"Edge"))&&!(Q(W,"Trident")||Q(W,"MSIE"))&&!Q(W,"Edge"),ct=Q(W.toLowerCase(),"webkit")&&!Q(W,"Edge");function ht(){var t=N.document;return t?t.documentMode:void 0}t:{var lt="",ft=(rt=W,ut?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ct?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(ft&&(lt=ft?ft[1]:""),ot){var dt=ht();if(null!=dt&&dt>parseFloat(lt)){nt=String(dt);break t}}nt=lt}var pt={};var yt=N.document&&ot&&(ht()||parseInt(nt,10))||void 0,vt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",k,e),N.removeEventListener("test",k,e)}catch(n){}return t}();function gt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(gt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ut){t:{try{et(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&mt.Z.h.call(this)}}gt.prototype.h=function(){this.defaultPrevented=!0},M(mt,gt);var _t={2:"touch",3:"pen",4:"mouse"};mt.prototype.h=function(){mt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var wt="closure_listenable_"+(1e6*Math.random()|0),bt=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++bt,this.ca=this.fa=!1}function It(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Et(t){this.src=t,this.g={},this.h=0}function Ct(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=V(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(It(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Et.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Tt(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),kt={};function Dt(t,e,n,r,i){if(r&&r.once)return Pt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Dt(t,e[o],n,r,i);return null}return n=qt(n),t&&t[wt]?t.N(e,n,x(r)?!!r.capture:!!r,i):xt(t,e,n,!1,r,i)}function xt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=x(i)?!!i.capture:!!i,a=Ft(t);if(a||(t[Nt]=a=new Et(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Lt;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)vt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ot(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Pt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Pt(t,e[o],n,r,i);return null}return n=qt(n),t&&t[wt]?t.O(e,n,x(r)?!!r.capture:!!r,i):xt(t,e,n,!0,r,i)}function At(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)At(t,e[o],n,r,i);else r=x(r)?!!r.capture:!!r,n=qt(n),t&&t[wt]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=St(o=t.g[e],n,r,i))&&(It(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Ft(t))&&(e=t.g[e.toString()],t=-1,e&&(t=St(e,n,r,i)),(n=-1<t?e[t]:null)&&Rt(n))}function Rt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[wt])Ct(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ot(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Ct(n,t),0==n.h&&(n.src=null,e[Nt]=null)):It(t)}}}function Ot(t){return t in kt?kt[t]:kt[t]="on"+t}function Lt(t,e){if(t.ca)t=!0;else{e=new mt(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Rt(t),t=n.call(r,e)}return t}function Ft(t){return(t=t[Nt])instanceof Et?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function qt(t){return"function"==typeof t?t:(t[Mt]||(t[Mt]=function(e){return t.handleEvent(e)}),t[Mt])}function Ut(){q.call(this),this.i=new Et(this),this.P=this,this.I=null}function Vt(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new gt(e,t);else if(e instanceof gt)e.target=e.target||t;else{var i=e;tt(e=new gt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=jt(s,r,!0,e)&&i}if(i=jt(s=e.g=t,r,!0,e)&&i,i=jt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=jt(s=e.g=n[o],r,!1,e)&&i}function jt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&Ct(t.i,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}M(Ut,q),Ut.prototype[wt]=!0,Ut.prototype.removeEventListener=function(t,e,n,r){At(this,t,e,n,r)},Ut.prototype.M=function(){if(Ut.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)It(n[r]);delete e.g[t],e.h--}}this.I=null},Ut.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ut.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Gt=N.JSON.stringify;function Bt(){var t=Zt,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Kt,Wt=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=zt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),zt=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new Qt},function(t){return t.reset()}),Qt=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function Ht(t){N.setTimeout(function(){throw t},0)}function Jt(t,e){Kt||function(){var t=N.Promise.resolve(void 0);Kt=function(){t.then($t)}}(),Yt||(Kt(),Yt=!0),Zt.add(t,e)}var Yt=!1,Zt=new Wt;function $t(){for(var t;t=Bt();){try{t.h.call(t.g)}catch(n){Ht(n)}var e=zt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Yt=!1}function Xt(t,e){Ut.call(this),this.h=t||1,this.g=e||N,this.j=L(this.kb,this),this.l=Date.now()}function te(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function ee(t,e,n){if("function"==typeof t)n&&(t=L(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=L(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}function ne(t){t.g=ee(function(){t.g=null,t.i&&(t.i=!1,ne(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}M(Xt,Ut),(E=Xt.prototype).da=!1,E.S=null,E.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Vt(this,"tick"),this.da&&(te(this),this.start()))}},E.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},E.M=function(){Xt.Z.M.call(this),te(this),delete this.g};var re=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:ne(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(q);function ie(t){q.call(this),this.h=t,this.g={}}M(ie,q);var oe=[];function se(t,e,n,r){Array.isArray(n)||(n&&(oe[0]=n.toString()),n=oe);for(var i=0;i<n.length;i++){var o=Dt(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function ae(t){Z(t.g,function(t,e){this.g.hasOwnProperty(e)&&Rt(t)},t),t.g={}}function ue(){this.g=!0}function ce(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Gt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}ie.prototype.M=function(){ie.Z.M.call(this),ae(this)},ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ue.prototype.Aa=function(){this.g=!1},ue.prototype.info=function(){};var he={},le=null;function fe(){return le=le||new Ut}function de(t){gt.call(this,he.Ma,t)}function pe(t){var e=fe();Vt(e,new de(e,t))}function ye(t,e){gt.call(this,he.STAT_EVENT,t),this.stat=e}function ve(t){var e=fe();Vt(e,new ye(e,t))}function ge(t,e){gt.call(this,he.Na,t),this.size=e}function me(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}he.Ma="serverreachability",M(de,gt),he.STAT_EVENT="statevent",M(ye,gt),he.Na="timingevent",M(ge,gt);var _e={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},we={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function be(){}function Te(){}be.prototype.h=null;var Ie,Ee={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ce(){gt.call(this,"d")}function Se(){gt.call(this,"c")}function Ne(){}function ke(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new ie(this),this.P=xe,this.W=new Xt(t=at?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}M(Ce,gt),M(Se,gt),M(Ne,be),Ne.prototype.g=function(){return new XMLHttpRequest},Ne.prototype.i=function(){return{}},Ie=new Ne;var xe=45e3,Pe={},Ae={};function Re(t,e,n){t.K=1,t.v=nn(Ye(e)),t.s=n,t.U=!0,Oe(t,null)}function Oe(t,e){t.F=Date.now(),qe(t),t.A=Ye(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),vn(n.h,"t",r),t.C=0,n=t.l.H,t.h=new De,t.g=gr(t.l,n?e:null,!t.s),0<t.O&&(t.L=new re(L(t.Ia,t,t.g),t.O)),se(t.V,t.g,"readystatechange",t.gb),e=t.H?$(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),pe(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Le(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Fe(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Me(t,n))==Ae){4==e&&(t.o=4,ve(14),i=!1),ce(t.j,t.m,null,"[Incomplete Response]");break}if(r==Pe){t.o=4,ve(15),ce(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}ce(t.j,t.m,r,null),Be(t,r)}Le(t)&&r!=Ae&&r!=Pe&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ve(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),cr(e),e.L=!0,ve(11))):(ce(t.j,t.m,n,"[Invalid Chunked Response]"),Ge(t),je(t))}function Me(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ae:(n=Number(e.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>e.length?Ae:(e=e.substr(r,n),t.C=r+n,e))}function qe(t){t.Y=Date.now()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=me(L(t.eb,t),e)}function Ve(t){t.B&&(N.clearTimeout(t.B),t.B=null)}function je(t){0==t.l.G||t.I||fr(t.l,t)}function Ge(t){Ve(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,te(t.W),ae(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function Be(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||In(n.i,t)))if(n.I=t.N,!t.J&&In(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;lr(n),tr(n)}ur(n),ve(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=me(L(n.ab,n),6e3));if(1>=Tn(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else pr(n,11)}else if((t.J||n.g==t)&&lr(n),!K(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];null!=u&&"number"==typeof u&&0<u&&(n.K=r=1.5*u,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=t.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=r.i;!l.g&&(Q(h,"spdy")||Q(h,"quic")||Q(h,"h2"))&&(l.j=l.l,l.g=new Set,l.h&&(En(l,l.h),l.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,en(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=t;if((r=n).oa=vr(r,r.H?r.la:null,r.W),d.J){Cn(r.i,d);var p=d,y=r.K;y&&p.setTimeout(y),p.B&&(Ve(p),qe(p)),r.g=d}else ar(r);0<n.l.length&&rr(n)}else"stop"!=o[0]&&"close"!=o[0]||pr(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?pr(n,7):Xn(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}pe(4)}catch(o){}}function Ke(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(D(t)||"string"==typeof t)j(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(D(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(D(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function We(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof We)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];Qe(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)Qe(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(E=ke.prototype).setTimeout=function(t){this.P=t},E.gb=function(t){t=t.target;var e=this.L;e&&3==Hn(t)?e.l():this.Ia(t)},E.Ia=function(t){try{if(t==this.g)t:{var e=Hn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||at||this.g&&(this.h.h||this.g.ga()||Jn(this.g)))){this.I||4!=e||7==n||pe(8==n||0>=r?3:2),Ve(this);var i=this.g.ba();this.N=i;e:if(Le(this)){var o=Jn(this.g);t="";var s=o.length,a=4==Hn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ge(this),je(this);var u="";break e}this.h.i=new N.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(c)){var l=c;break e}}l=null}if(!(i=l)){this.i=!1,this.o=3,ve(12),Ge(this),je(this);break t}ce(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Be(this,i)}this.U?(Fe(this,e,u),at&&this.i&&3==e&&(se(this.V,this.W,"tick",this.fb),this.W.start())):(ce(this.j,this.m,u,null),Be(this,u)),4==e&&Ge(this),this.i&&!this.I&&(4==e?fr(this.l,this):(this.i=!1,qe(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,ve(12)):(this.o=0,ve(13)),Ge(this),je(this)}}}catch(e){}},E.fb=function(){if(this.g){var t=Hn(this.g),e=this.g.ga();this.C<e.length&&(Ve(this),Fe(this,t,e),this.i&&4!=t&&qe(this))}},E.cancel=function(){this.I=!0,Ge(this)},E.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(pe(3),ve(17)),Ge(this),this.o=2,je(this)):Ue(this,this.Y-t)},(E=We.prototype).R=function(){ze(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},E.T=function(){return ze(this),this.g.concat()},E.get=function(t,e){return Qe(this.h,t)?this.h[t]:e},E.set=function(t,e){Qe(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},E.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Je(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Je){this.g=void 0!==e?e:t.g,Ze(this,t.j),this.s=t.s,$e(this,t.i),Xe(this,t.m),this.l=t.l,e=t.h;var n=new fn;n.i=e.i,e.g&&(n.g=new We(e.g),n.h=e.h),tn(this,n),this.o=t.o}else t&&(n=String(t).match(He))?(this.g=!!e,Ze(this,n[1]||"",!0),this.s=rn(n[2]||""),$e(this,n[3]||"",!0),Xe(this,n[4]),this.l=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.o=rn(n[7]||"")):(this.g=!!e,this.h=new fn(null,this.g))}function Ye(t){return new Je(t)}function Ze(t,e,n){t.j=n?rn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function $e(t,e,n){t.i=n?rn(e,!0):e}function Xe(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function tn(t,e,n){e instanceof fn?(t.h=e,function(t,e){e&&!t.j&&(dn(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),vn(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=on(e,hn)),t.h=new fn(e,t.g))}function en(t,e,n){t.h.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Je.prototype.toString=function(){var t=[],e=this.j;e&&t.push(on(e,an,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(on(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:un,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",on(n,ln)),t.join("")};var an=/[#\/\?@]/g,un=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,ln=/#/g;function fn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function dn(t){t.g||(t.g=new We,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function pn(t,e){dn(t),e=gn(t,e),Qe(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Qe((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&ze(t)))}function yn(t,e){return dn(t),e=gn(t,e),Qe(t.g.h,e)}function vn(t,e,n){pn(t,e),0<n.length&&(t.i=null,t.g.set(gn(t,e),B(n)),t.h+=n.length)}function gn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(E=fn.prototype).add=function(t,e){dn(this),this.i=null,t=gn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},E.forEach=function(t,e){dn(this),this.g.forEach(function(n,r){j(n,function(n){t.call(e,n,r,this)},this)},this)},E.T=function(){dn(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},E.R=function(t){dn(this);var e=[];if("string"==typeof t)yn(this,t)&&(e=G(e,this.g.get(gn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},E.set=function(t,e){return dn(this),this.i=null,yn(this,t=gn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},E.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},E.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var mn=function(t,e){this.h=t,this.g=e};function _n(t){this.l=t||wn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.g&&N.g.Ea&&N.g.Ea()&&N.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn=10;function bn(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Tn(t){return t.h?1:t.g?t.g.size:0}function In(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function En(t,e){t.g?t.g.add(e):t.h=e}function Cn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function Sn(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=I(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return B(t.i)}function Nn(){}function kn(){this.g=new Nn}function Dn(t,e,n){var r=n||"";try{Ke(t,function(t,n){var i=t;x(t)&&(i=Gt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(qd){throw e.push(r+"type="+encodeURIComponent("_badmap")),qd}}function xn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Pn(t){this.l=t.$b||null,this.j=t.ib||!1}function An(t,e){Ut.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Rn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_n.prototype.cancel=function(){var t,e;if(this.i=Sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=I(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},Nn.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},Nn.prototype.parse=function(t){return N.JSON.parse(t,void 0)},M(Pn,be),Pn.prototype.g=function(){return new An(this.l,this.j)},Pn.prototype.i=function(t){return function(){return t}}({}),M(An,Ut);var Rn=0;function On(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Ln(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Fn(t)}function Fn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(E=An.prototype).open=function(t,e){if(this.readyState!=Rn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Fn(this)},E.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||N).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},E.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ln(this)),this.readyState=Rn},E.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Fn(this)),this.g&&(this.readyState=3,Fn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==N.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;On(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},E.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ln(this):Fn(this),3==this.readyState&&On(this)}},E.Ua=function(t){this.g&&(this.response=this.responseText=t,Ln(this))},E.Ta=function(t){this.g&&(this.response=t,Ln(this))},E.ha=function(){this.g&&Ln(this)},E.setRequestHeader=function(t,e){this.v.append(t,e)},E.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(An.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Mn=N.JSON.parse;function qn(t){Ut.call(this),this.headers=new We,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Un,this.K=this.L=!1}M(qn,Ut);var Un="",Vn=/^https?$/i,jn=["POST","PUT"];function Gn(t){return"content-type"==t.toLowerCase()}function Bn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Kn(t),zn(t)}function Kn(t){t.D||(t.D=!0,Vt(t,"complete"),Vt(t,"error"))}function Wn(t){if(t.h&&void 0!==S&&(!t.C[1]||4!=Hn(t)||2!=t.ba()))if(t.v&&4==Hn(t))ee(t.Fa,0,t);else if(Vt(t,"readystatechange"),4==Hn(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(He)[1]||null;if(!o&&N.self&&N.self.location){var s=N.self.location.protocol;o=s.substr(0,s.length-1)}i=!Vn.test(o?o.toLowerCase():"")}e=i}if(e)Vt(t,"complete"),Vt(t,"success");else{t.m=6;try{var a=2<Hn(t)?t.g.statusText:""}catch(u){a=""}t.j=a+" ["+t.ba()+"]",Kn(t)}}finally{zn(t)}}}function zn(t,e){if(t.g){Qn(t);var n=t.g,r=t.C[0]?k:null;t.g=null,t.C=null,e||Vt(t,"ready");try{n.onreadystatechange=r}catch(qd){}}}function Qn(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(N.clearTimeout(t.A),t.A=null)}function Hn(t){return t.g?t.g.readyState:0}function Jn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Un:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Yn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Z(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function Zn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $n(t){this.za=0,this.l=[],this.h=new ue,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Zn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Zn("baseRetryDelayMs",5e3,t),this.$a=Zn("retryDelaySeedMs",1e4,t),this.Ya=Zn("forwardChannelMaxRetries",2,t),this.ra=Zn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new _n(t&&t.concurrentRequestLimit),this.Ca=new kn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Xn(t){if(er(t),3==t.G){var e=t.V++,n=Ye(t.F);en(n,"SID",t.J),en(n,"RID",e),en(n,"TYPE","terminate"),or(t,n),(e=new ke(t,t.h,e,void 0)).K=2,e.v=nn(Ye(n)),n=!1,N.navigator&&N.navigator.sendBeacon&&(n=N.navigator.sendBeacon(e.v.toString(),"")),!n&&N.Image&&((new Image).src=e.v,n=!0),n||(e.g=gr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),qe(e)}yr(t)}function tr(t){t.g&&(cr(t),t.g.cancel(),t.g=null)}function er(t){tr(t),t.u&&(N.clearTimeout(t.u),t.u=null),lr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&N.clearTimeout(t.m),t.m=null)}function nr(t,e){t.l.push(new mn(t.Za++,e)),3==t.G&&rr(t)}function rr(t){bn(t.i)||t.m||(t.m=!0,Jt(t.Ha,t),t.C=0)}function ir(t,e){var n;n=e?e.m:t.V++;var r=Ye(t.F);en(r,"SID",t.J),en(r,"RID",n),en(r,"AID",t.U),or(t,r),t.o&&t.s&&Yn(r,t.o,t.s),n=new ke(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=sr(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),En(t.i,n),Re(n,r,e)}function or(t,e){t.j&&Ke({},function(t,n){en(e,n,t)})}function sr(t,e,n){n=Math.min(t.l.length,n);var r=t.j?L(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(0>(c-=o))o=Math.max(0,i[u].h-100),a=!1;else try{Dn(h,s,"req"+c+"_")}catch(Yr){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function ar(t){t.g||t.u||(t.Y=1,Jt(t.Ga,t),t.A=0)}function ur(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=me(L(t.Ga,t),dr(t,t.A)),t.A++,0))}function cr(t){null!=t.B&&(N.clearTimeout(t.B),t.B=null)}function hr(t){t.g=new ke(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Ye(t.oa);en(e,"RID","rpc"),en(e,"SID",t.J),en(e,"CI",t.N?"0":"1"),en(e,"AID",t.U),or(t,e),en(e,"TYPE","xmlhttp"),t.o&&t.s&&Yn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=nn(Ye(e)),n.s=null,n.U=!0,Oe(n,t)}function lr(t){null!=t.v&&(N.clearTimeout(t.v),t.v=null)}function fr(t,e){var n=null;if(t.g==e){lr(t),cr(t),t.g=null;var r=2}else{if(!In(t.i,e))return;n=e.D,Cn(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Vt(r=fe(),new ge(r,n,e,i)),rr(t)}else ar(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Tn(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=me(L(t.Ha,t,e),dr(t,t.C)),t.C++,0)))}(t,e)||2==r&&ur(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:pr(t,5);break;case 4:pr(t,10);break;case 3:pr(t,6);break;default:pr(t,2)}}function dr(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function pr(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=L(t.jb,t);n||(n=new Je("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Ze(n,"https"),nn(n)),function(t,e){var n=new ue;if(N.Image){var r=new Image;r.onload=F(xn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=F(xn,n,r,"TestLoadImage: error",!1,e),r.onabort=F(xn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=F(xn,n,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ve(2);t.G=0,t.j&&t.j.va(e),yr(t),er(t)}function yr(t){t.G=0,t.I=-1,t.j&&(0==Sn(t.i).length&&0==t.l.length||(t.i.i.length=0,B(t.l),t.l.length=0),t.j.ua())}function vr(t,e,n){var r=function(t){return t instanceof Je?Ye(t):new Je(t,void 0)}(n);if(""!=r.i)e&&$e(r,e+"."+r.i),Xe(r,r.m);else{var i=N.location;r=function(t,e,n,r){var i=new Je(null,void 0);return t&&Ze(i,t),e&&$e(i,e),n&&Xe(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&Z(t.aa,function(t,e){en(r,e,t)}),n=t.sa,(e=t.D)&&n&&en(r,e,n),en(r,"VER",t.ma),or(t,r),r}function gr(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new qn(n&&t.Ba&&!t.qa?new Pn({ib:!0}):t.qa)).L=t.H,e}function mr(){}function _r(){if(ot&&!(10<=Number(yt)))throw Error("Environmental error: no available transport.")}function wr(t,e){Ut.call(this),this.g=new $n(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Ir(this)}function br(t){Ce.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Tr(){Se.call(this),this.status=1}function Ir(t){this.g=t}(E=qn.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ie.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:Ie),this.g.onreadystatechange=L(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void Bn(this,o)}t=n||"";var i=new We(this.headers);r&&Ke(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Gn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=N.FormData&&t instanceof N.FormData,!(0<=V(jn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Qn(this),0<this.B&&((this.K=function(t){return ot&&function(){return t=pt,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=z(String(nt)).split("."),n=z("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=H(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||H(0==o[2].length,0==s[2].length)||H(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=L(this.pa,this)):this.A=ee(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){Bn(this,o)}},E.pa=function(){void 0!==S&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Vt(this,"timeout"),this.abort(8))},E.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Vt(this,"complete"),Vt(this,"abort"),zn(this))},E.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zn(this,!0)),qn.Z.M.call(this)},E.Fa=function(){this.s||(this.F||this.v||this.l?Wn(this):this.cb())},E.cb=function(){Wn(this)},E.ba=function(){try{return 2<Hn(this)?this.g.status:-1}catch(rt){return-1}},E.ga=function(){try{return this.g?this.g.responseText:""}catch(rt){return""}},E.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Mn(e)}},E.Da=function(){return this.m},E.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(E=$n.prototype).ma=8,E.G=1,E.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},E.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new ke(this,this.h,t,void 0),n=this.s;if(this.P&&(n?tt(n=$(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=sr(this,e,r),en(i=Ye(this.F),"RID",t),en(i,"CVER",22),this.D&&en(i,"X-HTTP-Session-Id",this.D),or(this,i),this.o&&n&&Yn(i,this.o,n),En(this.i,e),this.Ra&&en(i,"TYPE","init"),this.ja?(en(i,"$req",r),en(i,"SID","null"),e.$=!0,Re(e,i,null)):Re(e,i,r),this.G=2}}else 3==this.G&&(t?ir(this,t):0==this.l.length||bn(this.i)||ir(this))},E.Ga=function(){if(this.u=null,hr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=me(L(this.bb,this),t)}},E.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ve(10),tr(this),hr(this))},E.ab=function(){null!=this.v&&(this.v=null,tr(this),ur(this),ve(19))},E.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ve(2)):(this.h.info("Failed to ping google.com"),ve(1))},(E=mr.prototype).xa=function(){},E.wa=function(){},E.va=function(){},E.ua=function(){},E.Oa=function(){},_r.prototype.g=function(t,e){return new wr(t,e)},M(wr,Ut),wr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Jt(L(t.hb,t,e))),ve(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=vr(t,null,t.W),rr(t)},wr.prototype.close=function(){Xn(this.g)},wr.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,nr(this.g,e)}else this.v?((e={}).__data__=Gt(t),nr(this.g,e)):nr(this.g,t)},wr.prototype.M=function(){this.g.j=null,delete this.j,Xn(this.g),delete this.g,wr.Z.M.call(this)},M(br,Ce),M(Tr,Se),M(Ir,mr),Ir.prototype.xa=function(){Vt(this.g,"a")},Ir.prototype.wa=function(t){Vt(this.g,new br(t))},Ir.prototype.va=function(t){Vt(this.g,new Tr(t))},Ir.prototype.ua=function(){Vt(this.g,"b")},_r.prototype.createWebChannel=_r.prototype.g,wr.prototype.send=wr.prototype.u,wr.prototype.open=wr.prototype.m,wr.prototype.close=wr.prototype.close,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,we.COMPLETE="complete",Te.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Ut.prototype.listen=Ut.prototype.N,qn.prototype.listenOnce=qn.prototype.O,qn.prototype.getLastError=qn.prototype.La,qn.prototype.getLastErrorCode=qn.prototype.Da,qn.prototype.getStatus=qn.prototype.ba,qn.prototype.getResponseJson=qn.prototype.Qa,qn.prototype.getResponseText=qn.prototype.ga,qn.prototype.send=qn.prototype.ea;var Er=_e,Cr=we,Sr=he,Nr=Pn,kr=Te,Dr=qn,xr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();xr.o=-1;var Pr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Ar=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,_.ZT)(e,t),e}(Error),Rr=new b.Yd("@firebase/firestore");function Or(){return Rr.logLevel}function Lr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Rr.logLevel<=b.in.DEBUG){var r=e.map(qr);Rr.debug.apply(Rr,(0,_.ev)(["Firestore (8.8.0): "+t],r))}}function Fr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Rr.logLevel<=b.in.ERROR){var r=e.map(qr);Rr.error.apply(Rr,(0,_.ev)(["Firestore (8.8.0): "+t],r))}}function Mr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Rr.logLevel<=b.in.WARN){var r=e.map(qr);Rr.warn.apply(Rr,(0,_.ev)(["Firestore (8.8.0): "+t],r))}}function qr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(qd){return t}}function Ur(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.8.0) INTERNAL ASSERTION FAILED: "+t;throw Fr(e),new Error(e)}function Vr(t,e){t||Ur()}function jr(t,e){return t}function Gr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Br=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Gr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Kr(t,e){return t<e?-1:t>e?1:0}function Wr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function zr(t){return t+"\0"}var Qr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ar(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ar(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ar(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ar(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Kr(this.nanoseconds,t.nanoseconds):Kr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Hr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Qr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Jr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Yr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var $r=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Ur(),void 0===n?n=t.length-e:n>t.length-e&&Ur(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}($r),ti=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ei=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ti.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Ar(Pr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Ar(Pr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Ar(Pr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}($r),ni=function(){function t(t){this.fields=t,t.sort(ei.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Wr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ri=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Kr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ri.EMPTY_BYTE_STRING=new ri("");var ii=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oi(t){if(Vr(!!t),"string"==typeof t){var e=0,n=ii.exec(t);if(Vr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:si(t.seconds),nanos:si(t.nanos)}}function si(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ai(t){return"string"==typeof t?ri.fromBase64String(t):ri.fromUint8Array(t)}function ui(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ci(t){var e=t.mapValue.fields.__previous_value__;return ui(e)?ci(e):e}function hi(t){var e=oi(t.mapValue.fields.__local_write_time__.timestampValue);return new Qr(e.seconds,e.nanos)}function li(t){return null==t}function fi(t){return 0===t&&1/t==-1/0}function di(t){return"number"==typeof t&&Number.isInteger(t)&&!fi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var pi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Xr.fromString(e))},t.fromName=function(e){return new t(Xr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Xr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Xr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Xr(e.slice()))},t}();function yi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ui(t)?4:10:Ur()}function vi(t,e){var n=yi(t);if(n!==yi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return hi(t).isEqual(hi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=oi(t.timestampValue),r=oi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ai(t.bytesValue).isEqual(ai(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return si(t.geoPointValue.latitude)===si(e.geoPointValue.latitude)&&si(t.geoPointValue.longitude)===si(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return si(t.integerValue)===si(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=si(t.doubleValue),r=si(e.doubleValue);return n===r?fi(n)===fi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Wr(t.arrayValue.values||[],e.arrayValue.values||[],vi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Jr(n)!==Jr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!vi(n[i],r[i])))return!1;return!0}(t,e);default:return Ur()}}function gi(t,e){return void 0!==(t.values||[]).find(function(t){return vi(t,e)})}function mi(t,e){var n=yi(t),r=yi(e);if(n!==r)return Kr(n,r);switch(n){case 0:return 0;case 1:return Kr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=si(t.integerValue||t.doubleValue),r=si(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return _i(t.timestampValue,e.timestampValue);case 4:return _i(hi(t),hi(e));case 5:return Kr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ai(t),r=ai(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Kr(n[i],r[i]);if(0!==o)return o}return Kr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Kr(si(t.latitude),si(e.latitude));return 0!==n?n:Kr(si(t.longitude),si(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=mi(n[i],r[i]);if(o)return o}return Kr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Kr(r[s],o[s]);if(0!==a)return a;var u=mi(n[r[s]],i[o[s]]);if(0!==u)return u}return Kr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Ur()}}function _i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Kr(t,e);var n=oi(t),r=oi(e),i=Kr(n.seconds,r.seconds);return 0!==i?i:Kr(n.nanos,r.nanos)}function wi(t){return bi(t)}function bi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=oi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ai(t.bytesValue).toBase64():"referenceValue"in t?pi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=bi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+bi(t.fields[o])}return e+"}"}(t.mapValue):Ur();var e}function Ti(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ii(t){return!!t&&"integerValue"in t}function Ei(t){return!!t&&"arrayValue"in t}function Ci(t){return!!t&&"nullValue"in t}function Si(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ni(t){return!!t&&"mapValue"in t}function ki(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return Yr(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=ki(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=ki(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Di=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ni(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ki(e)},t.prototype.setAll=function(t){var e=this,n=ei.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=ki(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ni(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return vi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ni(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){Yr(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(ki(this.value))},t}();function xi(t){var e=[];return Yr(t.fields,function(t,n){var r=new ei([t]);if(Ni(n)){var i=xi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new ni(e)}var Pi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Hr.min(),Di.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Di.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Di.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Di.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Di.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Ai=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Ri(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ai(t,e,n,r,i,o,s)}function Oi(t){var e=jr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+wi(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),li(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Qi(e.startAt)),e.endAt&&(n+="|ub:",n+=Qi(e.endAt)),e.h=n}return e.h}function Li(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ji(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!vi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Zi(t.startAt,e.startAt)&&Zi(t.endAt,e.endAt)}function Fi(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Mi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,_.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new qi(t,n,r):"array-contains"===n?new Gi(t,r):"in"===n?new Bi(t,r):"not-in"===n?new Ki(t,r):"array-contains-any"===n?new Wi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ui(t,n):new Vi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(mi(e,this.value)):null!==e&&yi(this.value)===yi(e)&&this.m(mi(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ur()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),qi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=pi.fromName(r.referenceValue),i}return(0,_.ZT)(e,t),e.prototype.matches=function(t){var e=pi.comparator(t.key,this.key);return this.m(e)},e}(Mi),Ui=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=ji(0,n),r}return(0,_.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Mi),Vi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=ji(0,n),r}return(0,_.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Mi);function ji(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return pi.fromName(t.referenceValue)})}var Gi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,_.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Ei(e)&&gi(e.arrayValue,this.value)},e}(Mi),Bi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,_.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&gi(this.value.arrayValue,e)},e}(Mi),Ki=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,_.ZT)(e,t),e.prototype.matches=function(t){if(gi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!gi(this.value.arrayValue,e)},e}(Mi),Wi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,_.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Ei(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return gi(e.value.arrayValue,t)})},e}(Mi),zi=function(t,e){this.position=t,this.before=e};function Qi(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return wi(t)}).join(",")}var Hi=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Ji(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Yi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?pi.comparator(pi.fromName(s.referenceValue),n.key):mi(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Zi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!vi(t.position[n],e.position[n]))return!1;return!0}var $i=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function Xi(t,e,n,r,i,o,s,a){return new $i(t,e,n,r,i,o,s,a)}function to(t){return new $i(t)}function eo(t){return!li(t.limit)&&"F"===t.limitType}function no(t){return!li(t.limit)&&"L"===t.limitType}function ro(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function io(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function oo(t){return null!==t.collectionGroup}function so(t){var e=jr(t);if(null===e.p){e.p=[];var n=io(e),r=ro(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Hi(n)),e.p.push(new Hi(ei.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Hi(ei.keyField(),u))}}}return e.p}function ao(t){var e=jr(t);if(!e.T)if("F"===e.limitType)e.T=Ri(e.path,e.collectionGroup,so(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=so(e);r<i.length;r++){var o=i[r];n.push(new Hi(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new zi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new zi(e.startAt.position,!e.startAt.before):null;e.T=Ri(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function uo(t,e,n){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function co(t,e){return Li(ao(t),ao(e))&&t.limitType===e.limitType}function ho(t){return Oi(ao(t))+"|lt:"+t.limitType}function lo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+wi(e.value);var e}).join(", ")+"]"),li(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+Qi(t.startAt)),t.endAt&&(e+=", endAt: "+Qi(t.endAt)),"Target("+e+")"}(ao(t))+"; limitType="+t.limitType+")"}function fo(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):pi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Yi(t.startAt,so(t),e)||t.endAt&&Yi(t.endAt,so(t),e))}(t,e)}function po(t){return function(e,n){for(var r=!1,i=0,o=so(t);i<o.length;i++){var s=o[i],a=yo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function yo(t,e,n){var r=t.field.isKeyField()?pi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?mi(r,i):Ur()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ur()}}function vo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fi(e)?"-0":e}}function go(t){return{integerValue:""+t}}function mo(t,e){return di(e)?go(e):vo(t,e)}var _o=function(){this._=void 0};function wo(t,e,n){return t instanceof Io?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Eo?Co(t,e):t instanceof So?No(t,e):function(t,e){var n=To(t,e),r=Do(n)+Do(t.A);return Ii(n)&&Ii(t.A)?go(r):vo(t.R,r)}(t,e)}function bo(t,e,n){return t instanceof Eo?Co(t,e):t instanceof So?No(t,e):n}function To(t,e){return t instanceof ko?Ii(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Io=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e}(_o),Eo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,_.ZT)(e,t),e}(_o);function Co(t,e){for(var n=xo(e),r=function(t){n.some(function(e){return vi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var So=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,_.ZT)(e,t),e}(_o);function No(t,e){for(var n=xo(e),r=function(t){n=n.filter(function(e){return!vi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ko=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,_.ZT)(e,t),e}(_o);function Do(t){return si(t.integerValue||t.doubleValue)}function xo(t){return Ei(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Po=function(t,e){this.field=t,this.transform=e},Ao=function(t,e){this.version=t,this.transformResults=e},Ro=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Oo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Lo=function(){};function Fo(t,e,n){t instanceof jo?function(t,e,n){var r=t.value.clone(),i=Ko(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Go?function(t,e,n){if(Oo(t.precondition,e)){var r=Ko(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Bo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Mo(t,e,n){t instanceof jo?function(t,e,n){if(Oo(t.precondition,e)){var r=t.value.clone(),i=Wo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Vo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Go?function(t,e,n){if(Oo(t.precondition,e)){var r=Wo(t.fieldTransforms,n,e),i=e.data;i.setAll(Bo(t)),i.setAll(r),e.convertToFoundDocument(Vo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Oo(t.precondition,e)&&e.convertToNoDocument(Hr.min())}(t,e)}function qo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=To(o.transform,s||null);null!=a&&(null==n&&(n=Di.empty()),n.set(o.field,a))}return n||null}function Uo(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Wr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Eo&&e instanceof Eo||t instanceof So&&e instanceof So?Wr(t.elements,e.elements,vi):t instanceof ko&&e instanceof ko?vi(t.A,e.A):t instanceof Io&&e instanceof Io}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Vo(t){return t.isFoundDocument()?t.version:Hr.min()}var jo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,_.ZT)(e,t),e}(Lo),Go=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,_.ZT)(e,t),e}(Lo);function Bo(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Ko(t,e,n){var r=new Map;Vr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,bo(s,a,n[i]))}return r}function Wo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,wo(a,u,e))}return r}var zo,Qo,Ho=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,_.ZT)(e,t),e}(Lo),Jo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,_.ZT)(e,t),e}(Lo),Yo=function(t){this.count=t};function Zo(t){switch(t){case Pr.OK:return Ur();case Pr.CANCELLED:case Pr.UNKNOWN:case Pr.DEADLINE_EXCEEDED:case Pr.RESOURCE_EXHAUSTED:case Pr.INTERNAL:case Pr.UNAVAILABLE:case Pr.UNAUTHENTICATED:return!1;case Pr.INVALID_ARGUMENT:case Pr.NOT_FOUND:case Pr.ALREADY_EXISTS:case Pr.PERMISSION_DENIED:case Pr.FAILED_PRECONDITION:case Pr.ABORTED:case Pr.OUT_OF_RANGE:case Pr.UNIMPLEMENTED:case Pr.DATA_LOSS:return!0;default:return Ur()}}function $o(t){if(void 0===t)return Fr("GRPC error has no .code"),Pr.UNKNOWN;switch(t){case zo.OK:return Pr.OK;case zo.CANCELLED:return Pr.CANCELLED;case zo.UNKNOWN:return Pr.UNKNOWN;case zo.DEADLINE_EXCEEDED:return Pr.DEADLINE_EXCEEDED;case zo.RESOURCE_EXHAUSTED:return Pr.RESOURCE_EXHAUSTED;case zo.INTERNAL:return Pr.INTERNAL;case zo.UNAVAILABLE:return Pr.UNAVAILABLE;case zo.UNAUTHENTICATED:return Pr.UNAUTHENTICATED;case zo.INVALID_ARGUMENT:return Pr.INVALID_ARGUMENT;case zo.NOT_FOUND:return Pr.NOT_FOUND;case zo.ALREADY_EXISTS:return Pr.ALREADY_EXISTS;case zo.PERMISSION_DENIED:return Pr.PERMISSION_DENIED;case zo.FAILED_PRECONDITION:return Pr.FAILED_PRECONDITION;case zo.ABORTED:return Pr.ABORTED;case zo.OUT_OF_RANGE:return Pr.OUT_OF_RANGE;case zo.UNIMPLEMENTED:return Pr.UNIMPLEMENTED;case zo.DATA_LOSS:return Pr.DATA_LOSS;default:return Ur()}}(Qo=zo||(zo={}))[Qo.OK=0]="OK",Qo[Qo.CANCELLED=1]="CANCELLED",Qo[Qo.UNKNOWN=2]="UNKNOWN",Qo[Qo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qo[Qo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qo[Qo.NOT_FOUND=5]="NOT_FOUND",Qo[Qo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qo[Qo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qo[Qo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qo[Qo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qo[Qo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qo[Qo.ABORTED=10]="ABORTED",Qo[Qo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qo[Qo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qo[Qo.INTERNAL=13]="INTERNAL",Qo[Qo.UNAVAILABLE=14]="UNAVAILABLE",Qo[Qo.DATA_LOSS=15]="DATA_LOSS";var Xo=function(){function t(t,e){this.comparator=t,this.root=e||es.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,es.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,es.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new ts(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new ts(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new ts(this.root,t,this.comparator,!0)},t}(),ts=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),es=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Ur();if(this.right.isRed())throw Ur();var t=this.left.check();if(t!==this.right.check())throw Ur();return t+(this.isRed()?0:1)},t}();es.EMPTY=null,es.RED=!0,es.BLACK=!1,es.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new es(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ns=function(){function t(t){this.comparator=t,this.data=new Xo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new rs(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new rs(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),rs=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),is=new Xo(pi.comparator);function os(){return is}var ss=new Xo(pi.comparator);function as(){return ss}var us=new Xo(pi.comparator);function cs(){return us}var hs=new ns(pi.comparator);function ls(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=hs,r=0,i=t;r<i.length;r++)n=n.add(i[r]);return n}var fs=new ns(Kr);function ds(){return fs}var ps=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,ys.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Hr.min(),r,ds(),os(),ls())},t}(),ys=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ri.EMPTY_BYTE_STRING,n,ls(),ls(),ls())},t}(),vs=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},gs=function(t,e){this.targetId=t,this.V=e},ms=function(t,e,n,r){void 0===n&&(n=ri.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},_s=function(){function t(){this.S=0,this.D=Ts(),this.C=ri.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=ls(),e=ls(),n=ls();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ur()}}),new ys(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Ts()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ws=function(){function t(t){this.W=t,this.G=new Map,this.H=os(),this.J=bs(),this.Y=new ns(Kr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Ur()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Fi(i))if(0===n){var o=new pi(i.path);this.tt(e,o,Pi.newNoDocument(o,Hr.min()))}else Vr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Fi(o.target)){var s=new pi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Pi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=ls();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ps(t,n,this.Y,this.H,r);return this.H=os(),this.J=bs(),this.Y=new ns(Kr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new _s,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ns(Kr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Lr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new _s),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function bs(){return new Xo(pi.comparator)}function Ts(){return new Xo(pi.comparator)}var Is={asc:"ASCENDING",desc:"DESCENDING"},Es={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Cs=function(t,e){this.databaseId=t,this.I=e};function Ss(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ns(t,e){return t.I?e.toBase64():e.toUint8Array()}function ks(t,e){return Ss(t,e.toTimestamp())}function Ds(t){return Vr(!!t),Hr.fromTimestamp(function(t){var e=oi(t);return new Qr(e.seconds,e.nanos)}(t))}function xs(t,e){return function(t){return new Xr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ps(t){var e=Xr.fromString(t);return Vr(ea(e)),e}function As(t,e){return xs(t.databaseId,e.path)}function Rs(t,e){var n=Ps(e);if(n.get(1)!==t.databaseId.projectId)throw new Ar(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ar(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pi(Ms(n))}function Os(t,e){return xs(t.databaseId,e)}function Ls(t){var e=Ps(t);return 4===e.length?Xr.emptyPath():Ms(e)}function Fs(t){return new Xr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ms(t){return Vr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function qs(t,e,n){return{name:As(t,e),fields:n.value.mapValue.fields}}function Us(t,e,n){var r=Rs(t,e.name),i=Ds(e.updateTime),o=new Di({mapValue:{fields:e.fields}}),s=Pi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Vs(t,e){var n;if(e instanceof jo)n={update:qs(t,e.key,e.value)};else if(e instanceof Ho)n={delete:As(t,e.key)};else if(e instanceof Go)n={update:qs(t,e.key,e.data),updateMask:ta(e.fieldMask)};else{if(!(e instanceof Jo))return Ur();n={verify:As(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Io)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Eo)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof So)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ko)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Ur()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ks(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ur()}(t,e.precondition)),n}function js(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Ro.updateTime(Ds(t.updateTime)):void 0!==t.exists?Ro.exists(t.exists):Ro.none()}(e.currentDocument):Ro.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Vr("REQUEST_TIME"===e.setToServerValue),n=new Io):"appendMissingElements"in e?n=new Eo(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new So(e.removeAllFromArray.values||[]):"increment"in e?n=new ko(t,e.increment):Ur();var r=ei.fromServerFormat(e.fieldPath);return new Po(r,n)}(t,e)}):[];if(e.update){var i=Rs(t,e.update.name),o=new Di({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new ni((t.fieldPaths||[]).map(function(t){return ei.fromServerFormat(t)}))}(e.updateMask);return new Go(i,o,s,n,r)}return new jo(i,o,n,r)}if(e.delete){var a=Rs(t,e.delete);return new Ho(a,n)}if(e.verify){var u=Rs(t,e.verify);return new Jo(u,n)}return Ur()}function Gs(t,e){return{documents:[Os(t,e.path)]}}function Bs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Os(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Os(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Si(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NAN"}};if(Ci(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Si(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NOT_NAN"}};if(Ci(t.value))return{unaryFilter:{field:Ys(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ys(t.field),op:Js(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Ys(t.field),direction:Hs(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||li(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=zs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=zs(e.endAt)),n}function Ks(t){var e=Ls(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Vr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ws(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Hi(Zs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return li(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Qs(n.startAt));var h=null;return n.endAt&&(h=Qs(n.endAt)),Xi(e,i,a,s,u,"F",c,h)}function Ws(t){return t?void 0!==t.unaryFilter?[Xs(t)]:void 0!==t.fieldFilter?[$s(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Ws(t)}).reduce(function(t,e){return t.concat(e)}):Ur():[]}function zs(t){return{before:t.before,values:t.position}}function Qs(t){return new zi(t.values||[],!!t.before)}function Hs(t){return Is[t]}function Js(t){return Es[t]}function Ys(t){return{fieldPath:t.canonicalString()}}function Zs(t){return ei.fromServerFormat(t.fieldPath)}function $s(t){return Mi.create(Zs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ur()}}(t.fieldFilter.op),t.fieldFilter.value)}function Xs(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Zs(t.unaryFilter.field);return Mi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Zs(t.unaryFilter.field);return Mi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Zs(t.unaryFilter.field);return Mi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Zs(t.unaryFilter.field);return Mi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ur()}}function ta(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ea(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function na(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ia(e)),e=ra(t.get(n),e);return ia(e)}function ra(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ia(t){return t+"\x01\x01"}function oa(t){var e=t.length;if(Vr(e>=2),2===e)return Vr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Xr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Ur(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Ur()}o=s+2}return new Xr(r)}var sa=function(t,e){this.seconds=t,this.nanoseconds=e},aa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};aa.store="owner",aa.key="owner";var ua=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ua.store="mutationQueues",ua.keyPath="userId";var ca=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ca.store="mutations",ca.keyPath="batchId",ca.userMutationsIndex="userMutationsIndex",ca.userMutationsKeyPath=["userId","batchId"];var ha=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,na(e)]},t.key=function(t,e,n){return[t,na(e),n]},t}();ha.store="documentMutations",ha.PLACEHOLDER=new ha;var la=function(t,e){this.path=t,this.readTime=e},fa=function(t,e){this.path=t,this.version=e},da=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};da.store="remoteDocuments",da.readTimeIndex="readTimeIndex",da.readTimeIndexPath="readTime",da.collectionReadTimeIndex="collectionReadTimeIndex",da.collectionReadTimeIndexPath=["parentPath","readTime"];var pa=function(t){this.byteSize=t};pa.store="remoteDocumentGlobal",pa.key="remoteDocumentGlobalKey";var ya=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ya.store="targets",ya.keyPath="targetId",ya.queryTargetsIndexName="queryTargetsIndex",ya.queryTargetsKeyPath=["canonicalId","targetId"];var va=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};va.store="targetDocuments",va.keyPath=["targetId","path"],va.documentTargetsIndex="documentTargetsIndex",va.documentTargetsKeyPath=["path","targetId"];var ga=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ga.key="targetGlobalKey",ga.store="targetGlobal";var ma=function(t,e){this.collectionId=t,this.parent=e};ma.store="collectionParents",ma.keyPath=["collectionId","parent"];var _a=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};_a.store="clientMetadata",_a.keyPath="clientId";var wa=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};wa.store="bundles",wa.keyPath="bundleId";var ba=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ba.store="namedQueries",ba.keyPath="name";var Ta=(0,_.ev)((0,_.ev)([],(0,_.ev)((0,_.ev)([],(0,_.ev)((0,_.ev)([],(0,_.ev)((0,_.ev)([],[ua.store,ca.store,ha.store,da.store,ya.store,aa.store,ga.store,va.store]),[_a.store])),[pa.store])),[ma.store])),[wa.store,ba.store]),Ia="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ea=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Ca=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Sa=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Ur(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Na=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Ca,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new xa(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=La(e.target.error);n.ft.reject(new xa(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new xa(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Lr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Aa(e)},t}(),ka=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,w.z$)())&&Fr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Lr("SimpleDb","Removing database:",t),Ra(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,w.z$)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n=this;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Lr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new xa(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Ar(Pr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new xa(t,n))},i.onupgradeneeded=function(t){Lr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Lr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o,s,a,u;return(0,_.Jh)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return(0,_.Jh)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Na.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Sa.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Lr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Da=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Ra(this.Pt.delete())},t}(),xa=function(t){function e(e,n){var r=this;return(r=t.call(this,Pr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,_.ZT)(e,t),e}(Ar);function Pa(t){return"IndexedDbTransactionError"===t.name}var Aa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Lr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Lr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ra(n)},t.prototype.add=function(t){return Lr("SimpleDb","ADD",this.store.name,t,t),Ra(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ra(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Lr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Lr("SimpleDb","DELETE",this.store.name,t),Ra(this.store.delete(t))},t.prototype.count=function(){return Lr("SimpleDb","COUNT",this.store.name),Ra(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Lr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Sa(function(n,r){e.onerror=function(t){var e=La(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Sa(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Da(i),s=e(i.primaryKey,i.value,o);if(s instanceof Sa){var a=s.catch(function(t){return o.done(),Sa.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Sa.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ra(t){return new Sa(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=La(t.target.error);n(e)}})}var Oa=!1;function La(t){var e=ka._t((0,w.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Ar("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Oa||(Oa=!0,setTimeout(function(){throw r},0)),r}}return t}var Fa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,_.ZT)(e,t),e}(Ea);function Ma(t,e){var n=jr(t);return ka.It(n.Mt,e)}var qa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Fo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Mo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Mo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Hr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ls())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Wr(this.mutations,t.mutations,function(t,e){return Uo(t,e)})&&Wr(this.baseMutations,t.baseMutations,function(t,e){return Uo(t,e)})},t}(),Ua=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Vr(e.mutations.length===r.length);for(var i=cs(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Va=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Hr.min()),void 0===o&&(o=Hr.min()),void 0===s&&(s=ri.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),ja=function(t){this.Lt=t};function Ga(t,e){if(e.document)return Us(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=pi.fromSegments(e.noDocument.path),r=Qa(e.noDocument.readTime),i=Pi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=pi.fromSegments(e.unknownDocument.path);return r=Qa(e.unknownDocument.version),Pi.newUnknownDocument(o,r)}return Ur()}function Ba(t,e,n){var r=Ka(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:As(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Ss(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new da(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=za(e.version);return s=e.hasCommittedMutations,new da(null,new la(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=za(e.version);return new da(new fa(c,h),null,null,!0,r,i)}return Ur()}function Ka(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Wa(t){var e=new Qr(t[0],t[1]);return Hr.fromTimestamp(e)}function za(t){var e=t.toTimestamp();return new sa(e.seconds,e.nanoseconds)}function Qa(t){var e=new Qr(t.seconds,t.nanoseconds);return Hr.fromTimestamp(e)}function Ha(t,e){for(var n=(e.baseMutations||[]).map(function(e){return js(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return js(t.Lt,e)}),o=Qr.fromMillis(e.localWriteTimeMs);return new qa(e.batchId,o,n,i)}function Ja(t){var e,n,r=Qa(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Qa(t.lastLimboFreeSnapshotVersion):Hr.min();return void 0!==t.query.documents?(Vr(1===(n=t.query).documents.length),e=ao(to(Ls(n.documents[0])))):e=function(t){return ao(Ks(t))}(t.query),new Va(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ri.fromBase64String(t.resumeToken))}function Ya(t,e){var n,r=za(e.snapshotVersion),i=za(e.lastLimboFreeSnapshotVersion);n=Fi(e.target)?Gs(t.Lt,e.target):Bs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ya(e.targetId,Oi(e.target),r,o,e.sequenceNumber,i,n)}function Za(t){var e=Ks({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?uo(e,e.limit,"L"):e}var $a=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Xa(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:Qa(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return Xa(t).put({bundleId:(n=e).id,createTime:za(Ds(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return tu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Za(e.bundledQuery),readTime:Qa(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return tu(t).put(function(t){return{name:t.name,readTime:za(Ds(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Xa(t){return Ma(t,wa.store)}function tu(t){return Ma(t,ba.store)}var eu=function(){function t(){this.Bt=new nu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Sa.resolve()},t.prototype.getCollectionParents=function(t,e){return Sa.resolve(this.Bt.getEntries(e))},t}(),nu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ns(Xr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ns(Xr.comparator)).toArray()},t}(),ru=function(){function t(){this.qt=new nu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:na(i)};return iu(t).put(o)}return Sa.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[zr(e),""],!1,!0);return iu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(oa(o.parent))}return n})},t}();function iu(t){return Ma(t,ma.store)}var ou={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},su=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function au(t,e,n){var r=t.store(ca.store),i=t.store(ha.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Vr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=ha.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Sa.waitFor(o).next(function(){return c})}function uu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ur();e=t.noDocument}return JSON.stringify(e).length}su.DEFAULT_COLLECTION_PERCENTILE=10,su.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,su.DEFAULT=new su(41943040,su.DEFAULT_COLLECTION_PERCENTILE,su.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),su.DISABLED=new su(-1,0,0);var cu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Vr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lu(t).$t({index:ca.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=fu(t),s=lu(t);return s.add({}).next(function(a){Vr("number"==typeof a);for(var u=new qa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Vs(t.Lt,e)}),i=n.mutations.map(function(e){return Vs(t.Lt,e)});return new ca(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ns(function(t,e){return Kr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=ha.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,ha.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=u.keys()}),Sa.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return lu(t).get(e).next(function(t){return t?(Vr(t.userId===n.userId),Ha(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Sa.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return lu(t).$t({index:ca.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Vr(e.batchId>=r),o=Ha(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return lu(t).$t({index:ca.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return lu(t).Nt(ca.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ha(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=ha.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return fu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=oa(r[1]);if(a===n.userId&&e.path.isEqual(c))return lu(t).get(u).next(function(t){if(!t)throw Ur();Vr(t.userId===n.userId),o.push(Ha(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ns(Kr),i=[];return e.forEach(function(e){var o=ha.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=fu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=oa(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Sa.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=ha.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ns(Kr);return fu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=oa(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(lu(t).get(e).next(function(t){if(null===t)throw Ur();Vr(t.userId===n.userId),r.push(Ha(n.R,t))}))}),Sa.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return au(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Sa.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Sa.resolve();var r=IDBKeyRange.lowerBound(ha.prefixForUser(e.userId)),i=[];return fu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=oa(t[1]);i.push(o)}else r.done()}).next(function(){Vr(0===i.length)})})},t.prototype.containsKey=function(t,e){return hu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return du(t).get(this.userId).next(function(t){return t||new ua(e.userId,-1,"")})},t}();function hu(t,e,n){var r=ha.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return fu(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function lu(t){return Ma(t,ca.store)}function fu(t){return Ma(t,ha.store)}function du(t){return Ma(t,ua.store)}var pu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),yu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new pu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Hr.fromTimestamp(new Qr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return vu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Vr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return vu(t).$t(function(s,a){var u=Ja(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Sa.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return vu(t).$t(function(t,n){var r=Ja(n);e(r)})},t.prototype.Xt=function(t){return gu(t).get(ga.key).next(function(t){return Vr(null!==t),t})},t.prototype.Zt=function(t,e){return gu(t).put(ga.key,e)},t.prototype.te=function(t,e){return vu(t).put(Ya(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Oi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return vu(t).$t({range:r,index:ya.queryTargetsIndexName},function(t,n,r){var o=Ja(n);Li(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=mu(t);return e.forEach(function(e){var s=na(e.path);i.push(o.put(new va(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Sa.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=mu(t);return Sa.forEach(e,function(e){var o=na(e.path);return Sa.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=mu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=mu(t),i=ls();return r.$t({range:n,kt:!0},function(t,e,n){var r=oa(t[1]),o=new pi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=na(e.path),r=IDBKeyRange.bound([n],[zr(n)],!1,!0),i=0;return mu(t).$t({index:va.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return vu(t).get(e).next(function(t){return t?Ja(t):null})},t}();function vu(t){return Ma(t,ya.store)}function gu(t){return Ma(t,ga.store)}function mu(t){return Ma(t,va.store)}function _u(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){if(t.code!==Pr.FAILED_PRECONDITION||t.message!==Ia)throw t;return Lr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function wu(t,e){var n=t[1],r=e[1],i=Kr(t[0],e[0]);return 0===i?Kr(n,r):i}var bu=function(){function t(t){this.ne=t,this.buffer=new ns(wu),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();wu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Tu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Lr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,_.mG)(e,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Pa(e=n.sent())?(Lr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,_u(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Iu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Sa.resolve(xr.o);var r=new bu(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Lr("LruGarbageCollector","Garbage collection skipped; disabled"),Sa.resolve(ou)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Lr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),ou):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Lr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Or()<=b.in.DEBUG&&Lr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Sa.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Eu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Iu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Cu(t,n)},t.prototype.removeReference=function(t,e,n){return Cu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Cu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return du(t).Ot(function(r){return hu(t,r,e).next(function(t){return t&&(n=!0),Sa.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),mu(t).delete([0,na(s.path)])})});i.push(u)}}).next(function(){return Sa.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Cu(t,e)},t.prototype.we=function(t,e){var n,r=mu(t),i=xr.o;return r.$t({index:va.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==xr.o&&e(new pi(oa(n)),i),i=s,n=o):i=xr.o}).next(function(){i!==xr.o&&e(new pi(oa(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Cu(t,e){return mu(t).put(function(t,e){return new va(0,na(t.path),e)}(e,t.currentSequenceNumber))}var Su=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Yr(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return Zr(this.inner)},t}(),Nu=function(){function t(){this.changes=new Su(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Hr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Pi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Sa.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),ku=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Pu(t).put(Au(e),n)},t.prototype.removeEntry=function(t,e){var n=Pu(t),r=Au(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Pu(t).get(Au(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Pu(t).get(Au(e)).next(function(t){return{document:n.ye(e,t),size:uu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=os();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=os(),i=new Xo(pi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,uu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Sa.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Pu(t).$t({range:r},function(t,e,r){for(var s=pi.fromSegments(t);o&&pi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=os(),o=e.path.length+1,s={};if(n.isEqual(Hr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Ka(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=da.collectionReadTimeIndex}return Pu(t).$t(s,function(t,n,s){if(t.length===o){var a=Ga(r.R,n);e.path.isPrefixOf(a.key.path)?fo(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Du(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return xu(t).get(pa.key).next(function(t){return Vr(!!t),t})},t.prototype.me=function(t,e){return xu(t).put(pa.key,e)},t.prototype.ye=function(t,e){if(e){var n=Ga(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Hr.min()))return n}return Pi.newInvalidDocument(t)},t}(),Du=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Su(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,_.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ns(function(t,e){return Kr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ba(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=uu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ba(e.Ie.R,Pi.newNoDocument(o,Hr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Sa.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Nu);function xu(t){return Ma(t,pa.store)}function Pu(t){return Ma(t,da.store)}function Au(t){return t.path.toArray()}var Ru=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Vr(n<r&&n>=0&&r<=11);var o=new Na("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(aa.store)}(t),function(t){t.createObjectStore(ua.store,{keyPath:ua.keyPath}),t.createObjectStore(ca.store,{keyPath:ca.keyPath,autoIncrement:!0}).createIndex(ca.userMutationsIndex,ca.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ha.store)}(t),Ou(t),function(t){t.createObjectStore(da.store)}(t));var s=Sa.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(va.store),t.deleteObjectStore(ya.store),t.deleteObjectStore(ga.store)}(t),Ou(t)),s=s.next(function(){return function(t){var e=t.store(ga.store),n=new ga(0,0,Hr.min().toTimestamp(),0);return e.put(ga.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ca.store).Nt().next(function(n){t.deleteObjectStore(ca.store),t.createObjectStore(ca.store,{keyPath:ca.keyPath,autoIncrement:!0}).createIndex(ca.userMutationsIndex,ca.userMutationsKeyPath,{unique:!0});var r=e.store(ca.store),i=n.map(function(t){return r.put(t)});return Sa.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(pa.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(da.store);e.createIndex(da.readTimeIndex,da.readTimeIndexPath,{unique:!1}),e.createIndex(da.collectionReadTimeIndex,da.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath})}(t),function(t){t.createObjectStore(ba.store,{keyPath:ba.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(da.store).$t(function(t,n){e+=uu(n)}).next(function(){var n=new pa(e);return t.store(pa.store).put(pa.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(ua.store),r=t.store(ca.store);return n.Nt().next(function(n){return Sa.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ca.userMutationsIndex,i).next(function(r){return Sa.forEach(r,function(r){Vr(r.userId===n.userId);var i=Ha(e.R,r);return au(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(va.store),n=t.store(da.store);return t.store(ga.store).get(ga.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new Xr(n),s=function(t){return[0,na(t)]}(o);r.push(e.get(s).next(function(n){return n?Sa.resolve():function(n){return e.put(new va(0,na(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Sa.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(ma.store,{keyPath:ma.keyPath});var n=e.store(ma.store),r=new nu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:na(i)})}};return e.store(da.store).$t({kt:!0},function(t,e){var n=new Xr(t);return i(n.popLast())}).next(function(){return e.store(ha.store).$t({kt:!0},function(t,e){var n=oa(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ya.store);return n.$t(function(t,r){var i=Ja(r),o=Ya(e.R,i);return n.put(o)})},t}();function Ou(t){t.createObjectStore(va.store,{keyPath:va.keyPath}).createIndex(va.documentTargetsIndex,va.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ya.store,{keyPath:ya.keyPath}).createIndex(ya.queryTargetsIndexName,ya.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ga.store)}var Lu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Fu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Ar(Pr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Eu(this,i),this.Le=n+"main",this.R=new ja(u),this.Be=new ka(this.Le,11,new Ru(this.R)),this.qe=new yu(this.referenceDelegate,this.R),this.Ut=new ru,this.Ue=function(t,e){return new ku(t,e)}(this.R,this.Ut),this.Ke=new $a,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===h&&Fr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Ar(Pr.FAILED_PRECONDITION,Lu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new xr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,_.mG)(e,void 0,void 0,function(){return(0,_.Jh)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return(0,_.mG)(e,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return(0,_.mG)(e,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return qu(e).put(new _a(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Pa(e))return Lr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Lr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Mu(t).get(aa.key).next(function(t){return Sa.resolve(e.tn(t))})},t.prototype.en=function(t){return qu(t).delete(this.clientId)},t.prototype.nn=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e,n,r=this;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ma(t,_a.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Sa.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Sa.resolve(!0):Mu(t).get(aa.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Ar(Pr.FAILED_PRECONDITION,Lu);return!1}}return!(!e.networkEnabled||!e.inForeground)||qu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Lr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return(0,_.mG)(this,void 0,void 0,function(){var t=this;return(0,_.Jh)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[aa.store,_a.store],function(e){var n=new Fa(e,xr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return qu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return cu.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Lr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ta,function(o){return r=new Fa(o,i.Ne?i.Ne.next():xr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Fr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Ar(Pr.FAILED_PRECONDITION,Ia);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Mu(t).get(aa.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Ar(Pr.FAILED_PRECONDITION,Lu)})},t.prototype.Ze=function(t){var e=new aa(this.clientId,this.allowTabSynchronization,Date.now());return Mu(t).put(aa.key,e)},t.yt=function(){return ka.yt()},t.prototype.Xe=function(t){var e=this,n=Mu(t);return n.get(aa.key).next(function(t){return e.tn(t)?(Lr("IndexedDbPersistence","Releasing primary lease."),n.delete(aa.key)):Sa.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Fr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),(0,w.G6)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Lr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Fr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Fr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Mu(t){return Ma(t,aa.store)}function qu(t){return Ma(t,_a.store)}function Uu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Vu=function(t,e){this.progress=t,this.wn=e},ju=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):oo(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new pi(e)).next(function(t){var e=as();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=as();return this.Ut.getCollectionParents(t,i).next(function(s){return Sa.forEach(s,function(s){var a=function(t,e){return new $i(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Pi.newInvalidDocument(c),r=r.insert(c,h)),Mo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){fo(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ls(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Go&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Gu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ls(),i=ls(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Bu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Hr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(eo(e)||no(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Or()<=b.in.DEBUG&&Lr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),lo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ns(po(t));return e.forEach(function(e,r){fo(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Or()<=b.in.DEBUG&&Lr("QueryEngine","Using full collection scan to execute query:",lo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Hr.min())},t}(),Ku=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Xo(Kr),this.kn=new Su(function(t){return Oi(t)},Li),this.$n=Hr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new ju(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Wu(t,e,n,r){return new Ku(t,e,n,r)}function zu(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,_.Jh)(this,function(s){switch(s.label){case 0:return n=jr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new ju(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=ls(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,v=p.mutations;y<v.length;y++)s=s.add(v[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function Qu(t,e){var n=jr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Sa.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Vr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Hu(t){var e=jr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Ju(t,e){var n=jr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Vr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=os();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(Yu(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Hr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Sa.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function Yu(t,e,n,r,i){var o=ls();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=os();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Hr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Lr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function Zu(t,e){var n=jr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function $u(t,e){var n=jr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Sa.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Va(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function Xu(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:r=jr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Pa(s=a.sent()))throw s;return Lr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function tc(t,e,n){var r=jr(t),i=Hr.min(),o=ls();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=jr(t),i=r.kn.get(n);return void 0!==i?Sa.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,ao(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Hr.min(),n?o:ls())}).next(function(t){return{documents:t,Bn:o}})})}function ec(t,e){var n=jr(t),r=jr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function nc(t){var e=jr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=jr(t),i=os(),o=Ka(n),s=Pu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:da.readTimeIndex,range:a},function(t,e){var n=Ga(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Wa(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function rc(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){return[2,(e=jr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Pu(t),n=Hr.min();return e.$t({index:da.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Wa(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function ic(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return(0,_.Jh)(this,function(p){switch(p.label){case 0:for(i=jr(t),o=ls(),s=os(),a=cs(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Kn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,$u(i,function(t){return ao(to(Xr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return Yu(t,f,s,Hr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function oc(t,e,n){return void 0===n&&(n=ls()),(0,_.mG)(this,void 0,void 0,function(){var r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return[4,$u(t,ao(Za(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=jr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Ds(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(ri.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var sc=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Sa.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ds(n.createTime)}),Sa.resolve()},t.prototype.getNamedQuery=function(t,e){return Sa.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Za(t.bundledQuery),readTime:Ds(t.readTime)}}(e)),Sa.resolve()},t}(),ac=function(){function t(){this.Wn=new ns(uc.Gn),this.zn=new ns(uc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new uc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new uc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new pi(new Xr([])),r=new uc(n,t),i=new uc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new pi(new Xr([])),n=new uc(e,t),r=new uc(e,t+1),i=ls();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new uc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),uc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return pi.comparator(t.key,e.key)||Kr(t.ns,e.ns)},t.Hn=function(t,e){return Kr(t.ns,e.ns)||pi.comparator(t.key,e.key)},t}(),cc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ns(uc.Gn)}return t.prototype.checkEmpty=function(t){return Sa.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new qa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new uc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Sa.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Sa.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Sa.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Sa.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Sa.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new uc(e,0),i=new uc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Sa.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ns(Kr);return e.forEach(function(t){var e=new uc(t,0),i=new uc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Sa.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;pi.isDocumentKey(i)||(i=i.child(""));var o=new uc(new pi(i),0),s=new ns(Kr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Sa.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Vr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Sa.forEach(e.mutations,function(i){var o=new uc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new uc(e,0),r=this.rs.firstAfterOrEqual(n);return Sa.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Sa.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),hc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Xo(pi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Sa.resolve(n?n.document.clone():Pi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=os();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Pi.newInvalidDocument(t))}),Sa.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=os(),i=new pi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||fo(e,u)&&(r=r.insert(u.key,u.clone()))}return Sa.resolve(r)},t.prototype.fs=function(t,e){return Sa.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new lc(this)},t.prototype.getSize=function(t){return Sa.resolve(this.size)},t}(),lc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,_.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Sa.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Nu),fc=function(){function t(t){this.persistence=t,this.ds=new Su(function(t){return Oi(t)},Li),this.lastRemoteSnapshotVersion=Hr.min(),this.highestTargetId=0,this.ws=0,this._s=new ac,this.targetCount=0,this.ys=pu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Sa.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Sa.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Sa.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Sa.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Sa.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new pu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Sa.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Sa.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Sa.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Sa.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Sa.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Sa.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Sa.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Sa.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Sa.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Sa.resolve(n)},t.prototype.containsKey=function(t,e){return Sa.resolve(this._s.containsKey(e))},t}(),dc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new xr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new fc(this),this.Ut=new eu,this.Ue=function(t,e){return new hc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new ja(e),this.Ke=new sc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new cc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Lr("MemoryPersistence","Starting transaction:",t);var i=new pc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Sa.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),pc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,_.ZT)(e,t),e}(Ea),yc=function(){function t(t){this.persistence=t,this.As=new ac,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Ur()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Sa.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Sa.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Sa.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Sa.forEach(this.vs,function(r){var i=pi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Sa.or([function(){return Sa.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),vc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function gc(t,e){return"firestore_clients_"+t+"_"+e}function mc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function _c(t,e){return"firestore_targets_"+t+"_"+e}vc.UNAUTHENTICATED=new vc(null),vc.GOOGLE_CREDENTIALS=new vc("google-credentials-uid"),vc.FIRST_PARTY=new vc("first-party-uid");var wc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Ar(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Fr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),bc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Ar(i.error.code,i.error.message)),o?new t(e,i.state,r):(Fr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Tc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=ds(),s=0;i&&s<r.activeTargetIds.length;++s)i=di(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Fr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Ic=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Fr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Ec=function(){function t(){this.activeTargetIds=ds()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Cc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Xo(Kr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=gc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Ec),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return(0,_.Jh)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(gc(this.persistenceKey,r)))&&(o=Tc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(_c(this.persistenceKey,t));if(n){var r=bc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(_c(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Lr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Lr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Lr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Lr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Fr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,_.mG)(e,void 0,void 0,function(){var t,e,r,i,o,s;return(0,_.Jh)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=xr.o;if(null!=t)try{var n=JSON.parse(t);Vr("number"==typeof n),e=n}catch(t){Fr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==xr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new wc(this.currentUser,t,e,n),i=mc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=mc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=_c(this.persistenceKey,t),i=new bc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Tc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return wc.Vs(new vc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return bc.Vs(r,e)},t.prototype.js=function(t){return Ic.Vs(t)},t.prototype.ii=function(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Lr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=ds();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Sc=function(){function t(){this.li=new Ec,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Ec,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Nc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),kc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Lr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Lr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Dc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},xc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Pc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return(0,_.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Dr;s.listenOnce(Cr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Er.NO_ERROR:var e=s.getResponseJson();Lr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Er.TIMEOUT:Lr("Connection",'RPC "'+t+'" timed out'),o(new Ar(Pr.DEADLINE_EXCEEDED,"Request time out"));break;case Er.HTTP_ERROR:var n=s.getStatus();if(Lr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Pr).indexOf(e)>=0?e:Pr.UNKNOWN}(r.status);o(new Ar(a,r.message))}else o(new Ar(Pr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Ar(Pr.UNAVAILABLE,"Connection failed."));break;default:Ur()}}finally{Lr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new _r,i=fe(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Nr({})),this.Fi(o.initMessageHeaders,e),(0,w.uI)()||(0,w.b$)()||(0,w.d)()||(0,w.w1)()||(0,w.Mn)()||(0,w.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Lr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new xc({Ei:function(t){c?Lr("Connection","Not sending because WebChannel is closed:",t):(u||(Lr("Connection","Opening WebChannel transport."),a.open(),u=!0),Lr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,kr.EventType.OPEN,function(){c||Lr("Connection","WebChannel transport opened.")}),l(a,kr.EventType.CLOSE,function(){c||(c=!0,Lr("Connection","WebChannel transport closed"),h.Vi())}),l(a,kr.EventType.ERROR,function(t){c||(c=!0,Mr("Connection","WebChannel transport errored:",t),h.Vi(new Ar(Pr.UNAVAILABLE,"The operation could not be completed")))}),l(a,kr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Vr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Lr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=zo[t];if(void 0!==e)return $o(e)}(i),s=r.message;void 0===o&&(o=Pr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Ar(o,s)),a.close()}else Lr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Sr.STAT_EVENT,function(t){10===t.stat?Lr("Connection","Detected buffering proxy"):11===t.stat&&Lr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Lr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Lr("RestConnection","Received: ",t),t},function(e){throw Mr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.8.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Dc[t]},t}());function Ac(){return"undefined"!=typeof window?window:null}function Rc(){return"undefined"!=typeof document?document:null}function Oc(t){return new Cs(t,!0)}var Lc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Lr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Fc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Lc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Pr.RESOURCE_EXHAUSTED?(Fr(e.toString()),Fr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Pr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Ar(Pr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return(0,_.mG)(t,void 0,void 0,function(){return(0,_.Jh)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Lr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Lr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Mc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,_.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ur()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Vr(void 0===e||"string"==typeof e),ri.fromBase64String(e||"")):(Vr(void 0===e||e instanceof Uint8Array),ri.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Pr.UNKNOWN:$o(t.code);return new Ar(e,t.message||"")}(a);n=new ms(r,i,o,s||null)}else if("documentChange"in e){i=Rs(t,(r=e.documentChange).document.name),o=Ds(r.document.updateTime);var a=new Di({mapValue:{fields:r.document.fields}}),u=(s=Pi.newFoundDocument(i,o,a),r.targetIds||[]);n=new vs(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Rs(t,(r=e.documentDelete).document),o=r.readTime?Ds(r.readTime):Hr.min(),a=Pi.newNoDocument(i,o),n=new vs([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Rs(t,(r=e.documentRemove).document),n=new vs([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Ur();var c=e.filter;i=new Yo(r=c.count||0),n=new gs(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Hr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Hr.min():e.readTime?Ds(e.readTime):Hr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Fs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Fi(r)?{documents:Gs(t,r)}:{query:Bs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Ns(t,e.resumeToken):e.snapshotVersion.compareTo(Hr.min())>0&&(n.readTime=Ss(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ur()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Fs(this.R),e.removeTarget=t,this.cr(e)},e}(Fc),qc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,_.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Vr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Vr(void 0!==e),t.map(function(t){return function(t,e){var n=Ds(t.updateTime?t.updateTime:e);return n.isEqual(Hr.min())&&(n=Ds(e)),new Ao(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ds(t.commitTime);return this.listener.Tr(n,e)}return Vr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Fs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Vs(e.R,t)})};this.cr(n)},e}(Fc),Uc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,_.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new Ar(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Pr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ar(Pr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Pr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Ar(Pr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Vc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Fr(e),this.Vr=!1):Lr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),jc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return(0,_.mG)(o,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return Yc(this)?(Lr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return(e=jr(t)).Or.add(4),[4,Bc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Gc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Vc(n,r)};function Gc(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:if(!Yc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Bc(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Kc(t,e){var n=jr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Jc(n)?Hc(n):lh(n).er()&&zc(n,e))}function Wc(t,e){var n=jr(t),r=lh(n);n.$r.delete(e),r.er()&&Qc(n,e),0===n.$r.size&&(r.er()?r.ir():Yc(n)&&n.Br.set("Unknown"))}function zc(t,e){t.qr.U(e.targetId),lh(t).mr(e)}function Qc(t,e){t.qr.U(e),lh(t).yr(e)}function Hc(t){t.qr=new ws({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),lh(t).start(),t.Br.Sr()}function Jc(t){return Yc(t)&&!lh(t).tr()&&t.$r.size>0}function Yc(t){return 0===jr(t).Or.size}function Zc(t){t.qr=void 0}function $c(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){return t.$r.forEach(function(e,n){zc(t,e)}),[2]})})}function Xc(t,e){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(n){return Zc(t),Jc(t)?(t.Br.Nr(e),Hc(t)):t.Br.set("Unknown"),[2]})})}function th(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o;return(0,_.Jh)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ms&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,_.Jh)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Lr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,eh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof vs?t.qr.X(e):e instanceof gs?t.qr.rt(e):t.qr.et(e),n.isEqual(Hr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Hu(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ri.EMPTY_BYTE_STRING,n.snapshotVersion)),Qc(t,e);var r=new Va(n.target,e,1,n.sequenceNumber);zc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Lr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,eh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function eh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r=this;return(0,_.Jh)(this,function(i){switch(i.label){case 0:if(!Pa(e))throw e;return t.Or.add(1),[4,Bc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Hu(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return(0,_.mG)(r,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return Lr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Gc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function nh(t,e){return e().catch(function(n){return eh(t,n,e)})}function rh(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n,r,i,o;return(0,_.Jh)(this,function(s){switch(s.label){case 0:e=jr(t),n=fh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Yc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Zu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=fh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,eh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return ih(e)&&oh(e),[2]}})})}function ih(t){return Yc(t)&&!fh(t).tr()&&t.kr.length>0}function oh(t){fh(t).start()}function sh(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){return fh(t).Ar(),[2]})})}function ah(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n,r;return(0,_.Jh)(this,function(i){for(e=fh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function uh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ua.from(r,e,n),[4,nh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,rh(t)];case 2:return o.sent(),[2]}})})}function ch(t,e){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e&&fh(t).pr?[4,function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return Zo(r=e.code)&&r!==Pr.ABORTED?(n=t.kr.shift(),fh(t).sr(),[4,nh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,rh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return ih(t)&&oh(t),[2]}})})}function hh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return n=jr(t),e?(n.Or.delete(2),[4,Gc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Bc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function lh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=jr(t);return r.br(),new Mc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:$c.bind(null,t),Ri:Xc.bind(null,t),_r:th.bind(null,t)}),t.Mr.push(function(n){return(0,_.mG)(e,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Jc(t)?Hc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Zc(t),e.label=3;case 3:return[2]}})})})),t.Ur}function fh(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=jr(t);return r.br(),new qc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:sh.bind(null,t),Ri:ch.bind(null,t),Ir:ah.bind(null,t),Tr:uh.bind(null,t)}),t.Mr.push(function(n){return(0,_.mG)(e,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,rh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.kr.length>0&&(Lr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var dh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ca,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ar(Pr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function ph(t,e){if(Fr("AsyncQueue",e+": "+t),Pa(t))return new Ar(Pr.UNAVAILABLE,e+": "+t);throw t}var yh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||pi.comparator(e.key,n.key)}:function(t,e){return pi.comparator(t.key,e.key)},this.keyedMap=as(),this.sortedSet=new Xo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),vh=function(){function t(){this.Qr=new Xo(pi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Ur():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),gh=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,yh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&co(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),mh=function(){this.Wr=void 0,this.listeners=[]},_h=function(){this.queries=new Su(function(t){return ho(t)},co),this.onlineState="Unknown",this.Gr=new Set};function wh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,_.Jh)(this,function(c){switch(c.label){case 0:if(n=jr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new mh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=ph(a,"Initialization of query '"+lo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Eh(n),[2]}})})}function bh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,_.Jh)(this,function(a){return n=jr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Th(t,e){for(var n=jr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Eh(n)}function Ih(t,e,n){var r=jr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Eh(t){t.Gr.forEach(function(t){t.next()})}var Ch=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new gh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=gh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Sh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Nh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Rs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Us(this.R,t.document,!1):Pi.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Ds(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Nh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||ls()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e,n,r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return[4,ic(this.localStore,new Nh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,oc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Vu(Object.assign({},this.progress),t))]}})})}}();var kh=function(t){this.key=t},Dh=function(t){this.key=t},xh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ls(),this.mutatedKeys=ls(),this.lo=po(t),this.fo=new yh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new vh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=eo(this.query)&&i.size===this.query.limit?i.last():null,c=no(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=fo(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),eo(this.query)||no(this.query))for(;s.size>this.query.limit;){var h=eo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ur()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new gh(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new vh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ls(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Dh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new kh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ls();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return gh.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Ph=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ah=function(t){this.key=t,this.bo=!1},Rh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Su(function(t){return ho(t)},co),this.Vo=new Map,this.So=new Set,this.Do=new Xo(pi.comparator),this.Co=new Map,this.No=new ac,this.xo={},this.Fo=new Map,this.ko=pu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Oh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:return n=cl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,$u(n.localStore,ao(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Lh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Kc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Lh(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o,s,a,u,c;return(0,_.Jh)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,tc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Hh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,tc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new xh(e,i.Bn),s=o._o(i.documents),a=ys.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Hh(t,n,u.To),c=new Ph(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Fh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return n=jr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!co(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Xu(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Wc(n.remoteStore,r.targetId),zh(n,r.targetId)}).catch(_u)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return zh(n,r.targetId),[4,Xu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Mh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:r=hl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=jr(t),i=Qr.now(),o=e.reduce(function(t,e){return t.add(e.key)},ls());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=qo(c,n.get(c.key));null!=h&&s.push(new Go(c.key,h,xi(h.value.mapValue),Ro.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Xo(Kr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Zh(r,i.changes)];case 3:return a.sent(),[4,rh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=ph(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function qh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:n=jr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Ju(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Vr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Vr(r.bo):t.removedDocuments.size>0&&(Vr(r.bo),r.bo=!1))}),[4,Zh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,_u(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Uh(t,e,n){var r=jr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=jr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Eh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Vh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u;return(0,_.Jh)(this,function(c){switch(c.label){case 0:return(r=jr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Xo(pi.comparator)).insert(o,Pi.newNoDocument(o,Hr.min())),a=ls().add(o),u=new ps(Hr.min(),new Map,new ns(Kr),s,a),[4,qh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Yh(r),[3,4];case 2:return[4,Xu(r.localStore,e,!1).then(function(){return zh(r,e,n)}).catch(_u)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function jh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:n=jr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,Qu(n.localStore,e)];case 2:return i=o.sent(),Wh(n,r,null),Kh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Zh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,_u(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Gh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:r=jr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=jr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Vr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Wh(r,e,n),Kh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Zh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,_u(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Bh(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:Yc((n=jr(t)).remoteStore)||Lr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=jr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=ph(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Kh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Wh(t,e,n){var r=jr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function zh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||Qh(t,e)})}function Qh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Wc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Yh(t))}function Hh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof kh?(t.No.addReference(o.key,e),Jh(t,o)):o instanceof Dh?(Lr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Qh(t,o.key)):Ur()}}function Jh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Lr("SyncEngine","New document in limbo: "+n),t.So.add(r),Yh(t))}function Yh(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new pi(Xr.fromString(e)),r=t.ko.next();t.Co.set(r,new Ah(n)),t.Do=t.Do.insert(n,r),Kc(t.remoteStore,new Va(ao(to(n.path)),r,2,xr.o))}}function Zh(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:return r=jr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Gu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return(0,_.Jh)(this,function(h){switch(h.label){case 0:n=jr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Sa.forEach(e,function(e){return Sa.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Sa.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Pa(r=h.sent()))throw r;return Lr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function $h(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return(n=jr(t)).currentUser.isEqual(e)?[3,3]:(Lr("SyncEngine","User change. New user:",e.toKey()),[4,zu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Ar(Pr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Zh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Xh(t,e){var n=jr(t),r=n.Co.get(e);if(r&&r.bo)return ls().add(r.key);var i=ls(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function tl(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return[4,tc((n=jr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Hh(n,e.targetId,i.To),i)]}})})}function el(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){return[2,nc((e=jr(t)).localStore).then(function(t){return Zh(e,t)})]})})}function nl(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o;return(0,_.Jh)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=jr(t),r=jr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Sa.resolve(null)})})}((i=jr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,rh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Wh(i,e,r||null),Kh(i,e),function(t,e){jr(jr(t)._n).Gt(e)}(i.localStore,e)):Ur(),s.label=4;case 4:return[4,Zh(i,o)];case 5:return s.sent(),[3,7];case 6:Lr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function rl(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return(0,_.Jh)(this,function(c){switch(c.label){case 0:return cl(n=jr(t)),hl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,il(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,hh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Kc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return zh(n,e),Xu(n.localStore,e,!0)}),Wc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,il(n,a)];case 5:return c.sent(),function(t){var e=jr(t);e.Co.forEach(function(t,n){Wc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new Xo(pi.comparator)}(n),n.$o=!1,[4,hh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function il(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return(0,_.Jh)(this,function(y){switch(y.label){case 0:n=jr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,$u(n.localStore,ao(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,tl(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,ec(n.localStore,a)];case 8:return p=y.sent(),[4,$u(n.localStore,p)];case 9:return u=y.sent(),[4,Lh(n,ol(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function ol(t){return Xi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function sl(t){var e=jr(t);return jr(jr(e.localStore).persistence).fn()}function al(t,e,n,r){return(0,_.mG)(this,void 0,void 0,function(){var i,o,s;return(0,_.Jh)(this,function(a){switch(a.label){case 0:return(i=jr(t)).$o?(Lr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,nc(i.localStore)];case 3:return o=a.sent(),s=ps.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Zh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Xu(i.localStore,e,!0)];case 6:return a.sent(),zh(i,e,r),[3,8];case 7:Ur(),a.label=8;case 8:return[2]}})})}function ul(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return(0,_.Jh)(this,function(f){switch(f.label){case 0:if(!(r=cl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Lr("SyncEngine","Adding an already active target "+s),[3,5]):[4,ec(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,$u(r.localStore,a)];case 3:return u=f.sent(),[4,Lh(r,ol(a),u.targetId,!1)];case 4:f.sent(),Kc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Xu(r.localStore,t,!1).then(function(){Wc(r.remoteStore,t),zh(r,t)}).catch(_u)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function cl(t){var e=jr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vh.bind(null,e),e.vo._r=Th.bind(null,e.eventManager),e.vo.Mo=Ih.bind(null,e.eventManager),e}function hl(t){var e=jr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=jh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Gh.bind(null,e),e}var ll=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return this.R=Oc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return Wu(this.persistence,new Bu,t.initialUser,this.R)},t.prototype.qo=function(t){return new dc(yc.bs,this.R)},t.prototype.Bo=function(t){return new Sc},t.prototype.terminate=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),fl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,_.ZT)(e,t),e.prototype.initialize=function(e){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,rc(this.localStore)];case 2:return n.sent(),[4,this.Qo.initialize(this,e)];case 3:return n.sent(),[4,hl(this.Qo.syncEngine)];case 4:return n.sent(),[4,rh(this.Qo.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Ko=function(t){return Wu(this.persistence,new Bu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Tu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Uu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?su.withCacheSize(this.cacheSizeBytes):su.DEFAULT;return new Fu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Ac(),Rc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Sc},e}(ll),dl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,_.ZT)(e,t),e.prototype.initialize=function(e){return(0,_.mG)(this,void 0,void 0,function(){var n,r=this;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Cc?(this.sharedClientState.syncEngine={ui:nl.bind(null,n),ai:al.bind(null,n),hi:ul.bind(null,n),fn:sl.bind(null,n),ci:el.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return(0,_.mG)(r,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return[4,rl(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Ac();if(!Cc.yt(e))throw new Ar(Pr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Uu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Cc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(fl),pl=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n=this;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Uh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=$h.bind(null,this.syncEngine),[4,hh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new _h},t.prototype.createDatastore=function(t){var e=Oc(t.databaseInfo.databaseId),n=new Pc(t.databaseInfo);return function(t,e,n){return new Uc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Uh(s.syncEngine,t,0)},o=kc.yt()?new kc:new Nc,new jc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Rh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e=jr(t),Lr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Bc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),yl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),vl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Ca,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e,n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Sh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n=this;return(0,_.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Ar(Pr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a;return(0,_.Jh)(this,function(u){switch(u.label){case 0:return n=jr(t),r=Fs(n.R)+"/documents",i={documents:e.map(function(t){return As(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Vr(!!e.found);var n=Rs(t,e.found.name),r=Ds(e.found.updateTime),i=new Di({mapValue:{fields:e.found.fields}});return Pi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Vr(!!e.missing),Vr(!!e.readTime);var n=Rs(t,e.missing),r=Ds(e.readTime);return Pi.newNoDocument(n,r)}(t,e):Ur()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Vr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ho(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e=this;return(0,_.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=pi.fromPath(n);e.mutations.push(new Jo(r,e.precondition(r)))}),[4,function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return n=jr(t),r=Fs(n.R)+"/documents",i={writes:e.map(function(t){return Vs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Ur();e=Hr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ar(Pr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Ro.updateTime(e):Ro.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Hr.min()))throw new Ar(Pr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ro.updateTime(e)}return Ro.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),gl=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Lc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return(0,_.mG)(t,void 0,void 0,function(){var t,e,n=this;return(0,_.Jh)(this,function(r){return t=new vl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!li(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Zo(e)}return!1},t}(),ml=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=vc.UNAUTHENTICATED,this.clientId=Br.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return(0,_.mG)(r,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return Lr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Ar(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Ca;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,_.mG)(t,void 0,void 0,function(){var t,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ph(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function _l(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Lr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return(0,_.mG)(i,void 0,void 0,function(){return(0,_.Jh)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,zu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function wl(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,bl(t)];case 1:return n=i.sent(),Lr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return(0,_.mG)(this,void 0,void 0,function(){var n,r;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return(n=jr(t)).asyncQueue.verifyOperationInProgress(),Lr("RemoteStore","RemoteStore received new credentials"),r=Yc(n),n.Or.add(3),[4,Bc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Gc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function bl(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Lr("FirestoreClient","Using default OfflineComponentProvider"),[4,_l(t,new ll)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Tl(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Lr("FirestoreClient","Using default OnlineComponentProvider"),[4,wl(t,new pl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Il(t){return bl(t).then(function(t){return t.persistence})}function El(t){return bl(t).then(function(t){return t.localStore})}function Cl(t){return Tl(t).then(function(t){return t.remoteStore})}function Sl(t){return Tl(t).then(function(t){return t.syncEngine})}function Nl(t){return(0,_.mG)(this,void 0,void 0,function(){var e,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return[4,Tl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Oh.bind(null,e.syncEngine),n.onUnlisten=Fh.bind(null,e.syncEngine),n)]}})})}function kl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(r,void 0,void 0,function(){var r;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(o){e.enqueueAndForget(function(){return bh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Ar(Pr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Ar(Pr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Ch(to(n.path),o,{includeMetadataChanges:!0,so:!0});return wh(t,s)},[4,Nl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Dl(t,e,n){var r=this;void 0===n&&(n={});var i=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(r,void 0,void 0,function(){var r;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new yl({next:function(n){e.enqueueAndForget(function(){return bh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Ar(Pr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Ch(n,o,{includeMetadataChanges:!0,so:!0});return wh(t,s)},[4,Nl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var xl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Pl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Al=new Map,Rl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Ol=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(vc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Ll=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Fl=function(){function t(t){var e=this;this.currentUser=vc.UNAUTHENTICATED,this.oc=new Ca,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Lr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Lr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Lr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Vr("string"==typeof n.accessToken),new Rl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return(0,_.mG)(n,void 0,void 0,function(){return(0,_.Jh)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Vr(null===t||"string"==typeof t),new vc(t)},t}(),Ml=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=vc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),ql=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Ml(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(vc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Ul(t,e,n){if(!n)throw new Ar(Pr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Vl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function jl(t,e,n,r){if(!0===e&&!0===r)throw new Ar(Pr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Gl(t){if(!pi.isDocumentKey(t))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Bl(t){if(pi.isDocumentKey(t))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Kl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Ur()}function Wl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ar(Pr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Kl(t);throw new Ar(Pr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function zl(t,e){if(e<=0)throw new Ar(Pr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Ql=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Ar(Pr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ar(Pr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,jl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Hl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ql({}),this._settingsFrozen=!1,t instanceof Pl?(this._databaseId=t,this._credentials=new Ol):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ar(Pr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pl(t.options.projectId)}(t),this._credentials=new Fl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Ar(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Ar(Pr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ql(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Ol;switch(t.type){case"gapi":var e=t.client;return Vr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new ql(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Ar(Pr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Al.get(this))&&(Lr("ComponentProvider","Removing Datastore"),Al.delete(this),t.terminate()),Promise.resolve();var t},t}(),Jl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Zl(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Yl=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Zl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,to(r))||this)._path=r,i.type="collection",i}return(0,_.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Jl(this.firestore,null,new pi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Yl);function $l(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,w.m9)(t),Ul("collection","path",e),t instanceof Hl)return Bl(n=Xr.fromString.apply(Xr,(0,_.ev)([e],r))),new Zl(t,null,n);if(!(t instanceof Jl||t instanceof Zl))throw new Ar(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Bl(n=Xr.fromString.apply(Xr,(0,_.ev)([t.path],r)).child(Xr.fromString(e))),new Zl(t.firestore,null,n)}function Xl(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=(0,w.m9)(t),1===arguments.length&&(e=Br.u()),Ul("doc","path",e),t instanceof Hl)return Gl(n=Xr.fromString.apply(Xr,(0,_.ev)([e],r))),new Jl(t,null,new pi(n));if(!(t instanceof Jl||t instanceof Zl))throw new Ar(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Gl(n=t._path.child(Xr.fromString.apply(Xr,(0,_.ev)([e],r)))),new Jl(t.firestore,t instanceof Zl?t.converter:null,new pi(n))}function tf(t,e){return t=(0,w.m9)(t),e=(0,w.m9)(e),(t instanceof Jl||t instanceof Zl)&&(e instanceof Jl||e instanceof Zl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function ef(t,e){return t=(0,w.m9)(t),e=(0,w.m9)(e),t instanceof Yl&&e instanceof Yl&&t.firestore===e.firestore&&co(t._query,e._query)&&t.converter===e.converter}var nf=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Lc(this,"async_queue_retry"),this.Ic=function(){var e=Rc();e&&Lr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Rc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=Rc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Ca;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return(0,_.mG)(this,void 0,void 0,function(){var t,e=this;return(0,_.Jh)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Pa(t=n.sent()))throw t;return Lr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Fr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=dh.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Ur()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return(0,_.mG)(this,void 0,void 0,function(){var t;return(0,_.Jh)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function rf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Ca,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var of=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new nf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,_.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||af(this),this._firestoreClient.terminate()},e}(Hl);function sf(t){return t._firestoreClient||af(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function af(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new xl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ml(t._credentials,t._queue,r)}function uf(t,e,n){var r=this,i=new Ca;return t.asyncQueue.enqueue(function(){return(0,_.mG)(r,void 0,void 0,function(){var r;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,_l(t,n)];case 1:return o.sent(),[4,wl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Pr.FAILED_PRECONDITION||t.code===Pr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function cf(t){if(t._initialized||t._terminated)throw new Ar(Pr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var hf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ei(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),lf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ri.fromBase64String(e))}catch(e){throw new Ar(Pr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ri.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),ff=function(t){this._methodName=t},df=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ar(Pr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ar(Pr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Kr(this._lat,t._lat)||Kr(this._long,t._long)},t}(),pf=/^__.*__$/,yf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Go(t,this.data,this.fieldMask,e,this.fieldTransforms):new jo(t,this.data,e,this.fieldTransforms)},t}(),vf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Go(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function gf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ur()}}var mf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Fc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,kc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,kc:!0})},t.prototype.Lc=function(t){return qf(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(gf(this.Nc)&&pf.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),_f=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Oc(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new mf({Nc:t,methodName:e,qc:n,path:ei.emptyPath(),kc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function wf(t){var e=t._freezeSettings(),n=Oc(t._databaseId);return new _f(t._databaseId,!!e.ignoreUndefinedProperties,n)}function bf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Of("Data must be an object, but it was:",s,r);var a,u,c=Af(r,s);if(o.merge)a=new ni(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Lf(e,f[l],n);if(!s.contains(d))throw new Ar(Pr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Uf(h,d)||h.push(d)}a=new ni(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new yf(new Di(c),a,u)}var Tf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ff);function If(t,e,n){return new mf({Nc:3,qc:e.settings.qc,methodName:t._methodName,kc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Ef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new Po(t.path,new Io)},e.prototype.isEqual=function(t){return t instanceof e},e}(ff),Cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,_.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=If(this,t,!0),n=this.Kc.map(function(t){return Pf(t,e)}),r=new Eo(n);return new Po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ff),Sf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return(0,_.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=If(this,t,!0),n=this.Kc.map(function(t){return Pf(t,e)}),r=new So(n);return new Po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ff),Nf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return(0,_.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new ko(t.R,mo(t.R,this.Qc));return new Po(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ff);function kf(t,e,n,r){var i=t.Uc(1,e,n);Of("Data must be an object, but it was:",i,r);var o=[],s=Di.empty();Yr(r,function(t,r){var a=Mf(e,t,n);r=(0,w.m9)(r);var u=i.Oc(a);if(r instanceof Tf)o.push(a);else{var c=Pf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new ni(o);return new vf(s,a,i.fieldTransforms)}function Df(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[Lf(e,r,n)],u=[i];if(o.length%2!=0)throw new Ar(Pr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Lf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Di.empty(),f=a.length-1;f>=0;--f)if(!Uf(h,a[f])){var d=a[f],p=u[f];p=(0,w.m9)(p);var y=s.Oc(d);if(p instanceof Tf)h.push(d);else{var v=Pf(p,y);null!=v&&(h.push(d),l.set(d,v))}}var g=new ni(h);return new vf(l,g,s.fieldTransforms)}function xf(t,e,n,r){return void 0===r&&(r=!1),Pf(n,t.Uc(r?4:3,e))}function Pf(t,e){if(Rf(t=(0,w.m9)(t)))return Of("Unsupported field value:",e,t),Af(t,e);if(t instanceof ff)return function(t,e){if(!gf(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.kc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Pf(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,w.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return mo(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Qr.fromDate(t);return{timestampValue:Ss(e.R,n)}}if(t instanceof Qr)return n=new Qr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Ss(e.R,n)};if(t instanceof df)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof lf)return{bytesValue:Ns(e.R,t._byteString)};if(t instanceof Jl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:xs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+Kl(t))}(t,e)}function Af(t,e){var n={};return Zr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Yr(t,function(t,r){var i=Pf(r,e.Fc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Rf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Qr||t instanceof df||t instanceof lf||t instanceof Jl||t instanceof ff)}function Of(t,e,n){if(!Rf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Kl(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function Lf(t,e,n){if((e=(0,w.m9)(e))instanceof hf)return e._internalPath;if("string"==typeof e)return Mf(t,e);throw qf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Ff=new RegExp("[~\\*/\\[\\]]");function Mf(t,e,n){if(e.search(Ff)>=0)throw qf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(hf.bind.apply(hf,(0,_.ev)([void 0],e.split(".")))))._internalPath}catch(qd){throw qf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function qf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Ar(Pr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Uf(t,e){return t.some(function(t){return t.isEqual(e)})}var Vf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Jl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new jf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Gf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),jf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Vf);function Gf(t,e){return"string"==typeof e?Mf(t,e):e instanceof hf?e._internalPath:e._delegate._internalPath}var Bf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Kf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,_.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Wf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Gf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Vf),Wf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Kf),zf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Bf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Wf(n._firestore,n._userDataWriter,r.key,r,new Bf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Ar(Pr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Wf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Bf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Wf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Bf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Qf(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function Qf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ur()}}function Hf(t,e){return t instanceof Kf&&e instanceof Kf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof zf&&e instanceof zf&&t._firestore===e._firestore&&ef(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Jf(t){if(no(t)&&0===t.explicitOrderBy.length)throw new Ar(Pr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Yf=function(){};function Zf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var $f=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return(0,_.ZT)(e,t),e.prototype._apply=function(t){var e=wf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){od(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(id(r,t,h[c]));a={arrayValue:{values:u}}}else a=id(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||od(s,o),a=xf(n,"where",s,"in"===o||"not-in"===o);var l=Mi.create(i,o,a);return function(t,e){if(e.g()){var n=io(t);if(null!==n&&!n.isEqual(e.field))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=ro(t);null!==r&&sd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Ar(Pr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new Yl(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Yf),Xf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return(0,_.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Hi(e,n);return function(t,e){if(null===ro(t)){var n=io(t);null!==n&&sd(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new Yl(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new $i(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Yf),td=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,_.ZT)(e,t),e.prototype._apply=function(t){return new Yl(t.firestore,t.converter,uo(t._query,this.Hc,this.Jc))},e}(Yf),ed=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,_.ZT)(e,t),e.prototype._apply=function(t){var e=rd(t,this.type,this.Yc,this.Xc);return new Yl(t.firestore,t.converter,function(t,e){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Yf),nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return(0,_.ZT)(e,t),e.prototype._apply=function(t){var e=rd(t,this.type,this.Yc,this.Xc);return new Yl(t.firestore,t.converter,function(t,e){return new $i(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Yf);function rd(t,e,n,r){if(n[0]=(0,w.m9)(n[0]),n[0]instanceof Vf)return function(t,e,n,r,i){if(!r)throw new Ar(Pr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=so(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Ti(e,r.key));else{var c=r.data.field(u.field);if(ui(c))throw new Ar(Pr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new zi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=wf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Ar(Pr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!oo(t)&&-1!==c.indexOf("/"))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Xr.fromString(c));if(!pi.isDocumentKey(h))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new pi(h);a.push(Ti(e,l))}else{var f=xf(n,r,c);a.push(f)}}return new zi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function id(t,e,n){if("string"==typeof(n=(0,w.m9)(n))){if(""===n)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!oo(e)&&-1!==n.indexOf("/"))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Xr.fromString(n));if(!pi.isDocumentKey(r))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ti(t,new pi(r))}if(n instanceof Jl)return Ti(t,n._key);throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Kl(n)+".")}function od(t,e){if(!Array.isArray(t)||0===t.length)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function sd(t,e,n){if(!n.isEqual(e))throw new Ar(Pr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var ad=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),yi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return si(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ai(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ur()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Yr(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new df(si(t.latitude),si(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=ci(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(hi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=oi(t);return new Qr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Xr.fromString(t);Vr(ea(n));var r=new Pl(n.get(1),n.get(3)),i=new pi(n.popFirst(5));return r.isEqual(e)||Fr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function ud(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var cd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,_.ZT)(e,t),e.prototype.convertBytes=function(t){return new lf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Jl(this.firestore,null,e)},e}(ad),hd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=wf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=ld(t,this._firestore),i=ud(r.converter,e,n),o=bf(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Ro.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=ld(t,this._firestore);return o="string"==typeof(e=(0,w.m9)(e))||e instanceof hf?Df(this._dataReader,"WriteBatch.update",s._key,e,n,r):kf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Ro.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=ld(t,this._firestore);return this._mutations=this._mutations.concat(new Ho(e._key,Ro.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Ar(Pr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function ld(t,e){if((t=(0,w.m9)(t)).firestore!==e)throw new Ar(Pr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var fd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,_.ZT)(e,t),e.prototype.convertBytes=function(t){return new lf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Jl(this.firestore,null,e)},e}(ad);function dd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Wl(t,Jl);var o=Wl(t.firestore,of),s=wf(o);return yd(o,[("string"==typeof(e=(0,w.m9)(e))||e instanceof hf?Df(s,"updateDoc",t._key,e,n,r):kf(s,"updateDoc",t._key,e)).toMutation(t._key,Ro.exists(!0))])}function pd(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=(0,w.m9)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||rf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(rf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Jl)c=Wl(t.firestore,of),h=to(t._key.path),u={next:function(e){i[a]&&i[a](vd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Wl(t,Yl);c=Wl(d.firestore,of),h=d._query;var p=new fd(c);u={next:function(t){i[a]&&i[a](new zf(c,p,d,t))},error:i[a+1],complete:i[a+2]},Jf(t._query)}return function(t,e,n,r){var i=this,o=new yl(r),s=new Ch(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(i,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e=wh,[4,Nl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(i,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e=bh,[4,Nl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(sf(c),h,l,u)}function yd(t,e){return function(t,e){var n=this,r=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var n;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return n=Mh,[4,Sl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(sf(t),e)}function vd(t,e,n){var r=n.docs.get(e._key),i=new fd(t);return new Kf(t,i,e._key,r,new Bf(n.hasPendingWrites,n.fromCache),e.converter)}var gd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,_.ZT)(e,t),e.prototype.get=function(e){var n=this,r=ld(e,this._firestore),i=new fd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Kf(n._firestore,i,r._key,t._document,new Bf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=wf(t)}return t.prototype.get=function(t){var e=this,n=ld(t,this._firestore),r=new cd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Ur();var i=t[0];if(i.isFoundDocument())return new Vf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Vf(e._firestore,r,n._key,null,n.converter);throw Ur()})},t.prototype.set=function(t,e,n){var r=ld(t,this._firestore),i=ud(r.converter,e,n),o=bf(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=ld(t,this._firestore);return o="string"==typeof(e=(0,w.m9)(e))||e instanceof hf?Df(this._dataReader,"Transaction.update",s._key,e,n,r):kf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=ld(t,this._firestore);return this._transaction.delete(e._key),this},t}());function md(){if("undefined"==typeof Uint8Array)throw new Ar(Pr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function _d(){if("undefined"==typeof atob)throw new Ar(Pr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var wd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return _d(),new t(lf.fromBase64String(e))},t.fromUint8Array=function(e){return md(),new t(lf.fromUint8Array(e))},t.prototype.toBase64=function(){return _d(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return md(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),bd=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){cf(t=Wl(t,of));var n=sf(t),r=t._freezeSettings(),i=new pl;return uf(n,i,new fl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){cf(t=Wl(t,of));var e=sf(t),n=t._freezeSettings(),r=new pl;return uf(e,r,new dl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Ar(Pr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Ca;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,_.mG)(e,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,_.mG)(this,void 0,void 0,function(){return(0,_.Jh)(this,function(e){switch(e.label){case 0:return ka.yt()?[4,ka.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Uu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Td=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Pl||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Mr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Wl(t,Hl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Mr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=(0,w.Sg)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Ar(Pr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Ll(new Rl(o,new vc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,_.mG)(e,void 0,void 0,function(){var e,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return[4,Il(t)];case 1:return e=r.sent(),[4,Cl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=jr(t);return e.Or.delete(0),Gc(e)}(n))]}})})})}(sf(Wl(this._delegate,of)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return(0,_.mG)(e,void 0,void 0,function(){var e,n;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return[4,Il(t)];case 1:return e=r.sent(),[4,Cl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,_.mG)(this,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return(e=jr(t)).Or.add(0),[4,Bc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(sf(Wl(this._delegate,of)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&jl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(e,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(r){switch(r.label){case 0:return e=Bh,[4,Sl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(sf(Wl(this._delegate,of)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new yl(e);return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){jr(t).Gr.add(e),e.next()},[4,Nl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var e;return(0,_.Jh)(this,function(n){switch(n.label){case 0:return e=function(t,e){jr(t).Gr.delete(e)},[4,Nl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(sf(t=Wl(t,of)),rf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new Ar(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Fd(this,$l(this._delegate,t))}catch(t){throw kd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Nd(this,Xl(this._delegate,t))}catch(t){throw kd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Rd(this,function(t,e){if(t=Wl(t,Hl),Ul("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Yl(t,null,function(t){return new $i(Xr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw kd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var n;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return[4,function(t){return Tl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new gl(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(sf(t),function(n){return e(new gd(t,n))})}(this._delegate,function(n){return t(new Ed(e,n))})},t.prototype.batch=function(){var t=this;return sf(this._delegate),new Cd(new hd(this._delegate,function(e){return yd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Ar(Pr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Ar(Pr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Id=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,_.ZT)(e,t),e.prototype.convertBytes=function(t){return new wd(new lf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Nd.eu(e,this.firestore,null)},e}(ad),Ed=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Id(t)}return t.prototype.get=function(t){var e=this,n=Md(t);return this._delegate.get(n).then(function(t){return new Pd(e._firestore,new Kf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Md(t);return n?(Vl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Md(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,_.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Md(t);return this._delegate.delete(e),this},t}(),Cd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Md(t);return n?(Vl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Md(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,_.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Md(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Sd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Wf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ad(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Id(e),n),i.set(n,o)),o},t}();Sd.su=new WeakMap;var Nd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Id(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new Ar(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Jl(n._delegate,r,new pi(e)))},t.eu=function(e,n,r){return new t(n,new Jl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Fd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Fd(this.firestore,$l(this._delegate,t))}catch(t){throw kd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,w.m9)(t))instanceof Jl&&tf(this._delegate,t)},t.prototype.set=function(t,e){e=Vl("DocumentReference.set",e);try{return function(t,e,n){t=Wl(t,Jl);var r=Wl(t.firestore,of),i=ud(t.converter,e,n);return yd(r,[bf(wf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Ro.none())])}(this._delegate,t,e)}catch(t){throw kd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?dd(this._delegate,t):dd.apply(void 0,(0,_.ev)([this._delegate,t,e],n))}catch(t){throw kd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return yd(Wl((t=this._delegate).firestore,of),[new Ho(t._key,Ro.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Dd(e),i=xd(e,function(e){return new Pd(t.firestore,new Kf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return pd(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Wl(t,Jl);var e=Wl(t.firestore,of),n=sf(e),r=new fd(e);return function(t,e){var n=this,r=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var n;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i;return(0,_.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=jr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Ar(Pr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ph(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Kf(e,r,t._key,n,new Bf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Wl(t,Jl);var e=Wl(t.firestore,of);return kl(sf(e),t._key,{source:"server"}).then(function(n){return vd(e,t,n)})}(this._delegate):function(t){t=Wl(t,Jl);var e=Wl(t.firestore,of);return kl(sf(e),t._key).then(function(n){return vd(e,t,n)})}(this._delegate)).then(function(t){return new Pd(e.firestore,new Kf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Sd.nu(this.firestore,e):null))},t}();function kd(t,e,n){return t.message=t.message.replace(e,n),t}function Dd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!rf(r))return r}return{}}function xd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=rf(t[0])?t[0]:rf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Pd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Nd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Hf(this._delegate,t._delegate)},t}(),Ad=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,_.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Pd),Rd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Id(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Zf(this._delegate,function(t,e,n){var r=e,i=Gf("where",t);return new $f(i,r,n)}(e,n,r)))}catch(e){throw kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Zf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Gf("orderBy",t);return new Xf(r,n)}(e,n)))}catch(e){throw kd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Zf(this._delegate,function(t){return zl("limit",t),new td("limit",t,"F")}(e)))}catch(e){throw kd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Zf(this._delegate,function(t){return zl("limitToLast",t),new td("limitToLast",t,"L")}(e)))}catch(e){throw kd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Zf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ed("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw kd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Zf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ed("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw kd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Zf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw kd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Zf(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new nd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw kd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return ef(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Wl(t,Yl);var e=Wl(t.firestore,of),n=sf(e),r=new fd(e);return function(t,e){var n=this,r=new Ca;return t.asyncQueue.enqueueAndForget(function(){return(0,_.mG)(n,void 0,void 0,function(){var n;return(0,_.Jh)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,_.mG)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,_.Jh)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,tc(t,e,!0)];case 1:return a=u.sent(),r=new xh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=ph(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,El(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new zf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Wl(t,Yl);var e=Wl(t.firestore,of),n=sf(e),r=new fd(e);return Dl(n,t._query,{source:"server"}).then(function(n){return new zf(e,r,t,n)})}(this._delegate):function(t){t=Wl(t,Yl);var e=Wl(t.firestore,of),n=sf(e),r=new fd(e);return Jf(t._query),Dl(n,t._query).then(function(n){return new zf(e,r,t,n)})}(this._delegate)).then(function(t){return new Ld(e.firestore,new zf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Dd(e),i=xd(e,function(e){return new Ld(t.firestore,new zf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return pd(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Sd.nu(this.firestore,e):null))},t}(),Od=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ad(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Ld=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Rd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Ad(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Od(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Ad(n._firestore,r))})},t.prototype.isEqual=function(t){return Hf(this._delegate,t._delegate)},t}(),Fd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,_.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Nd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Nd(this.firestore,void 0===t?Xl(this._delegate):Xl(this._delegate,t))}catch(t){throw kd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Wl(t.firestore,of),r=Xl(t),i=ud(t.converter,e);return yd(n,[bf(wf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Ro.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Nd(e.firestore,t)})},e.prototype.isEqual=function(t){return tf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Sd.nu(this.firestore,t):null))},e}(Rd);function Md(t){return Wl(t,Jl)}var qd,Ud=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(hf.bind.apply(hf,(0,_.ev)([void 0],t)))}return t.documentId=function(){return new t(ei.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,w.m9)(t))instanceof hf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Vd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Ef("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Tf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Cf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Sf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Nf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),jd=n(6034),Gd={Firestore:Td,GeoPoint:df,Timestamp:Qr,Blob:wd,Transaction:Ed,WriteBatch:Cd,DocumentReference:Nd,DocumentSnapshot:Pd,Query:Rd,QueryDocumentSnapshot:Ad,QuerySnapshot:Ld,CollectionReference:Fd,FieldPath:Ud,FieldValue:Vd,setLogLevel:function(t){Rr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new jd.wA("firestore",function(t){return function(t,e){return new Td(t,new of(t,e),new bd)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Gd)))})(qd=m.Z),qd.registerVersion("@firebase/firestore","2.3.9");var Bd=n(9829);function Kd(t,e){return function(t,e=i.z){return new o.y(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Wd(t,e){return Kd(t,e).pipe((0,h.U)(t=>({payload:t,type:"query"})))}function zd(t,e){return Wd(t,e).pipe((0,u.O)(void 0),(0,c.G)(),(0,h.U)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function Qd(t,e,n){return zd(t,n).pipe((0,l.R)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Hd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Hd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Hd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),(0,f.x)(),(0,h.U)(t=>t.map(t=>({type:t.type,payload:t}))))}function Hd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Jd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class Yd{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=zd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe((0,h.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe((0,u.O)(void 0),(0,c.G)(),(0,d.h)(([t,e])=>e.length>0||!t),(0,h.U)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,l.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Jd(t);return Qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Wd(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,s.D)(this.query.get(t)).pipe((0,p.QV)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new Zd(this.ref.doc(t),this.afs)}}class Zd{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=rp(n,e);return new Yd(r,i,this.afs)}snapshotChanges(){return Kd(this.ref,this.afs.schedulers.outsideAngular).pipe((0,u.O)(void 0),(0,c.G)(),(0,h.U)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe((0,h.U)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return(0,s.D)(this.ref.get(t)).pipe((0,p.QV)(this.afs.schedulers.insideAngular))}}class $d{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?zd(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.filter(e=>t.indexOf(e.type)>-1)),(0,d.h)(t=>t.length>0),this.afs.keepUnstableUntilFirst):zd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe((0,l.R)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Jd(t);return Qd(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Wd(this.query,this.afs.schedulers.outsideAngular).pipe((0,h.U)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return(0,s.D)(this.query.get(t)).pipe((0,p.QV)(this.afs.schedulers.insideAngular))}}const Xd=new r.OlP("angularfire2.enableFirestorePersistence"),tp=new r.OlP("angularfire2.firestore.persistenceSettings"),ep=new r.OlP("angularfire2.firestore.settings"),np=new r.OlP("angularfire2.firestore.use-emulator");function rp(t,e=(t=>t)){return{query:e(t),ref:t}}let ip=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new y.HU(o),this.keepUnstableUntilFirst=(0,y.ss)(this.schedulers);const l=(0,y.on)(t,o,e);!g.Z.auth&&h&&(0,y.yq)();const f=c;[this.firestore,this.persistenceEnabled$]=(0,y.sI)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!(0,v.PM)(i)){const e=()=>{try{return(0,s.D)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(qd){return"undefined"!=typeof console&&console.warn(qd),(0,a.of)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,(0,a.of)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=rp(n,e),o=this.schedulers.ngZone.run(()=>r);return new Yd(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new $d(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new Zd(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(y.Dh),r.LFG(y.xv,8),r.LFG(Xd,8),r.LFG(ep,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(tp,8),r.LFG(np,8),r.LFG(Bd.Qv,8))},t.\u0275prov=r.Yz7({factory:function(){return new t(r.LFG(y.Dh),r.LFG(y.xv,8),r.LFG(Xd,8),r.LFG(ep,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(tp,8),r.LFG(np,8),r.LFG(Bd.Qv,8))},token:t,providedIn:"any"}),t})()},9192:(t,e,n)=>{"use strict";var r=n(9759),i=n(6034),o=n(4685),s=n(4762),a=n(300);t=n.hmd(t);var u="";function c(t){u=t}var h,l=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),(0,o.Pz)(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:(0,o.cI)(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),f=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return(0,o.r3)(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),d=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new l(e)}}catch(n){}return new f},p=d("localStorage"),y=d("sessionStorage"),v=new a.Yd("@firebase/database"),g=(h=1,function(){return h++}),m=function(t){var e=(0,o.dS)(t),n=new o.gQ;n.update(e);var r=n.digest();return o.US.encodeByteArray(r)},_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=_.apply(null,i):n+="object"==typeof i?(0,o.Pz)(i):i,n+=" "}return n},w=null,b=!0,T=function(t,e){(0,o.hu)(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(v.logLevel=a.in.VERBOSE,w=v.log.bind(v),e&&y.set("logging_enabled",!0)):"function"==typeof t?w=t:(w=null,y.remove("logging_enabled"))},I=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===b&&(b=!1,null===w&&!0===y.get("logging_enabled")&&T(!0)),w){var n=_.apply(null,t);w(n)}},E=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];I.apply(void 0,(0,s.ev)([t],(0,s.CR)(e)))}},C=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+_.apply(void 0,(0,s.ev)([],(0,s.CR)(t)));v.error(n)},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+_.apply(void 0,(0,s.ev)([],(0,s.CR)(t)));throw v.error(n),new Error(n)},N=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+_.apply(void 0,(0,s.ev)([],(0,s.CR)(t)));v.warn(n)},k=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},D="[MIN_NAME]",x="[MAX_NAME]",P=function(t,e){if(t===e)return 0;if(t===D||e===x)return-1;if(e===D||t===x)return 1;var n=j(t),r=j(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},A=function(t,e){return t===e?0:t<e?-1:1},R=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+(0,o.Pz)(e))},O=function(t){if("object"!=typeof t||null===t)return(0,o.Pz)(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=(0,o.Pz)(e[i]),r+=":",r+=O(t[e[i]]);return r+"}"},L=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)r.push(t.substring(i,i+e>n?n:i+e));return r};function F(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var M=function(t){var e,n,r,i,s;(0,o.hu)(!k(t),"Invalid JSON number"),0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var u=a.join(""),c="";for(s=0;s<64;s+=8){var h=parseInt(u.substr(s,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()},q=new RegExp("^-?(0*)\\d{1,10}$"),U=-2147483648,V=2147483647,j=function(t){if(q.test(t)){var e=Number(t);if(e>=U&&e<=V)return e}return null},G=function(t){try{t()}catch(e){setTimeout(function(){throw N("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},B=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},K=function(){function t(t,e){var n=this;this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then(function(t){return n.appCheck=t})}return t.prototype.getToken=function(t){var e=this;return this.appCheck?this.appCheck.getToken(t):new Promise(function(n,r){setTimeout(function(){e.appCheck?e.getToken(t).then(n,r):n(null)},0)})},t.prototype.addTokenChangeListener=function(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(function(e){return e.addTokenListener(t)})},t.prototype.notifyForInvalidToken=function(){N('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},t}(),W=function(){function t(t,e,n){var r=this;this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(function(t){return r.auth_=t})}return t.prototype.getToken=function(t){var e=this;return this.auth_?this.auth_.getToken(t).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(I("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):new Promise(function(n,r){setTimeout(function(){e.auth_?e.getToken(t).then(n,r):n(null)},0)})},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(function(e){return e.addAuthTokenListener(t)})},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then(function(e){return e.removeAuthTokenListener(t)})},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';N(t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},t}(),z=function(){function t(t){this.accessToken=t}return t.prototype.getToken=function(t){return Promise.resolve({accessToken:this.accessToken})},t.prototype.addTokenChangeListener=function(t){t(this.accessToken)},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.OWNER="owner",t}(),Q=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,H="ac",J="websocket",Y="long_polling",Z=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+t)||this._host}return t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host+"/"+(this.includeNamespaceInQueryParams?"?ns="+this.namespace:"")},t}();function $(t,e,n){var r;if((0,o.hu)("string"==typeof e,"typeof type must == string"),(0,o.hu)("object"==typeof n,"typeof params must == object"),e===J)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==Y)throw new Error("Unknown connection type: "+e);r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(n.ns=t.namespace);var i=[];return F(n,function(t,e){i.push(t+"="+e)}),r+i.join("&")}var X=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),(0,o.r3)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return(0,o.p$)(this.counters_)},t}(),tt={},et={};function nt(t){var e=t.toString();return tt[e]||(tt[e]=new X),tt[e]}var rt=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&G(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),it="start",ot="close",st="pLPCommand",at="pRTLPCB",ut=function(){function t(t,e,n,r,i,o,s){var a=this;this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=E(t),this.stats_=nt(e),this.urlFn=function(t){return a.appCheckToken&&(t[H]=a.appCheckToken),$(e,Y,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new rt(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if((0,o.Yr)()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new ct(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=(0,s.CR)(t,5),i=r[0],o=r[1],a=r[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===it)n.id=o,n.password=a;else{if(i!==ot)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=(0,s.CR)(t,2),i=r[0],o=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,o)},function(){n.onClosed_()},n.urlFn);var t={};t[it]="t",t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),n.appCheckToken&&(t[H]=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&Q.test(location.hostname)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!((0,o.Yr)()||!t.forceAllow_&&(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=(0,o.Pz)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=(0,o.h$)(e),r=L(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!(0,o.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=(0,o.Pz)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),ct=function(){function t(e,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,o.Yr)())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=g(),window[st+this.uniqueCallbackIdentifier]=e,window[at+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(s='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(u){I("frame writing exception"),u.stack&&I(u.stack),I(u)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||I("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return this.addLongPollTag_(e+=n,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;(0,o.Yr)()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){I("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))},t}(),ht=null;"undefined"!=typeof MozWebSocket?ht=MozWebSocket:"undefined"!=typeof WebSocket&&(ht=WebSocket);var lt=function(){function t(e,n,r,i,o,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=E(this.connId),this.stats_=nt(n),this.connURL=t.connectionURL_(n,s,a,i),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(t,e,n,r){var i={v:"5"};return!(0,o.Yr)()&&"undefined"!=typeof location&&location.hostname&&Q.test(location.hostname)&&(i.r="f"),e&&(i.s=e),n&&(i.ls=n),r&&(i[H]=r),$(t,J,i)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{if((0,o.Yr)()){var r={headers:{"User-Agent":"Firebase/5/"+u+"/"+process.platform+"/"+(this.nodeAdmin?"AdminNode":"Node"),"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(r.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);var i=process.env,s=0===this.connURL.indexOf("wss://")?i.HTTPS_PROXY||i.https_proxy:i.HTTP_PROXY||i.http_proxy;s&&(r.proxy={origin:s}),this.mySock=new ht(this.connURL,[],r)}else this.mySock=new ht(this.connURL,[],r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(c){this.log_("Error instantiating WebSocket.");var a=c.message||c.data;return a&&this.log_(a),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ht&&!t.forceDisallow_},t.previouslyFailed=function(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){p.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=(0,o.cI)(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if((0,o.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=(0,o.Pz)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=L(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),ft=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[ut,lt]},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,i=lt&&lt.isAvailable(),o=i&&!lt.previouslyFailed();if(e.webSocketOnly&&(i||N("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[lt];else{var a=this.transports_=[];try{for(var u=(0,s.XA)(t.ALL_TRANSPORTS),c=u.next();!c.done;c=u.next()){var h=c.value;h&&h.isAvailable()&&a.push(h)}}catch(l){n={error:l}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),dt=function(){function t(t,e,n,r,i,o,s,a,u,c){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=u,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=E("c:"+this.id+":"),this.transportManager_=new ft(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=B(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){this.sendData_({t:"d",d:t})},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=R("t",t),n=R("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=R("t",t),n=R("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=R("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?C("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):C("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&N("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),B(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):B(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),pt=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.refreshAppCheckToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),yt=function(){function t(t){this.allowedEvents_=t,this.listeners_={},(0,o.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=(0,s.ev)([],(0,s.CR)(this.listeners_[t])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){(0,o.hu)(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),vt=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,o.uI)()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return(0,s.ZT)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return(0,o.hu)("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(yt),gt=32,mt=768,_t=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t}();function wt(){return new _t("")}function bt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Tt(t){return t.pieces_.length-t.pieceNum_}function It(t){var e=t.pieceNum_;return e<t.pieces_.length&&e++,new _t(t.pieces_,e)}function Et(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Ct(t,e){return void 0===e&&(e=0),t.pieces_.slice(t.pieceNum_+e)}function St(t){if(t.pieceNum_>=t.pieces_.length)return null;for(var e=[],n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new _t(e,0)}function Nt(t,e){for(var n=[],r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof _t)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new _t(n,0)}function kt(t){return t.pieceNum_>=t.pieces_.length}function Dt(t,e){var n=bt(t),r=bt(e);if(null===n)return e;if(n===r)return Dt(It(t),It(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function xt(t,e){for(var n=Ct(t,0),r=Ct(e,0),i=0;i<n.length&&i<r.length;i++){var o=P(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Pt(t,e){if(Tt(t)!==Tt(e))return!1;for(var n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function At(t,e){var n=t.pieceNum_,r=e.pieceNum_;if(Tt(t)>Tt(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}var Rt=function(t,e){this.errorPrefix_=e,this.parts_=Ct(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,o.ug)(this.parts_[n]);Ot(this)};function Ot(t){if(t.byteLength_>mt)throw new Error(t.errorPrefix_+"has a key path longer than "+mt+" bytes ("+t.byteLength_+").");if(t.parts_.length>gt)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+gt+") or object contains a cycle "+Lt(t))}function Lt(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}var Ft,Mt,qt=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return(0,s.ZT)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return(0,o.hu)("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(yt),Ut=1e3,Vt=3e5,jt=function(t){function e(n,r,i,s,a,u,c,h){var l=t.call(this)||this;if(l.repoInfo_=n,l.applicationId_=r,l.onDataUpdate_=i,l.onConnectStatus_=s,l.onServerInfoUpdate_=a,l.authTokenProvider_=u,l.appCheckTokenProvider_=c,l.authOverride_=h,l.id=e.nextPersistentConnectionId_++,l.log_=E("p:"+l.id+":"),l.interruptReasons_={},l.listens=new Map,l.outstandingPuts_=[],l.outstandingGets_=[],l.outstandingPutCount_=0,l.outstandingGetCount_=0,l.onDisconnectRequestQueue_=[],l.connected_=!1,l.reconnectDelay_=Ut,l.maxReconnectDelay_=Vt,l.securityDebugCallback_=null,l.lastSessionId=null,l.establishConnectionTimer_=null,l.visible_=!1,l.requestCBHash_={},l.requestNumber_=0,l.realtime_=null,l.authToken_=null,l.appCheckToken_=null,l.forceTokenRefresh_=!1,l.invalidAuthTokenCount_=0,l.invalidAppCheckTokenCount_=0,l.firstConnection_=!0,l.lastConnectionAttemptTime_=null,l.lastConnectionEstablishedTime_=null,h&&!(0,o.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return qt.getInstance().on("visible",l.onVisible_,l),-1===n.host.indexOf("fblocal")&&vt.getInstance().on("online",l.onOnline_,l),l}return(0,s.ZT)(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_((0,o.Pz)(i)),(0,o.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},e.prototype.get=function(t){var e=this;this.initConnection_();var n=new o.BH,r={p:t._path.toString(),q:t._queryObject},i={action:"g",request:r,onComplete:function(t){var i=t.d;"ok"===t.s?(e.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var s=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var t=e.outstandingGets_[s];void 0!==t&&i===t&&(delete e.outstandingGets_[s],e.outstandingGetCount_--,0===e.outstandingGetCount_&&(e.outstandingGets_=[]),e.log_("get "+s+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(s),n.promise},e.prototype.listen=function(t,e,n,r){this.initConnection_();var i=t._queryIdentifier,s=t._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,o.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,o.hu)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)},e.prototype.sendGet_=function(t){var e=this,n=this.outstandingGets_[t];this.sendRequest("g",n.request,function(r){delete e.outstandingGets_[t],e.outstandingGetCount_--,0===e.outstandingGetCount_&&(e.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i};t.tag&&(s.q=r._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,u=s.s;e.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),t.onComplete&&t.onComplete(u,a))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&(0,o.r3)(t,"w")){var n=(0,o.DV)(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e._queryParams.getIndex().toString()+'"',i=e._path.toString();N("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||(0,o.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.refreshAppCheckToken=function(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=(0,o.w9)(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},e.prototype.tryAppCheck=function(){var t=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(e){var n=e.s,r=e.d||"error";"ok"===n?t.invalidAppCheckTokenCount_=0:t.onAppCheckRevoked_(n,r)})},e.prototype.unlisten=function(t,e){var n=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,o.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t._queryObject,e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){this.initConnection_();var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){"ok"!==t.s&&e.log_("reportStats","Error sending stats: "+t.d)})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+(0,o.Pz)(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):C("Unrecognized action received from server: "+(0,o.Pz)(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;(0,o.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ut),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){return(0,s.mG)(this,void 0,void 0,function(){var t,n,r,i,a,u,c,h,l,f,d,p,y,v=this;return(0,s.Jh)(this,function(g){switch(g.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+e.nextConnectionId_++,a=this.lastSessionId,u=!1,c=null,this.realtime_={close:h=function(){c?c.close():(u=!0,r())},sendRequest:function(t){(0,o.hu)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(t)}},l=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)])];case 2:return f=s.CR.apply(void 0,[g.sent(),2]),d=f[0],p=f[1],u?I("getToken() completed but was canceled"):(I("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=p&&p.token,c=new dt(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,r,function(t){N(t+" ("+v.repoInfo_.toString()+")"),v.interrupt("server_kill")},a)),[3,4];case 3:return y=g.sent(),this.log_("Failed to get token: "+y),u||(this.repoInfo_.nodeAdmin&&N(y),h()),[3,4];case 4:return[2]}})})},e.prototype.interrupt=function(t){I("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){I("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,o.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Ut,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return O(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new _t(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){I("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onAppCheckRevoked_=function(t,e){I("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=(0,s.XA)(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var u=(n=void 0,(0,s.XA)(a.values())),c=u.next();!c.done;c=u.next())this.sendListen_(c.value)}catch(f){n={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}for(h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},e.prototype.sendConnectStats_=function(){var t={},e="js";(0,o.Yr)()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+u.replace(/\./g,"-")]=1,(0,o.uI)()?t["framework.cordova"]=1:(0,o.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=vt.getInstance().currentlyOnline();return(0,o.xb)(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(pt),Gt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),Bt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new Gt(D,t),r=new Gt(D,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return Gt.MIN},t}(),Kt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Ft},set:function(t){Ft=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return P(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw(0,o.g5)("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return Gt.MIN},e.prototype.maxPost=function(){return new Gt(x,Ft)},e.prototype.makePost=function(t,e){return(0,o.hu)("string"==typeof t,"KeyIndex indexValue must always be a string."),new Gt(t,Ft)},e.prototype.toString=function(){return".key"},e}(Bt),Wt=new Kt,zt=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Qt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Jt.EMPTY_NODE,this.right=null!=o?o:Jt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Jt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Jt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Ht=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Qt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Jt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Qt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Qt.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new zt(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new zt(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new zt(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new zt(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Ht,t}();function Yt(t,e){return P(t.name,e.name)}function Zt(t,e){return P(t,e)}var $t,Xt,te,ee,ne,re=function(t){return"number"==typeof t?"number:"+M(t):"string:"+t},ie=function(t){if(t.isLeafNode()){var e=t.val();(0,o.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,o.r3)(e,".sv"),"Priority must be a string or number.")}else(0,o.hu)(t===Mt||t.isEmpty(),"priority of unexpected type.");(0,o.hu)(t===Mt||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},oe=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,(0,o.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),ie(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return $t},set:function(t){$t=t},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return kt(e)?this:".priority"===bt(e)?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=bt(e);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,o.hu)(".priority"!==r||1===Tt(e),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(It(e),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+re(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?M(this.value_):this.value_,this.lazyHash_=m(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:((0,o.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,i=t.VALUE_TYPE_ORDER.indexOf(n),s=t.VALUE_TYPE_ORDER.indexOf(r);return(0,o.hu)(i>=0,"Unknown leaf type: "+n),(0,o.hu)(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){return t===this||!!t.isLeafNode()&&this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),se=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?P(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return Gt.MIN},e.prototype.maxPost=function(){return new Gt(x,new oe("[PRIORITY-POST]",te))},e.prototype.makePost=function(t,e){var n=Xt(t);return new Gt(e,new oe("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(Bt)),ae=Math.log(2),ue=function(){function t(t){this.count=parseInt(Math.log(t+1)/ae,10),this.current_=this.count-1;var e=parseInt(Array(this.count+1).join("1"),2);this.bits_=t+1&e}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),ce=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,s,a=r-e;if(0===a)return null;if(1===a)return o=t[e],s=n?n(o):o,new Qt(s,o.node,Qt.BLACK,null,null);var u=parseInt(a/2,10)+e,c=i(e,u),h=i(u+1,r);return o=t[u],s=n?n(o):o,new Qt(s,o.node,Qt.BLACK,c,h)},o=function(e){for(var r=null,o=null,s=t.length,a=function(e,r){var o=s-e,a=s;s-=e;var c=i(o+1,a),h=t[o],l=n?n(h):h;u(new Qt(l,h.node,r,null,c))},u=function(t){r?(r.left=t,r=t):(o=t,r=t)},c=0;c<e.count;++c){var h=e.nextBitIsOne(),l=Math.pow(2,e.count-(c+1));h?a(l,Qt.BLACK):(a(l,Qt.BLACK),a(l,Qt.RED))}return o}(new ue(t.length));return new Jt(r||e,o)},he={},le=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return(0,o.hu)(he&&se,"ChildrenNode.ts has not been loaded"),ee=ee||new t({".priority":he},{".priority":se})},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=(0,o.DV)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Jt?e:null},t.prototype.hasIndex=function(t){return(0,o.r3)(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){(0,o.hu)(e!==Wt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],a=!1,u=n.getIterator(Gt.Wrap),c=u.getNext();c;)a=a||e.isDefinedOn(c.node),i.push(c),c=u.getNext();r=a?ce(i,e.getCompare()):he;var h=e.toString(),l=(0,s.pi)({},this.indexSet_);l[h]=e;var f=(0,s.pi)({},this.indexes_);return f[h]=r,new t(f,l)},t.prototype.addToIndexes=function(e,n){var r=this;return new t((0,o.UI)(this.indexes_,function(t,i){var s=(0,o.DV)(r.indexSet_,i);if((0,o.hu)(s,"Missing index implementation for "+i),t===he){if(s.isDefinedOn(e.node)){for(var a=[],u=n.getIterator(Gt.Wrap),c=u.getNext();c;)c.name!==e.name&&a.push(c),c=u.getNext();return a.push(e),ce(a,s.getCompare())}return he}var h=n.get(e.name),l=t;return h&&(l=l.remove(new Gt(e.name,h))),l.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t((0,o.UI)(this.indexes_,function(t){if(t===he)return t;var r=n.get(e.name);return r?t.remove(new Gt(e.name,r)):t}),this.indexSet_)},t}(),fe=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ie(this.priorityNode_),this.children_.isEmpty()&&(0,o.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return ne||(ne=new t(new Jt(Zt),null,le.Default))},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||ne},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?ne:e},t.prototype.getChild=function(t){var e=bt(t);return null===e?this:this.getImmediateChild(e).getChild(It(t))},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if((0,o.hu)(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new Gt(e,n),i=void 0,s=void 0;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?ne:this.priorityNode_;return new t(i,a,s)},t.prototype.updateChild=function(t,e){var n=bt(t);if(null===n)return e;(0,o.hu)(".priority"!==bt(t)||1===Tt(t),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(It(t),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(se,function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+re(this.getPriority().val())+":"),this.forEachChild(se,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":m(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Gt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Gt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Gt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Gt.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Gt.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===de?-1:0},t.prototype.withIndex=function(e){if(e===Wt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===Wt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(se),r=e.getIterator(se),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===Wt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),de=new(function(t){function e(){return t.call(this,new Jt(Zt),fe.EMPTY_NODE,le.Default)||this}return(0,s.ZT)(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return fe.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(fe));Object.defineProperties(Gt,{MIN:{value:new Gt(D,fe.EMPTY_NODE)},MAX:{value:new Gt(x,de)}}),Kt.__EMPTY_NODE=fe.EMPTY_NODE,oe.__childrenNodeConstructor=fe,Mt=de,te=de;var pe=!0;function ye(t,e){if(void 0===e&&(e=null),null===t)return fe.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),(0,o.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new oe(t,ye(e));if(t instanceof Array||!pe){var n=fe.EMPTY_NODE;return F(t,function(e,r){if((0,o.r3)(t,e)&&"."!==e.substring(0,1)){var i=ye(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(e,i))}}),n.updatePriority(ye(e))}var r=[],i=!1;if(F(t,function(t,e){if("."!==t.substring(0,1)){var n=ye(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Gt(t,n)))}}),0===r.length)return fe.EMPTY_NODE;var s=ce(r,Yt,function(t){return t.name},Zt);if(i){var a=ce(r,se.getCompare());return new fe(s,ye(e),new le({".priority":a},{".priority":se}))}return new fe(s,ye(e),le.Default)}Xt=ye;var ve,ge,me=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,(0,o.hu)(!kt(e)&&".priority"!==bt(e),"Can't create PathIndex with empty path or .priority key"),n}return(0,s.ZT)(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?P(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=ye(t),r=fe.EMPTY_NODE.updateChild(this.indexPath_,n);return new Gt(e,r)},e.prototype.maxPost=function(){var t=fe.EMPTY_NODE.updateChild(this.indexPath_,de);return new Gt(x,t)},e.prototype.toString=function(){return Ct(this.indexPath_,0).join("/")},e}(Bt),_e=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?P(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return Gt.MIN},e.prototype.maxPost=function(){return Gt.MAX},e.prototype.makePost=function(t,e){var n=ye(t);return new Gt(e,n)},e.prototype.toString=function(){return".value"},e}(Bt)),we="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",be=(ve=0,ge=[],function(t){var e,n=t===ve;ve=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=we.charAt(t%64),t=Math.floor(t/64);(0,o.hu)(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;e>=0&&63===ge[e];e--)ge[e]=0;ge[e]++}else for(e=0;e<12;e++)ge[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=we.charAt(ge[e]);return(0,o.hu)(20===i.length,"nextPushId: Length should be 20."),i}),Te=function(t){if(t===""+V)return"-";var e=j(t);if(null!=e)return""+(e+1);for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return x;var o=we.charAt(we.indexOf(n[i])+1);return n[i]=o,n.slice(0,i+1).join("")},Ie=function(t){if(t===""+U)return D;var e=j(t);if(null!=e)return""+(e-1);for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t.charAt(r);return"-"===n[n.length-1]?1===n.length?""+V:(delete n[n.length-1],n.join("")):(n[n.length-1]=we.charAt(we.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function Ee(t){return{type:"value",snapshotNode:t}}function Ce(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Se(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Ne(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}var ke=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,s){(0,o.hu)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=s&&(n.isEmpty()?t.hasChild(e)?s.trackChildChange(Se(e,a)):(0,o.hu)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(Ce(e,n)):s.trackChildChange(Ne(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(se,function(t,r){e.hasChild(t)||n.trackChildChange(Se(t,r))}),e.isLeafNode()||e.forEachChild(se,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(Ne(e,r,i))}else n.trackChildChange(Ce(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?fe.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),De=function(){function t(e){this.indexedFilter_=new ke(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Gt(e,n))||(n=fe.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=fe.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(fe.EMPTY_NODE);var i=this;return e.forEachChild(se,function(t,e){i.matches(new Gt(t,e))||(r=r.updateImmediateChild(t,fe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),xe=function(){function t(t){this.rangedFilter_=new De(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Gt(e,n))||(n=fe.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=fe.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=fe.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(fe.EMPTY_NODE);var a=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)s=i.getNext(),!l&&c(a,s)<=0&&(l=!0),l&&o<this.limit_&&c(s,u)<=0?o++:r=r.updateImmediateChild(s.name,fe.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(t,e){return a(e,t)}}else s=this.index_.getCompare();var u=t;(0,o.hu)(u.numChildren()===this.limit_,"");var c=new Gt(e,n),h=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),l=this.rangedFilter_.matches(c);if(u.hasChild(e)){for(var f=u.getImmediateChild(e),d=r.getChildAfterChild(this.index_,h,this.reverse_);null!=d&&(d.name===e||u.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);var p=null==d?1:s(d,c);if(l&&!n.isEmpty()&&p>=0)return null!=i&&i.trackChildChange(Ne(e,n,f)),u.updateImmediateChild(e,n);null!=i&&i.trackChildChange(Se(e,f));var y=u.updateImmediateChild(e,fe.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(Ce(d.name,d.node)),y.updateImmediateChild(d.name,d.node)):y}return n.isEmpty()?t:l&&s(h,c)>=0?(null!=i&&(i.trackChildChange(Se(h.name,h.node)),i.trackChildChange(Ce(e,n))),u.updateImmediateChild(e,n).updateImmediateChild(h.name,fe.EMPTY_NODE)):t},t}(),Pe=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=se}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.hasStartAfter=function(){return this.startAfterSet_},t.prototype.hasEndBefore=function(){return this.endBeforeSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},t.prototype.getIndexStartValue=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:D},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:x},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return(0,o.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===se},t.prototype.copy=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t}();function Ae(t,e,n){var r=t.copy();return r.startSet_=!0,void 0===e&&(e=null),r.indexStartValue_=e,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Re(t,e,n){var r=t.copy();return r.endSet_=!0,void 0===e&&(e=null),r.indexEndValue_=e,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Oe(t,e){var n=t.copy();return n.index_=e,n}function Le(t){var e,n={};return t.isDefault()||(t.index_===se?e="$priority":t.index_===_e?e="$value":t.index_===Wt?e="$key":((0,o.hu)(t.index_ instanceof me,"Unrecognized index type!"),e=t.index_.toString()),n.orderBy=(0,o.Pz)(e),t.startSet_&&(n.startAt=(0,o.Pz)(t.indexStartValue_),t.startNameSet_&&(n.startAt+=","+(0,o.Pz)(t.indexStartName_))),t.endSet_&&(n.endAt=(0,o.Pz)(t.indexEndValue_),t.endNameSet_&&(n.endAt+=","+(0,o.Pz)(t.indexEndName_))),t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_)),n}function Fe(t){var e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_)),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_)),t.limitSet_){e.l=t.limit_;var n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==se&&(e.i=t.index_.toString()),e}var Me=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.repoInfo_=e,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=E("p:rest:"),o.listens_={},o}return(0,s.ZT)(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:((0,o.hu)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())},e.prototype.listen=function(t,n,r,i){var s=this,a=t._path.toString();this.log_("Listen called for "+a+" "+t._queryIdentifier);var u=e.getListenId_(t,r),c={};this.listens_[u]=c;var h=Le(t._queryParams);this.restRequest_(a+".json",h,function(t,e){var n=e;404===t&&(n=null,t=null),null===t&&s.onDataUpdate_(a,n,!1,r),(0,o.DV)(s.listens_,u)===c&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.get=function(t){var e=this,n=Le(t._queryParams),r=t._path.toString(),i=new o.BH;return this.restRequest_(r+".json",n,function(t,n){var o=n;404===t&&(o=null,t=null),null===t?(e.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))}),i.promise},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;return void 0===e&&(e={}),e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(i){var a=(0,s.CR)(i,2),u=a[0],c=a[1];u&&u.accessToken&&(e.auth=u.accessToken),c&&c.token&&(e.ac=c.token);var h=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+(0,o.xO)(e);r.log_("Sending REST request for "+h);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(n&&4===l.readyState){r.log_("REST Response for "+h+" received. status:",l.status,"response:",l.responseText);var t=null;if(l.status>=200&&l.status<300){try{t=(0,o.cI)(l.responseText)}catch(e){N("Failed to parse JSON response for "+h+": "+l.responseText)}n(null,t)}else 401!==l.status&&404!==l.status&&N("Got unsuccessful REST response for "+h+" Status: "+l.status),n(l.status);n=null}},l.open("GET",h,!0),l.send()})},e}(pt),qe=function(){function t(){this.rootNode_=fe.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}();function Ue(){return{value:null,children:new Map}}function Ve(t,e,n){if(kt(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{var r=bt(e);t.children.has(r)||t.children.set(r,Ue()),Ve(t.children.get(r),e=It(e),n)}}function je(t,e){if(kt(e))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var n=t.value;return t.value=null,n.forEachChild(se,function(e,n){Ve(t,new _t(e),n)}),je(t,e)}if(t.children.size>0){var r=bt(e);return e=It(e),t.children.has(r)&&je(t.children.get(r),e)&&t.children.delete(r),0===t.children.size}return!0}function Ge(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(function(t,n){e(n,t)})}(t,function(t,r){Ge(r,new _t(e.toString()+"/"+t),n)})}var Be=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=(0,s.pi)({},t);return this.last_&&F(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),Ke=1e4,We=3e4,ze=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Be(t);var n=Ke+(We-Ke)*Math.random();B(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;F(e,function(e,i){i>0&&(0,o.r3)(t.statsToReport_,e)&&(n[e]=i,r=!0)}),r&&this.server_.reportStats(n),B(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Qe=(()=>(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Qe||(Qe={})),Qe))();function He(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var Je,Ye=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Qe.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return t.prototype.operationForChild=function(e){if(kt(this.path)){if(null!=this.affectedTree.value)return(0,o.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new _t(e));return new t(wt(),n,this.revert)}return(0,o.hu)(bt(this.path)===e,"operationForChild called for unrelated child."),new t(It(this.path),this.affectedTree,this.revert)},t}(),Ze=function(){function t(t,e){this.source=t,this.path=e,this.type=Qe.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return kt(this.path)?new t(this.source,wt()):new t(this.source,It(this.path))},t}(),$e=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Qe.OVERWRITE}return t.prototype.operationForChild=function(e){return kt(this.path)?new t(this.source,wt(),this.snap.getImmediateChild(e)):new t(this.source,It(this.path),this.snap)},t}(),Xe=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Qe.MERGE}return t.prototype.operationForChild=function(e){if(kt(this.path)){var n=this.children.subtree(new _t(e));return n.isEmpty()?null:n.value?new $e(this.source,wt(),n.value):new t(this.source,wt(),n)}return(0,o.hu)(bt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,It(this.path),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),tn=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(kt(t))return this.isFullyInitialized()&&!this.filtered_;var e=bt(t);return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),en=function(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()};function nn(t,e,n,r,i,s){var a=r.filter(function(t){return t.type===n});a.sort(function(e,n){return function(t,e,n){if(null==e.childName||null==n.childName)throw(0,o.g5)("Should only compare child_ events.");var r=new Gt(e.childName,e.snapshotNode),i=new Gt(n.childName,n.snapshotNode);return t.index_.compare(r,i)}(t,e,n)}),a.forEach(function(n){var r=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,s);i.forEach(function(i){i.respondsTo(n.type)&&e.push(i.createEvent(r,t.query_))})})}function rn(t,e){return{eventCache:t,serverCache:e}}function on(t,e,n,r){return rn(new tn(e,n,r),t.serverCache)}function sn(t,e,n,r){return rn(t.eventCache,new tn(e,n,r))}function an(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function un(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var cn=function(){return Je||(Je=new Jt(A)),Je},hn=function(){function t(t,e){void 0===e&&(e=cn()),this.value=t,this.children=e}return t.fromObject=function(e){var n=new t(null);return F(e,function(t,e){n=n.set(new _t(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:wt(),value:this.value};if(kt(t))return null;var n=bt(t),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(It(t),e);return null!=i?{path:Nt(new _t(n),i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(kt(e))return this;var n=bt(e),r=this.children.get(n);return null!==r?r.subtree(It(e)):new t(null)},t.prototype.set=function(e,n){if(kt(e))return new t(n,this.children);var r=bt(e),i=(this.children.get(r)||new t(null)).set(It(e),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(kt(e))return this.children.isEmpty()?new t(null):new t(null,this.children);var n=bt(e),r=this.children.get(n);if(r){var i=r.remove(It(e)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new t(null):new t(this.value,o)}return this},t.prototype.get=function(t){if(kt(t))return this.value;var e=bt(t),n=this.children.get(e);return n?n.get(It(t)):null},t.prototype.setTree=function(e,n){if(kt(e))return n;var r,i=bt(e),o=(this.children.get(i)||new t(null)).setTree(It(e),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(wt(),t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(Nt(t,r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,wt(),e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(kt(t))return null;var i=bt(t),o=this.children.get(i);return o?o.findOnPath_(It(t),Nt(e,i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,wt(),e)},t.prototype.foreachOnPath_=function(e,n,r){if(kt(e))return this;this.value&&r(n,this.value);var i=bt(e),o=this.children.get(i);return o?o.foreachOnPath_(It(e),Nt(n,i),r):new t(null)},t.prototype.foreach=function(t){this.foreach_(wt(),t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(Nt(t,n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t}(),ln=function(){function t(t){this.writeTree_=t}return t.empty=function(){return new t(new hn(null))},t}();function fn(t,e,n){if(kt(e))return new ln(new hn(n));var r=t.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=Dt(i,e);return o=o.updateChild(s,n),new ln(t.writeTree_.set(i,o))}var a=new hn(n),u=t.writeTree_.setTree(e,a);return new ln(u)}function dn(t,e,n){var r=t;return F(n,function(t,n){r=fn(r,Nt(e,t),n)}),r}function pn(t,e){if(kt(e))return ln.empty();var n=t.writeTree_.setTree(e,new hn(null));return new ln(n)}function yn(t,e){return null!=vn(t,e)}function vn(t,e){var n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(Dt(n.path,e)):null}function gn(t){var e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(se,function(t,n){e.push(new Gt(t,n))}):t.writeTree_.children.inorderTraversal(function(t,n){null!=n.value&&e.push(new Gt(t,n.value))}),e}function mn(t,e){if(kt(e))return t;var n=vn(t,e);return new ln(null!=n?new hn(n):t.writeTree_.subtree(e))}function _n(t){return t.writeTree_.isEmpty()}function wn(t,e){return bn(wt(),t.writeTree_,e)}function bn(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);var r=null;return e.children.inorderTraversal(function(e,i){".priority"===e?((0,o.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=bn(Nt(t,e),i,n)}),n.getChild(t).isEmpty()||null===r||(n=n.updateChild(Nt(t,".priority"),r)),n}function Tn(t,e){return Rn(e,t)}function In(t,e){if(t.snap)return At(t.path,e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&At(Nt(t.path,n),e))return!0;return!1}function En(t){return t.visible}function Cn(t,e,n){for(var r=ln.empty(),i=0;i<t.length;++i){var s=t[i];if(e(s)){var a=s.path,u=void 0;if(s.snap)At(n,a)?r=fn(r,u=Dt(n,a),s.snap):At(a,n)&&(u=Dt(a,n),r=fn(r,wt(),s.snap.getChild(u)));else{if(!s.children)throw(0,o.g5)("WriteRecord should have .snap or .children");if(At(n,a))r=dn(r,u=Dt(n,a),s.children);else if(At(a,n))if(kt(u=Dt(a,n)))r=dn(r,wt(),s.children);else{var c=(0,o.DV)(s.children,bt(u));if(c){var h=c.getChild(It(u));r=fn(r,wt(),h)}}}}}return r}function Sn(t,e,n,r,i){if(r||i){var o=mn(t.visibleWrites,e);return!i&&_n(o)?n:i||null!=n||yn(o,wt())?wn(Cn(t.allWrites,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(At(t.path,e)||At(e,t.path))},e),n||fe.EMPTY_NODE):null}var s=vn(t.visibleWrites,e);if(null!=s)return s;var a=mn(t.visibleWrites,e);return _n(a)?n:null!=n||yn(a,wt())?wn(a,n||fe.EMPTY_NODE):null}function Nn(t,e,n,r){return Sn(t.writeTree,t.treePath,e,n,r)}function kn(t,e){return function(t,e,n){var r=fe.EMPTY_NODE,i=vn(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(se,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(n){var o=mn(t.visibleWrites,e);return n.forEachChild(se,function(t,e){var n=wn(mn(o,new _t(t)),e);r=r.updateImmediateChild(t,n)}),gn(o).forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return gn(mn(t.visibleWrites,e)).forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}(t.writeTree,t.treePath,e)}function Dn(t,e,n,r){return function(t,e,n,r,i){(0,o.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=Nt(e,n);if(yn(t.visibleWrites,s))return null;var a=mn(t.visibleWrites,s);return _n(a)?i.getChild(n):wn(a,i.getChild(n))}(t.writeTree,t.treePath,e,n,r)}function xn(t,e){return function(t,e){return vn(t.visibleWrites,e)}(t.writeTree,Nt(t.treePath,e))}function Pn(t,e,n){return function(t,e,n,r){var i=Nt(e,n),o=vn(t.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?wn(mn(t.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(t.writeTree,t.treePath,e,n)}function An(t,e){return Rn(Nt(t.treePath,e),t.writeTree)}function Rn(t,e){return{treePath:t,writeTree:e}}var On=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;(0,o.hu)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),(0,o.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===e&&"child_removed"===i)this.changeMap.set(n,Ne(n,t.snapshotNode,r.snapshotNode));else if("child_removed"===e&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===e&&"child_changed"===i)this.changeMap.set(n,Se(n,r.oldSnap));else if("child_changed"===e&&"child_added"===i)this.changeMap.set(n,Ce(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==i)throw(0,o.g5)("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,Ne(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),Ln=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),Fn=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new tn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Pn(this.writes_,t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:un(this.viewCache_),i=function(t,e,n,r,i,o){return function(t,e,n,r,i,o,s){var a,u=mn(t.visibleWrites,e),c=vn(u,wt());if(null!=c)a=c;else{if(null==n)return[];a=wn(u,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var h=[],l=s.getCompare(),f=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),d=f.getNext();d&&h.length<1;)0!==l(d,r)&&h.push(d),d=f.getNext();return h}(t.writeTree,t.treePath,e,n,0,i,o)}(this.writes_,r,e,0,n,t);return 0===i.length?null:i[0]},t}();function Mn(t,e,n,r,i,s){var a=e.eventCache;if(null!=xn(r,n))return e;var u=void 0,c=void 0;if(kt(n))if((0,o.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){var h=un(e),l=kn(r,h instanceof fe?h:fe.EMPTY_NODE);u=t.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{var f=Nn(r,un(e));u=t.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{var d=bt(n);if(".priority"===d){(0,o.hu)(1===Tt(n),"Can't have a priority with additional path components");var p=a.getNode(),y=Dn(r,n,p,c=e.serverCache.getNode());u=null!=y?t.filter.updatePriority(p,y):a.getNode()}else{var v=It(n),g=void 0;if(a.isCompleteForChild(d)){c=e.serverCache.getNode();var m=Dn(r,n,a.getNode(),c);g=null!=m?a.getNode().getImmediateChild(d).updateChild(v,m):a.getNode().getImmediateChild(d)}else g=Pn(r,d,e.serverCache);u=null!=g?t.filter.updateChild(a.getNode(),d,g,v,i,s):a.getNode()}}return on(e,u,a.isFullyInitialized()||kt(n),t.filter.filtersNodes())}function qn(t,e,n,r,i,o,s,a){var u,c=e.serverCache,h=s?t.filter:t.filter.getIndexedFilter();if(kt(n))u=h.updateFullNode(c.getNode(),r,null);else if(h.filtersNodes()&&!c.isFiltered()){var l=c.getNode().updateChild(n,r);u=h.updateFullNode(c.getNode(),l,null)}else{var f=bt(n);if(!c.isCompleteForPath(n)&&Tt(n)>1)return e;var d=It(n),p=c.getNode().getImmediateChild(f).updateChild(d,r);u=".priority"===f?h.updatePriority(c.getNode(),p):h.updateChild(c.getNode(),f,p,d,Ln,null)}var y=sn(e,u,c.isFullyInitialized()||kt(n),h.filtersNodes());return Mn(t,y,n,i,new Fn(i,y,o),a)}function Un(t,e,n,r,i,o,s){var a,u,c=e.eventCache,h=new Fn(i,e,o);if(kt(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,s),a=on(e,u,!0,t.filter.filtersNodes());else{var l=bt(n);if(".priority"===l)u=t.filter.updatePriority(e.eventCache.getNode(),r),a=on(e,u,c.isFullyInitialized(),c.isFiltered());else{var f=It(n),d=c.getNode().getImmediateChild(l),p=void 0;if(kt(f))p=r;else{var y=h.getCompleteChild(l);p=null!=y?".priority"===Et(f)&&y.getChild(St(f)).isEmpty()?y:y.updateChild(f,r):fe.EMPTY_NODE}a=d.equals(p)?e:on(e,t.filter.updateChild(c.getNode(),l,p,f,h,s),c.isFullyInitialized(),t.filter.filtersNodes())}}return a}function Vn(t,e){return t.eventCache.isCompleteForChild(e)}function jn(t,e,n){return n.foreach(function(t,n){e=e.updateChild(t,n)}),e}function Gn(t,e,n,r,i,o,s,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;var u,c=e;u=kt(n)?r:new hn(null).setTree(n,r);var h=e.serverCache.getNode();return u.children.inorderTraversal(function(n,r){if(h.hasChild(n)){var u=jn(0,e.serverCache.getNode().getImmediateChild(n),r);c=qn(t,c,new _t(n),u,i,o,s,a)}}),u.children.inorderTraversal(function(n,r){var u=!e.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!h.hasChild(n)&&!u){var l=jn(0,e.serverCache.getNode().getImmediateChild(n),r);c=qn(t,c,new _t(n),l,i,o,s,a)}}),c}var Bn,Kn=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n,r=this.query_._queryParams,i=new ke(r.getIndex()),o=(n=r).loadsAllData()?new ke(n.getIndex()):n.hasLimit()?new xe(n):new De(n);this.processor_=function(t){return{filter:t}}(o);var s=e.serverCache,a=e.eventCache,u=i.updateFullNode(fe.EMPTY_NODE,s.getNode(),null),c=o.updateFullNode(fe.EMPTY_NODE,a.getNode(),null),h=new tn(u,s.isFullyInitialized(),i.filtersNodes()),l=new tn(c,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=rn(l,h),this.eventGenerator_=new en(this.query_)}return Object.defineProperty(t.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),t}();function Wn(t,e){var n=un(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!kt(e)&&!n.getImmediateChild(bt(e)).isEmpty())?n.getChild(e):null}function zn(t){return 0===t.eventRegistrations_.length}function Qn(t,e,n){var r=[];if(n){(0,o.hu)(null==e,"A cancel should cancel all event registrations.");var i=t.query._path;t.eventRegistrations_.forEach(function(t){var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(e){for(var s=[],a=0;a<t.eventRegistrations_.length;++a){var u=t.eventRegistrations_[a];if(u.matches(e)){if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(a+1));break}}else s.push(u)}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Hn(t,e,n,r){e.type===Qe.MERGE&&null!==e.source.queryId&&((0,o.hu)(un(t.viewCache_),"We should always have a full cache before handling merges"),(0,o.hu)(an(t.viewCache_),"Missing event cache, even though we have a server cache"));var i,s,a=t.viewCache_,u=function(t,e,n,r,i){var s,a,u=new On;if(n.type===Qe.OVERWRITE){var c=n;c.source.fromUser?s=Un(t,e,c.path,c.snap,r,i,u):((0,o.hu)(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!kt(c.path),s=qn(t,e,c.path,c.snap,r,i,a,u))}else if(n.type===Qe.MERGE){var h=n;h.source.fromUser?s=function(t,e,n,r,i,o,s){var a=e;return r.foreach(function(r,u){var c=Nt(n,r);Vn(e,bt(c))&&(a=Un(t,a,c,u,i,o,s))}),r.foreach(function(r,u){var c=Nt(n,r);Vn(e,bt(c))||(a=Un(t,a,c,u,i,o,s))}),a}(t,e,h.path,h.children,r,i,u):((0,o.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),s=Gn(t,e,h.path,h.children,r,i,a,u))}else if(n.type===Qe.ACK_USER_WRITE){var l=n;s=l.revert?function(t,e,n,r,i,s){var a;if(null!=xn(r,n))return e;var u=new Fn(r,e,i),c=e.eventCache.getNode(),h=void 0;if(kt(n)||".priority"===bt(n)){var l=void 0;if(e.serverCache.isFullyInitialized())l=Nn(r,un(e));else{var f=e.serverCache.getNode();(0,o.hu)(f instanceof fe,"serverChildren would be complete if leaf node"),l=kn(r,f)}h=t.filter.updateFullNode(c,l,s)}else{var d=bt(n),p=Pn(r,d,e.serverCache);null==p&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),(h=null!=p?t.filter.updateChild(c,d,p,It(n),u,s):e.eventCache.getNode().hasChild(d)?t.filter.updateChild(c,d,fe.EMPTY_NODE,It(n),u,s):c).isEmpty()&&e.serverCache.isFullyInitialized()&&(a=Nn(r,un(e))).isLeafNode()&&(h=t.filter.updateFullNode(h,a,s))}return a=e.serverCache.isFullyInitialized()||null!=xn(r,wt()),on(e,h,a,t.filter.filtersNodes())}(t,e,l.path,r,i,u):function(t,e,n,r,i,o,s){if(null!=xn(i,n))return e;var a=e.serverCache.isFiltered(),u=e.serverCache;if(null!=r.value){if(kt(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return qn(t,e,n,u.getNode().getChild(n),i,o,a,s);if(kt(n)){var c=new hn(null);return u.getNode().forEachChild(Wt,function(t,e){c=c.set(new _t(t),e)}),Gn(t,e,n,c,i,o,a,s)}return e}var h=new hn(null);return r.foreach(function(t,e){var r=Nt(n,t);u.isCompleteForPath(r)&&(h=h.set(t,u.getNode().getChild(r)))}),Gn(t,e,n,h,i,o,a,s)}(t,e,l.path,l.affectedTree,r,i,u)}else{if(n.type!==Qe.LISTEN_COMPLETE)throw(0,o.g5)("Unknown operation type: "+n.type);s=function(t,e,n,r,i){var o=e.serverCache;return Mn(t,sn(e,o.getNode(),o.isFullyInitialized()||kt(n),o.isFiltered()),n,r,Ln,i)}(t,e,n.path,r,u)}var f=u.getChanges();return function(t,e,n){var r=e.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=an(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ee(an(e)))}}(e,s,f),{viewCache:s,changes:f}}(t.processor_,a,e,n,r);return i=t.processor_,(0,o.hu)((s=u.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,o.hu)(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,o.hu)(u.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=u.viewCache,Jn(t,u.changes,u.viewCache.eventCache.getNode(),null)}function Jn(t,e,n,r){return function(t,e,n,r){var i=[],o=[];return e.forEach(function(e){"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push({type:"child_moved",snapshotNode:e.snapshotNode,childName:e.childName})}),nn(t,i,"child_removed",e,r,n),nn(t,i,"child_added",e,r,n),nn(t,i,"child_moved",o,r,n),nn(t,i,"child_changed",e,r,n),nn(t,i,"value",e,r,n),i}(t.eventGenerator_,e,n,r?[r]:t.eventRegistrations_)}var Yn,Zn=function(){this.views=new Map};function $n(t,e,n,r){var i,a,u=e.source.queryId;if(null!==u){var c=t.views.get(u);return(0,o.hu)(null!=c,"SyncTree gave us an op for an invalid query."),Hn(c,e,n,r)}var h=[];try{for(var l=(0,s.XA)(t.views.values()),f=l.next();!f.done;f=l.next())h=h.concat(Hn(c=f.value,e,n,r))}catch(d){i={error:d}}finally{try{f&&!f.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}return h}function Xn(t,e,n,r,i){var o=t.views.get(e._queryIdentifier);if(!o){var s=Nn(n,i?r:null),a=!1;s?a=!0:r instanceof fe?(s=kn(n,r),a=!1):(s=fe.EMPTY_NODE,a=!1);var u=rn(new tn(s,a,!1),new tn(r,i,!1));return new Kn(e,u)}return o}function tr(t){var e,n,r=[];try{for(var i=(0,s.XA)(t.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function er(t,e){var n,r,i=null;try{for(var o=(0,s.XA)(t.views.values()),a=o.next();!a.done;a=o.next())i=i||Wn(a.value,e)}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function nr(t,e){return e._queryParams.loadsAllData()?or(t):t.views.get(e._queryIdentifier)}function rr(t,e){return null!=nr(t,e)}function ir(t){return null!=or(t)}function or(t){var e,n;try{for(var r=(0,s.XA)(t.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null}var sr=1,ar=function(t){this.listenProvider_=t,this.syncPointTree_=new hn(null),this.pendingWriteTree_={visibleWrites:ln.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function ur(t,e,n,r,i){return function(t,e,n,r,i){(0,o.hu)(r>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=fn(t.visibleWrites,e,n)),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r,i),i?pr(t,new $e({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,n)):[]}function cr(t,e,n){void 0===n&&(n=!1);var r=function(t,e){for(var n=0;n<t.allWrites.length;n++){var r=t.allWrites[n];if(r.writeId===e)return r}return null}(t.pendingWriteTree_,e);if(function(t,e){var n=t.allWrites.findIndex(function(t){return t.writeId===e});(0,o.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=t.allWrites[n];t.allWrites.splice(n,1);for(var i=r.visible,s=!1,a=t.allWrites.length-1;i&&a>=0;){var u=t.allWrites[a];u.visible&&(a>=n&&In(u,r.path)?i=!1:At(r.path,u.path)&&(s=!0)),a--}return!!i&&(s?(function(t){t.visibleWrites=Cn(t.allWrites,En,wt()),t.lastWriteId=t.allWrites.length>0?t.allWrites[t.allWrites.length-1].writeId:-1}(t),!0):(r.snap?t.visibleWrites=pn(t.visibleWrites,r.path):F(r.children,function(e){t.visibleWrites=pn(t.visibleWrites,Nt(r.path,e))}),!0))}(t.pendingWriteTree_,e)){var i=new hn(null);return null!=r.snap?i=i.set(wt(),!0):F(r.children,function(t){i=i.set(new _t(t),!0)}),pr(t,new Ye(r.path,i,n))}return[]}function hr(t,e,n){return pr(t,new $e({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function lr(t,e,n,r){var i=e._path,a=t.syncPointTree_.get(i),u=[];if(a&&("default"===e._queryIdentifier||rr(a,e))){var c=function(t,e,n,r){var i,a,u=e._queryIdentifier,c=[],h=[],l=ir(t);if("default"===u)try{for(var f=(0,s.XA)(t.views.entries()),d=f.next();!d.done;d=f.next()){var p,y=(0,s.CR)(d.value,2),v=y[0];h=h.concat(Qn(p=y[1],n,r)),zn(p)&&(t.views.delete(v),p.query._queryParams.loadsAllData()||c.push(p.query))}}catch(g){i={error:g}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}else(p=t.views.get(u))&&(h=h.concat(Qn(p,n,r)),zn(p)&&(t.views.delete(u),p.query._queryParams.loadsAllData()||c.push(p.query)));return l&&!ir(t)&&c.push(new((0,o.hu)(Bn,"Reference.ts has not been loaded"),Bn)(e._repo,e._path)),{removed:c,events:h}}(a,e,n,r);0===a.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(i));var h=c.removed;u=c.events;var l=-1!==h.findIndex(function(t){return t._queryParams.loadsAllData()}),f=t.syncPointTree_.findOnPath(i,function(t,e){return ir(e)});if(l&&!f){var d=t.syncPointTree_.subtree(i);if(!d.isEmpty())for(var p=function(t){return t.fold(function(t,e,n){if(e&&ir(e))return[or(e)];var r=[];return e&&(r=tr(e)),F(n,function(t,e){r=r.concat(e)}),r})}(d),y=0;y<p.length;++y){var v=p[y],g=v.query,m=gr(t,v);t.listenProvider_.startListening(Ir(g),mr(t,g),m.hashFn,m.onComplete)}}!f&&h.length>0&&!r&&(l?t.listenProvider_.stopListening(Ir(e),null):h.forEach(function(e){var n=t.queryToTagMap.get(_r(e));t.listenProvider_.stopListening(Ir(e),n)})),function(t,e){for(var n=0;n<e.length;++n){var r=e[n];if(!r._queryParams.loadsAllData()){var i=_r(r),o=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(o)}}}(t,h)}return u}function fr(t,e,n){var r=e._path,i=null,s=!1;t.syncPointTree_.foreachOnPath(r,function(t,e){var n=Dt(t,r);i=i||er(e,n),s=s||ir(e)});var a,u=t.syncPointTree_.get(r);u?(s=s||ir(u),i=i||er(u,wt())):(u=new Zn,t.syncPointTree_=t.syncPointTree_.set(r,u)),null!=i?a=!0:(a=!1,i=fe.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=er(e,wt());n&&(i=i.updateImmediateChild(t,n))}));var c=rr(u,e);if(!c&&!e._queryParams.loadsAllData()){var h=_r(e);(0,o.hu)(!t.queryToTagMap.has(h),"View does not exist, but we have a tag");var l=sr++;t.queryToTagMap.set(h,l),t.tagToQueryMap.set(l,h)}var f=function(t,e,n,r,i,o){var s=Xn(t,e,r,i,o);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,s),function(t,e){t.eventRegistrations_.push(e)}(s,n),function(t,e){var n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(se,function(t,e){r.push(Ce(t,e))}),n.isFullyInitialized()&&r.push(Ee(n.getNode())),Jn(t,r,n.getNode(),e)}(s,n)}(u,e,n,Tn(t.pendingWriteTree_,r),i,a);if(!c&&!s){var d=nr(u,e);f=f.concat(function(t,e,n){var r=e._path,i=mr(t,e),s=gr(t,n),a=t.listenProvider_.startListening(Ir(e),i,s.hashFn,s.onComplete),u=t.syncPointTree_.subtree(r);if(i)(0,o.hu)(!ir(u.value),"If we're adding a query, it shouldn't be shadowed");else for(var c=u.fold(function(t,e,n){if(!kt(t)&&e&&ir(e))return[or(e).query];var r=[];return e&&(r=r.concat(tr(e).map(function(t){return t.query}))),F(n,function(t,e){r=r.concat(e)}),r}),h=0;h<c.length;++h){var l=c[h];t.listenProvider_.stopListening(Ir(l),mr(t,l))}return a}(t,e,d))}return f}function dr(t,e,n){var r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,function(t,n){var r=er(n,Dt(t,e));if(r)return r});return Sn(r,e,i,n,!0)}function pr(t,e){return yr(e,t.syncPointTree_,null,Tn(t.pendingWriteTree_,wt()))}function yr(t,e,n,r){if(kt(t.path))return vr(t,e,n,r);var i=e.get(wt());null==n&&null!=i&&(n=er(i,wt()));var o=[],s=bt(t.path),a=t.operationForChild(s),u=e.children.get(s);if(u&&a){var c=n?n.getImmediateChild(s):null,h=An(r,s);o=o.concat(yr(a,u,c,h))}return i&&(o=o.concat($n(i,t,r,n))),o}function vr(t,e,n,r){var i=e.get(wt());null==n&&null!=i&&(n=er(i,wt()));var o=[];return e.children.inorderTraversal(function(e,i){var s=n?n.getImmediateChild(e):null,a=An(r,e),u=t.operationForChild(e);u&&(o=o.concat(vr(u,i,s,a)))}),i&&(o=o.concat($n(i,t,r,n))),o}function gr(t,e){var n=e.query,r=mr(t,n);return{hashFn:function(){var t=function(t){return t.viewCache_.serverCache.getNode()}(e)||fe.EMPTY_NODE;return t.hash()},onComplete:function(e){if("ok"===e)return r?function(t,e,n){var r=wr(t,n);if(r){var i=br(r),o=i.path,s=i.queryId,a=Dt(o,e);return Tr(t,o,new Ze(He(s),a))}return[]}(t,n._path,r):function(t,e){return pr(t,new Ze({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(t,n._path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}(e,n);return lr(t,n,null,i)}}}function mr(t,e){var n=_r(e);return t.queryToTagMap.get(n)}function _r(t){return t._path.toString()+"$"+t._queryIdentifier}function wr(t,e){return t.tagToQueryMap.get(e)}function br(t){var e=t.indexOf("$");return(0,o.hu)(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new _t(t.substr(0,e))}}function Tr(t,e,n){var r=t.syncPointTree_.get(e);return(0,o.hu)(r,"Missing sync point for query tag that we're tracking"),$n(r,n,Tn(t.pendingWriteTree_,e),null)}function Ir(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new((0,o.hu)(Yn,"Reference.ts has not been loaded"),Yn)(t._repo,t._path):t}var Er=function(){function t(t){this.node_=t}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e))},t.prototype.node=function(){return this.node_},t}(),Cr=function(){function t(t,e){this.syncTree_=t,this.path_=e}return t.prototype.getImmediateChild=function(e){var n=Nt(this.path_,e);return new t(this.syncTree_,n)},t.prototype.node=function(){return dr(this.syncTree_,this.path_)},t}(),Sr=function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t},Nr=function(t,e,n){return t&&"object"==typeof t?((0,o.hu)(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?kr(t[".sv"],e,n):"object"==typeof t[".sv"]?Dr(t[".sv"],e):void(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},kr=function(t,e,n){if("timestamp"===t)return n.timestamp;(0,o.hu)(!1,"Unexpected server value: "+t)},Dr=function(t,e,n){t.hasOwnProperty("increment")||(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(t,null,2));var r=t.increment;"number"!=typeof r&&(0,o.hu)(!1,"Unexpected increment value: "+r);var i=e.node();if((0,o.hu)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var s=i.getValue();return"number"!=typeof s?r:s+r},xr=function(t,e,n,r){return Ar(e,new Cr(n,t),r)},Pr=function(t,e,n){return Ar(t,new Er(e),n)};function Ar(t,e,n){var r,i=t.getPriority().val(),o=Nr(i,e.getImmediateChild(".priority"),n);if(t.isLeafNode()){var s=t,a=Nr(s.getValue(),e,n);return a!==s.getValue()||o!==s.getPriority().val()?new oe(a,ye(o)):t}var u=t;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new oe(o))),u.forEachChild(se,function(t,i){var o=Ar(i,e.getImmediateChild(t),n);o!==i&&(r=r.updateImmediateChild(t,o))}),r}var Rr=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n={children:{},childCount:0}),this.name=t,this.parent=e,this.node=n};function Or(t,e){for(var n=e instanceof _t?e:new _t(e),r=t,i=bt(n);null!==i;){var s=(0,o.DV)(r.node.children,i)||{children:{},childCount:0};r=new Rr(i,r,s),i=bt(n=It(n))}return r}function Lr(t){return t.node.value}function Fr(t,e){t.node.value=e,jr(t)}function Mr(t){return t.node.childCount>0}function qr(t,e){F(t.node.children,function(n,r){e(new Rr(n,t,r))})}function Ur(t,e,n,r){n&&!r&&e(t),qr(t,function(t){Ur(t,e,!0,r)}),n&&r&&e(t)}function Vr(t){return new _t(null===t.parent?t.name:Vr(t.parent)+"/"+t.name)}function jr(t){null!==t.parent&&function(t,e,n){var r=function(t){return void 0===Lr(t)&&!Mr(t)}(n),i=(0,o.r3)(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,jr(t)):r||i||(t.node.children[e]=n.node,t.node.childCount++,jr(t))}(t.parent,t.name,t)}var Gr=/[\[\].#$\/\u0000-\u001F\u007F]/,Br=/[\[\].#$\u0000-\u001F\u007F]/,Kr=10485760,Wr=function(t){return"string"==typeof t&&0!==t.length&&!Gr.test(t)},zr=function(t){return"string"==typeof t&&0!==t.length&&!Br.test(t)},Qr=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!k(t)||t&&"object"==typeof t&&(0,o.r3)(t,".sv")},Hr=function(t,e,n,r){r&&void 0===e||Jr((0,o.gK)(t,"value"),e,n)},Jr=function(t,e,n){var r=n instanceof _t?new Rt(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+Lt(r));if("function"==typeof e)throw new Error(t+"contains a function "+Lt(r)+" with contents = "+e.toString());if(k(e))throw new Error(t+"contains "+e.toString()+" "+Lt(r));if("string"==typeof e&&e.length>Kr/3&&(0,o.ug)(e)>Kr)throw new Error(t+"contains a string greater than "+Kr+" utf8 bytes "+Lt(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var i=!1,s=!1;if(F(e,function(e,n){if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!Wr(e)))throw new Error(t+" contains an invalid key ("+e+") "+Lt(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a,u;!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=(0,o.ug)(e),Ot(t)}(r,e),Jr(t,n,r),u=(a=r).parts_.pop(),a.byteLength_-=(0,o.ug)(u),a.parts_.length>0&&(a.byteLength_-=1)}),i&&s)throw new Error(t+' contains ".value" child '+Lt(r)+" in addition to actual children.")}},Yr=function(t,e,n,r){if(!r||void 0!==e){var i=(0,o.gK)(t,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");var s=[];F(e,function(t,e){var r=new _t(t);if(Jr(i,e,Nt(n,r)),".priority"===Et(r)&&!Qr(e))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=Ct(r=e[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Wr(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(xt);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&At(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}},Zr=function(t,e,n){if(!n||void 0!==e){if(k(e))throw new Error((0,o.gK)(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Qr(e))throw new Error((0,o.gK)(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},$r=function(t,e,n){if(!n||void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,o.gK)(t,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Xr=function(t,e,n,r){if(!(r&&void 0===n||Wr(n)))throw new Error((0,o.gK)(t,e)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ti=function(t,e,n,r){if(!(r&&void 0===n||zr(n)))throw new Error((0,o.gK)(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ei=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ti(t,e,n,r)},ni=function(t,e){if(".info"===bt(e))throw new Error(t+" failed = Can't modify data under /.info/")},ri=function(t,e){var n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Wr(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),zr(t)}(n))throw new Error((0,o.gK)(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},ii=function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error((0,o.gK)(t,e)+"must be a boolean.")},oi=function(){this.eventLists_=[],this.recursionDepth_=0};function si(t,e){for(var n=null,r=0;r<e.length;r++){var i=e[r],o=i.getPath();null===n||Pt(o,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&t.eventLists_.push(n)}function ai(t,e,n){si(t,n),ci(t,function(t){return Pt(t,e)})}function ui(t,e,n){si(t,n),ci(t,function(t){return At(t,e)||At(e,t)})}function ci(t,e){t.recursionDepth_++;for(var n=!0,r=0;r<t.eventLists_.length;r++){var i=t.eventLists_[r];i&&(e(i.path)?(hi(t.eventLists_[r]),t.eventLists_[r]=null):n=!1)}n&&(t.eventLists_=[]),t.recursionDepth_--}function hi(t){for(var e=0;e<t.events.length;e++){var n=t.events[e];if(null!==n){t.events[e]=null;var r=n.getEventRunner();w&&I("event: "+n.toString()),G(r)}}}var li="repo_interrupt",fi=25,di=function(){function t(t,e,n,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oi,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ue(),this.transactionQueueTree_=new Rr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t}();function pi(t){var e=t.infoData_.getNode(new _t(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function yi(t){return Sr({timestamp:pi(t)})}function vi(t,e,n,r,i){t.dataUpdateCount++;var s=new _t(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;var a=[];if(i)if(r){var u=(0,o.UI)(n,function(t){return ye(t)});a=function(t,e,n,r){var i=wr(t,r);if(i){var o=br(i),s=o.path,a=o.queryId,u=Dt(s,e),c=hn.fromObject(n);return Tr(t,s,new Xe(He(a),u,c))}return[]}(t.serverSyncTree_,s,u,i)}else{var c=ye(n);a=function(t,e,n,r){var i=wr(t,r);if(null!=i){var o=br(i),s=o.path,a=o.queryId,u=Dt(s,e);return Tr(t,s,new $e(He(a),u,n))}return[]}(t.serverSyncTree_,s,c,i)}else if(r){var h=(0,o.UI)(n,function(t){return ye(t)});a=function(t,e,n){var r=hn.fromObject(n);return pr(t,new Xe({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(t.serverSyncTree_,s,h)}else{var l=ye(n);a=hr(t.serverSyncTree_,s,l)}var f=s;a.length>0&&(f=Di(t,s)),ui(t.eventQueue_,f,a)}function gi(t,e){mi(t,"connected",e),!1===e&&function(t){Ci(t,"onDisconnectEvents");var e=yi(t),n=Ue();Ge(t.onDisconnect_,wt(),function(r,i){var o=xr(r,i,t.serverSyncTree_,e);Ve(n,r,o)});var r=[];Ge(n,wt(),function(e,n){r=r.concat(hr(t.serverSyncTree_,e,n));var i=Oi(t,e);Di(t,i)}),t.onDisconnect_=Ue(),ui(t.eventQueue_,wt(),r)}(t)}function mi(t,e,n){var r=new _t("/.info/"+e),i=ye(n);t.infoData_.updateSnapshot(r,i);var o=hr(t.infoSyncTree_,r,i);ui(t.eventQueue_,r,o)}function _i(t){return t.nextWriteId_++}function wi(t,e,n,r,i){Ci(t,"set",{path:e.toString(),value:n,priority:r});var o=yi(t),s=ye(n,r),a=dr(t.serverSyncTree_,e),u=Pr(s,a,o),c=_i(t),h=ur(t.serverSyncTree_,e,u,c,!0);si(t.eventQueue_,h),t.server_.put(e.toString(),s.val(!0),function(n,r){var o="ok"===n;o||N("set at "+e+" failed: "+n);var s=cr(t.serverSyncTree_,c,!o);ui(t.eventQueue_,e,s),Si(0,i,n,r)});var l=Oi(t,e);Di(t,l),ui(t.eventQueue_,l,[])}function bi(t,e,n){t.server_.onDisconnectCancel(e.toString(),function(r,i){"ok"===r&&je(t.onDisconnect_,e),Si(0,n,r,i)})}function Ti(t,e,n,r){var i=ye(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),function(n,o){"ok"===n&&Ve(t.onDisconnect_,e,i),Si(0,r,n,o)})}function Ii(t,e,n){var r;r=".info"===bt(e._path)?lr(t.infoSyncTree_,e,n):lr(t.serverSyncTree_,e,n),ai(t.eventQueue_,e._path,r)}function Ei(t){t.persistentConnection_&&t.persistentConnection_.interrupt(li)}function Ci(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r="";t.persistentConnection_&&(r=t.persistentConnection_.id+":"),I.apply(void 0,(0,s.ev)([r],(0,s.CR)(e)))}function Si(t,e,n,r){e&&G(function(){if("ok"===n)e(null);else{var t=(n||"error").toUpperCase(),i=t;r&&(i+=": "+r);var o=new Error(i);o.code=t,e(o)}})}function Ni(t,e,n){return dr(t.serverSyncTree_,e,n)||fe.EMPTY_NODE}function ki(t,e){if(void 0===e&&(e=t.transactionQueueTree_),e||Ri(t,e),Lr(e)){var n=Pi(t,e);(0,o.hu)(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return 0===t.status})&&function(t,e,n){for(var r=n.map(function(t){return t.currentWriteId}),i=Ni(t,e,r),s=i,a=i.hash(),u=0;u<n.length;u++){var c=n[u];(0,o.hu)(0===c.status,"tryToSendTransactionQueue_: items in queue should all be run."),c.status=1,c.retryCount++;var h=Dt(e,c.path);s=s.updateChild(h,c.currentOutputSnapshotRaw)}var l=s.val(!0),f=e;t.server_.put(f.toString(),l,function(r){Ci(t,"transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(e){n[e].status=2,i=i.concat(cr(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&o.push(function(){return n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved)}),n[e].unwatcher()},a=0;a<n.length;a++)s(a);for(Ri(t,Or(t.transactionQueueTree_,e)),ki(t,t.transactionQueueTree_),ui(t.eventQueue_,e,i),a=0;a<o.length;a++)G(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)n[a].status=3===n[a].status?4:0;else for(N("transaction at "+f.toString()+" failed: "+r),a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r;Di(t,e)}},a)}(t,Vr(e),n)}else Mr(e)&&qr(e,function(e){ki(t,e)})}function Di(t,e){var n=xi(t,e),r=Vr(n);return function(t,e,n){if(0!==e.length){for(var r=[],i=[],s=e.filter(function(t){return 0===t.status}).map(function(t){return t.currentWriteId}),a=function(a){var u,c=e[a],h=Dt(n,c.path),l=!1;if((0,o.hu)(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)l=!0,u=c.abortReason,i=i.concat(cr(t.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=fi)l=!0,u="maxretry",i=i.concat(cr(t.serverSyncTree_,c.currentWriteId,!0));else{var f=Ni(t,c.path,s);c.currentInputSnapshot=f;var d=e[a].update(f.val());if(void 0!==d){Jr("transaction failed: Data returned ",d,c.path);var p=ye(d);"object"==typeof d&&null!=d&&(0,o.r3)(d,".priority")||(p=p.updatePriority(f.getPriority()));var y=c.currentWriteId,v=yi(t),g=Pr(p,f,v);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=g,c.currentWriteId=_i(t),s.splice(s.indexOf(y),1),i=(i=i.concat(ur(t.serverSyncTree_,c.path,g,c.currentWriteId,c.applyLocally))).concat(cr(t.serverSyncTree_,y,!0))}else l=!0,u="nodata",i=i.concat(cr(t.serverSyncTree_,c.currentWriteId,!0))}ui(t.eventQueue_,n,i),i=[],l&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&r.push("nodata"===u?function(){return e[a].onComplete(null,!1,e[a].currentInputSnapshot)}:function(){return e[a].onComplete(new Error(u),!1,null)}))},u=0;u<e.length;u++)a(u);for(Ri(t,t.transactionQueueTree_),u=0;u<r.length;u++)G(r[u]);ki(t,t.transactionQueueTree_)}}(t,Pi(t,n),r),r}function xi(t,e){var n,r=t.transactionQueueTree_;for(n=bt(e);null!==n&&void 0===Lr(r);)r=Or(r,n),n=bt(e=It(e));return r}function Pi(t,e){var n=[];return Ai(t,e,n),n.sort(function(t,e){return t.order-e.order}),n}function Ai(t,e,n){var r=Lr(e);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);qr(e,function(e){Ai(t,e,n)})}function Ri(t,e){var n=Lr(e);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Fr(e,n.length>0?n:void 0)}qr(e,function(e){Ri(t,e)})}function Oi(t,e){var n=Vr(xi(t,e)),r=Or(t.transactionQueueTree_,e);return function(t,e,n){for(var r=t.parent;null!==r;){if(e(r))return!0;r=r.parent}}(r,function(e){Li(t,e)}),Li(t,r),Ur(r,function(e){Li(t,e)}),n}function Li(t,e){var n=Lr(e);if(n){for(var r=[],i=[],s=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?((0,o.hu)(s===a-1,"All SENT items should be at beginning of queue."),s=a,n[a].status=3,n[a].abortReason="set"):((0,o.hu)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(cr(t.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));for(-1===s?Fr(e,void 0):n.length=s+1,ui(t.eventQueue_,Vr(e),i),a=0;a<r.length;a++)G(r[a])}}var Fi=function(t,e){var n=Mi(t),r=n.namespace;return"firebase.com"===n.domain&&S(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||S("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&N("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Z(n.host,n.secure,r,e,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new _t(n.pathString)}},Mi=function(t){var e="",n="",r="",i="",o="",a=!0,u="https",c=443;if("string"==typeof t){var h=t.indexOf("//");h>=0&&(u=t.substring(0,h-1),t=t.substring(h+2));var l=t.indexOf("/");-1===l&&(l=t.length);var f=t.indexOf("?");-1===f&&(f=t.length),e=t.substring(0,Math.min(l,f)),l<f&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}e+="/"+i}return e}(t.substring(l,f)));var d=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=(0,s.XA)(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var u=a.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):N("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(c){e={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,f)));(h=e.indexOf(":"))>=0?(a="https"===u||"wss"===u,c=parseInt(e.substring(h+1),10)):h=e.length;var p=e.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var y=e.indexOf(".");r=e.substring(0,y).toLowerCase(),n=e.substring(y+1),o=r}"ns"in d&&(o=d.ns)}return{host:e,port:c,domain:n,subdomain:r,secure:a,scheme:u,pathString:i,namespace:o}},qi=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,o.Pz)(this.snapshot.exportVal())},t}(),Ui=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Vi=function(){function t(t,e){this.snapshotCallback=t,this.cancelCallback=e}return t.prototype.onValue=function(t,e){this.snapshotCallback.call(null,t,e)},t.prototype.onCancel=function(t){return(0,o.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)},Object.defineProperty(t.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),t.prototype.matches=function(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context},t}(),ji=function(){function t(t,e){this._repo=t,this._path=e}return t.prototype.cancel=function(){var t=new o.BH;return bi(this._repo,this._path,t.wrapCallback(function(){})),t.promise},t.prototype.remove=function(){ni("OnDisconnect.remove",this._path);var t=new o.BH;return Ti(this._repo,this._path,null,t.wrapCallback(function(){})),t.promise},t.prototype.set=function(t){ni("OnDisconnect.set",this._path),Hr("OnDisconnect.set",t,this._path,!1);var e=new o.BH;return Ti(this._repo,this._path,t,e.wrapCallback(function(){})),e.promise},t.prototype.setWithPriority=function(t,e){ni("OnDisconnect.setWithPriority",this._path),Hr("OnDisconnect.setWithPriority",t,this._path,!1),Zr("OnDisconnect.setWithPriority",e,!1);var n=new o.BH;return function(t,e,n,r,i){var o=ye(n,r);t.server_.onDisconnectPut(e.toString(),o.val(!0),function(n,r){"ok"===n&&Ve(t.onDisconnect_,e,o),Si(0,i,n,r)})}(this._repo,this._path,t,e,n.wrapCallback(function(){})),n.promise},t.prototype.update=function(t){ni("OnDisconnect.update",this._path),Yr("OnDisconnect.update",t,this._path,!1);var e=new o.BH;return function(t,e,n,r){if((0,o.xb)(n))return I("onDisconnect().update() called with empty data.  Don't do anything."),void Si(0,r,"ok",void 0);t.server_.onDisconnectMerge(e.toString(),n,function(i,o){"ok"===i&&F(n,function(n,r){var i=ye(r);Ve(t.onDisconnect_,Nt(e,n),i)}),Si(0,r,i,o)})}(this._repo,this._path,t,e.wrapCallback(function(){})),e.promise},t}(),Gi=function(){function t(t,e,n,r){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(t.prototype,"key",{get:function(){return kt(this._path)?null:Et(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new zi(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_queryIdentifier",{get:function(){var t=Fe(this._queryParams),e=O(t);return"{}"===e?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_queryObject",{get:function(){return Fe(this._queryParams)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!((e=(0,o.m9)(e))instanceof t))return!1;var n=this._repo===e._repo,r=Pt(this._path,e._path);return n&&r&&this._queryIdentifier===e._queryIdentifier},t.prototype.toJSON=function(){return this.toString()},t.prototype.toString=function(){return this._repo.toString()+function(t){for(var e="",n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)},t}();function Bi(t,e){if(!0===t._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function Ki(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Wt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==D)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==x)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===se){if(null!=e&&!Qr(e)||null!=n&&!Qr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,o.hu)(t.getIndex()instanceof me||t.getIndex()===_e,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Wi(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var zi=function(t){function e(e,n){return t.call(this,e,n,new Pe,!1)||this}return(0,s.ZT)(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){var t=St(this._path);return null===t?null:new e(this._repo,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t},enumerable:!1,configurable:!0}),e}(Gi),Qi=function(){function t(t,e,n){this._node=t,this.ref=e,this._index=n}return Object.defineProperty(t.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),t.prototype.child=function(e){var n=new _t(e),r=Yi(this.ref,e);return new t(this._node.getChild(n),r,se)},t.prototype.exists=function(){return!this._node.isEmpty()},t.prototype.exportVal=function(){return this._node.val(!0)},t.prototype.forEach=function(e){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(r,i){return e(new t(i,Yi(n.ref,r),se))})},t.prototype.hasChild=function(t){var e=new _t(t);return!this._node.getChild(e).isEmpty()},t.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},t.prototype.toJSON=function(){return this.exportVal()},t.prototype.val=function(){return this._node.val()},t}();function Hi(t,e){return(t=(0,o.m9)(t))._checkNotDeleted("ref"),void 0!==e?Yi(t._root,e):t._root}function Ji(t,e){(t=(0,o.m9)(t))._checkNotDeleted("refFromURL");var n=Fi(e,t._repo.repoInfo_.nodeAdmin);ri("refFromURL",n);var r=n.repoInfo;return t._repo.repoInfo_.isCustomHost()||r.host===t._repo.repoInfo_.host||S("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+t._repo.repoInfo_.host+")"),Hi(t,n.path.toString())}function Yi(t,e){return null===bt((t=(0,o.m9)(t))._path)?ei("child","path",e,!1):ti("child","path",e,!1),new zi(t._repo,Nt(t._path,e))}function Zi(t,e){t=(0,o.m9)(t),ni("set",t._path),Hr("set",e,t._path,!1);var n=new o.BH;return wi(t._repo,t._path,e,null,n.wrapCallback(function(){})),n.promise}var $i=function(){function t(t){this.callbackContext=t}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e._queryParams.getIndex();return new qi("value",this,new Qi(t.snapshotNode,new zi(e._repo,e._path),n))},t.prototype.getEventRunner=function(t){var e=this;return"cancel"===t.getEventType()?function(){return e.callbackContext.onCancel(t.error)}:function(){return e.callbackContext.onValue(t.snapshot,null)}},t.prototype.createCancelEvent=function(t,e){return this.callbackContext.hasCancelCallback?new Ui(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))},t.prototype.hasAnyCallback=function(){return null!==this.callbackContext},t}(),Xi=function(){function t(t,e){this.eventType=t,this.callbackContext=e}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return this.eventType===("children_removed"===e?"child_removed":e)},t.prototype.createCancelEvent=function(t,e){return this.callbackContext.hasCancelCallback?new Ui(this,t,e):null},t.prototype.createEvent=function(t,e){(0,o.hu)(null!=t.childName,"Child events should have a childName.");var n=Yi(new zi(e._repo,e._path),t.childName),r=e._queryParams.getIndex();return new qi(t.type,this,new Qi(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this;return"cancel"===t.getEventType()?function(){return e.callbackContext.onCancel(t.error)}:function(){return e.callbackContext.onValue(t.snapshot,t.prevName)}},t.prototype.matches=function(e){return e instanceof t&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))},t.prototype.hasAnyCallback=function(){return!!this.callbackContext},t}();function to(t,e,n,r,i){var o;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){var s=n,a=function(e,n){Ii(t._repo,t,c),s(e,n)};a.userCallback=n.userCallback,a.context=n.context,n=a}var u=new Vi(n,o||void 0),c="value"===e?new $i(u):new Xi(e,u);return function(t,e,n){var r;r=".info"===bt(e._path)?fr(t.infoSyncTree_,e,n):fr(t.serverSyncTree_,e,n),ai(t.eventQueue_,e._path,r)}(t._repo,t,c),function(){return Ii(t._repo,t,c)}}function eo(t,e,n,r){return to(t,"value",e,n,r)}function no(t,e,n,r){return to(t,"child_added",e,n,r)}function ro(t,e,n,r){return to(t,"child_changed",e,n,r)}function io(t,e,n,r){return to(t,"child_moved",e,n,r)}function oo(t,e,n,r){return to(t,"child_removed",e,n,r)}function so(t,e,n){var r=null,i=n?new Vi(n):null;"value"===e?r=new $i(i):e&&(r=new Xi(e,i)),Ii(t._repo,t,r)}var ao=function(){},uo=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Hr("endAt",this._value,t._path,!0);var e=Re(t._queryParams,this._value,this._key);if(Wi(e),Ki(e),t._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Gi(t._repo,t._path,e,t._orderByCalled)},e}(ao),co=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Hr("endBefore",this._value,t._path,!1);var e,n,r,i,o=(n=this._value,r=this._key,(e=t._queryParams).index_===Wt?("string"==typeof n&&(n=Ie(n)),i=Re(e,n,r)):i=Re(e,n,null==r?D:Ie(r)),i.endBeforeSet_=!0,i);if(Wi(o),Ki(o),t._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Gi(t._repo,t._path,o,t._orderByCalled)},e}(ao),ho=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Hr("startAt",this._value,t._path,!0);var e=Ae(t._queryParams,this._value,this._key);if(Wi(e),Ki(e),t._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Gi(t._repo,t._path,e,t._orderByCalled)},e}(ao),lo=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Hr("startAfter",this._value,t._path,!1);var e,n,r,i,o=(n=this._value,r=this._key,(e=t._queryParams).index_===Wt?("string"==typeof n&&(n=Te(n)),i=Ae(e,n,r)):i=Ae(e,n,null==r?x:Te(r)),i.startAfterSet_=!0,i);if(Wi(o),Ki(o),t._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Gi(t._repo,t._path,o,t._orderByCalled)},e}(ao),fo=function(t){function e(e){var n=t.call(this)||this;return n._limit=e,n}return(0,s.ZT)(e,t),e.prototype._apply=function(t){if(t._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Gi(t._repo,t._path,(e=this._limit,(n=t._queryParams.copy()).limitSet_=!0,n.limit_=e,n.viewFrom_="l",n),t._orderByCalled);var e,n},e}(ao),po=function(t){function e(e){var n=t.call(this)||this;return n._limit=e,n}return(0,s.ZT)(e,t),e.prototype._apply=function(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Gi(t._repo,t._path,(e=this._limit,(n=t._queryParams.copy()).limitSet_=!0,n.limit_=e,n.viewFrom_="r",n),t._orderByCalled);var e,n},e}(ao),yo=function(t){function e(e){var n=t.call(this)||this;return n._path=e,n}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Bi(t,"orderByChild");var e=new _t(this._path);if(kt(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new me(e),r=Oe(t._queryParams,n);return Ki(r),new Gi(t._repo,t._path,r,!0)},e}(ao),vo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Bi(t,"orderByKey");var e=Oe(t._queryParams,Wt);return Ki(e),new Gi(t._repo,t._path,e,!0)},e}(ao),go=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Bi(t,"orderByPriority");var e=Oe(t._queryParams,se);return Ki(e),new Gi(t._repo,t._path,e,!0)},e}(ao),mo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,s.ZT)(e,t),e.prototype._apply=function(t){Bi(t,"orderByValue");var e=Oe(t._queryParams,_e);return Ki(e),new Gi(t._repo,t._path,e,!0)},e}(ao),_o=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return(0,s.ZT)(e,t),e.prototype._apply=function(t){if(Hr("equalTo",this._value,t._path,!1),t._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(t._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new uo(this._value,this._key)._apply(new ho(this._value,this._key)._apply(t))},e}(ao);function wo(t){for(var e,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a=(0,o.m9)(t);try{for(var u=(0,s.XA)(r),c=u.next();!c.done;c=u.next())a=c.value._apply(a)}catch(h){e={error:h}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}return a}!function(t){(0,o.hu)(!Bn,"__referenceConstructor has already been defined"),Bn=t}(zi),function(t){(0,o.hu)(!Yn,"__referenceConstructor has already been defined"),Yn=t}(zi);var bo="FIREBASE_DATABASE_EMULATOR_HOST",To={},Io=!1;function Eo(t,e,n,r,i){var o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||S("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),I("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");var s,a=Fi(o,i),u=a.repoInfo,c=void 0;"undefined"!=typeof process&&(c=process.env[bo]),c?(s=!0,u=(a=Fi(o="http://"+c+"?ns="+u.namespace,i)).repoInfo):s=!a.repoInfo.secure;var h=i&&s?new z(z.OWNER):new W(t.name,t.options,e);ri("Invalid Firebase Database URL",a),kt(a.path)||S("Database URL must point to the root of a Firebase Database (not including a child path).");var l=function(t,e,n,r){var i=To[e.name];i||(To[e.name]=i={});var o=i[t.toURLString()];return o&&S("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new di(t,Io,n,r),i[t.toURLString()]=o,o}(u,t,h,new K(t.name,n));return new Co(l,t)}var Co=function(){function t(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}return Object.defineProperty(t.prototype,"_repo",{get:function(){return this._instanceStarted||(function(t,e,n){if(t.stats_=nt(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Me(t.repoInfo_,function(e,n,r,i){vi(t,e,n,r,i)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(function(){return gi(t,!0)},0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,o.Pz)(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new jt(t.repoInfo_,e,function(e,n,r,i){vi(t,e,n,r,i)},function(e){gi(t,e)},function(e){!function(t,e){F(e,function(e,n){mi(t,e,n)})}(t,e)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}var r,i;t.authTokenProvider_.addTokenChangeListener(function(e){t.server_.refreshAuthToken(e)}),t.appCheckProvider_.addTokenChangeListener(function(e){t.server_.refreshAppCheckToken(e.token)}),t.statsReporter_=(r=function(){return new ze(t.stats_,t.server_)},i=t.repoInfo_.toString(),et[i]||(et[i]=r()),et[i]),t.infoData_=new qe,t.infoSyncTree_=new ar({startListening:function(e,n,r,i){var o=[],s=t.infoData_.getNode(e._path);return s.isEmpty()||(o=hr(t.infoSyncTree_,e._path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),mi(t,"connected",!1),t.serverSyncTree_=new ar({startListening:function(e,n,r,i){return t.server_.listen(e,r,n,function(n,r){var o=i(n,r);ui(t.eventQueue_,e._path,o)}),[]},stopListening:function(e,n){t.server_.unlisten(e,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new zi(this._repo,wt())),this._rootInternal},enumerable:!1,configurable:!0}),t.prototype._delete=function(){var t,e,n;return this._checkNotDeleted("delete"),t=this._repo,(n=To[e=this.app.name])&&n[t.key]===t||S("Database "+e+"("+t.repoInfo_+") has already been deleted."),Ei(t),delete n[t.key],this._repoInternal=null,this._rootInternal=null,Promise.resolve()},t.prototype._checkNotDeleted=function(t){null===this._rootInternal&&S("Cannot call "+t+" on a deleted database.")},t}(),So={".sv":"timestamp"},No=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}();var ko=function(){function t(t){this._delegate=t}return t.prototype.cancel=function(t){(0,o.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,o.Wj)("OnDisconnect.cancel","onComplete",t,!0);var e=this._delegate.cancel();return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},t.prototype.remove=function(t){(0,o.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,o.Wj)("OnDisconnect.remove","onComplete",t,!0);var e=this._delegate.remove();return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},t.prototype.set=function(t,e){(0,o.Dv)("OnDisconnect.set",1,2,arguments.length),(0,o.Wj)("OnDisconnect.set","onComplete",e,!0);var n=this._delegate.set(t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},t.prototype.setWithPriority=function(t,e,n){(0,o.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,o.Wj)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(t,e);return n&&r.then(function(){return n(null)},function(t){return n(t)}),r},t.prototype.update=function(t,e){if((0,o.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,N("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,o.Wj)("OnDisconnect.update","onComplete",e,!0);var i=this._delegate.update(t);return e&&i.then(function(){return e(null)},function(t){return e(t)}),i},t}(),Do=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return(0,o.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),xo=function(){function t(t,e){this._database=t,this._delegate=e}return t.prototype.val=function(){return(0,o.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},t.prototype.exportVal=function(){return(0,o.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},t.prototype.toJSON=function(){return(0,o.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},t.prototype.exists=function(){return(0,o.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},t.prototype.child=function(e){return(0,o.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),ti("DataSnapshot.child","path",e,!1),new t(this._database,this._delegate.child(e))},t.prototype.hasChild=function(t){return(0,o.Dv)("DataSnapshot.hasChild",1,1,arguments.length),ti("DataSnapshot.hasChild","path",t,!1),this._delegate.hasChild(t)},t.prototype.getPriority=function(){return(0,o.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},t.prototype.forEach=function(e){var n=this;return(0,o.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,o.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(function(r){return e(new t(n._database,r))})},t.prototype.hasChildren=function(){return(0,o.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(t.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return(0,o.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},t.prototype.getRef=function(){return(0,o.Dv)("DataSnapshot.ref",0,0,arguments.length),new Ao(this._database,this._delegate.ref)},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Po=function(){function t(t,e){this.database=t,this._delegate=e}return t.prototype.on=function(e,n,r,i){var s,a=this;(0,o.Dv)("Query.on",2,4,arguments.length),(0,o.Wj)("Query.on","callback",n,!1);var u=t.getCancelAndContextArgs_("Query.on",r,i),c=function(t,e){n.call(u.context,new xo(a.database,t),e)};c.userCallback=n,c.context=u.context;var h=null===(s=u.cancel)||void 0===s?void 0:s.bind(u.context);switch(e){case"value":return eo(this._delegate,c,h),n;case"child_added":return no(this._delegate,c,h),n;case"child_removed":return oo(this._delegate,c,h),n;case"child_changed":return ro(this._delegate,c,h),n;case"child_moved":return io(this._delegate,c,h),n;default:throw new Error((0,o.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},t.prototype.off=function(t,e,n){if((0,o.Dv)("Query.off",0,3,arguments.length),$r("Query.off",t,!0),(0,o.Wj)("Query.off","callback",e,!0),(0,o.lb)("Query.off","context",n,!0),e){var r=function(){};r.userCallback=e,r.context=n,so(this._delegate,t,r)}else so(this._delegate,t)},t.prototype.get=function(){var t=this;return function(t){return function(t,e){var n=function(t,e){var n=e._path,r=null;t.syncPointTree_.foreachOnPath(n,function(t,e){var i=Dt(t,n);r=r||er(e,i)});var i=t.syncPointTree_.get(n);i?r=r||er(i,wt()):(i=new Zn,t.syncPointTree_=t.syncPointTree_.set(n,i));var o=null!=r,s=o?new tn(r,!0,!1):null;return an(Xn(i,e,Tn(t.pendingWriteTree_,e._path),o?s.getNode():fe.EMPTY_NODE,o).viewCache_)}(t.serverSyncTree_,e);return null!=n?Promise.resolve(n):t.server_.get(e).then(function(n){var r=ye(n).withIndex(e._queryParams.getIndex()),i=hr(t.serverSyncTree_,e._path,r);return ai(t.eventQueue_,e._path,i),Promise.resolve(r)},function(n){return Ci(t,"get for query "+(0,o.Pz)(e)+" failed: "+n),Promise.reject(new Error(n))})}((t=(0,o.m9)(t))._repo,t).then(function(e){return new Qi(e,new zi(t._repo,t._path),t._queryParams.getIndex())})}(this._delegate).then(function(e){return new xo(t.database,e)})},t.prototype.once=function(e,n,r,i){var s=this;(0,o.Dv)("Query.once",1,4,arguments.length),(0,o.Wj)("Query.once","callback",n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,i),u=new o.BH,c=function(t,e){var r=new xo(s.database,t);n&&n.call(a.context,r,e),u.resolve(r)};c.userCallback=n,c.context=a.context;var h=function(t){a.cancel&&a.cancel.call(a.context,t),u.reject(t)};switch(e){case"value":eo(this._delegate,c,h,{onlyOnce:!0});break;case"child_added":no(this._delegate,c,h,{onlyOnce:!0});break;case"child_removed":oo(this._delegate,c,h,{onlyOnce:!0});break;case"child_changed":ro(this._delegate,c,h,{onlyOnce:!0});break;case"child_moved":io(this._delegate,c,h,{onlyOnce:!0});break;default:throw new Error((0,o.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return u.promise},t.prototype.limitToFirst=function(e){return(0,o.Dv)("Query.limitToFirst",1,1,arguments.length),new t(this.database,wo(this._delegate,function(t){if("number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new fo(t)}(e)))},t.prototype.limitToLast=function(e){return(0,o.Dv)("Query.limitToLast",1,1,arguments.length),new t(this.database,wo(this._delegate,function(t){if("number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new po(t)}(e)))},t.prototype.orderByChild=function(e){return(0,o.Dv)("Query.orderByChild",1,1,arguments.length),new t(this.database,wo(this._delegate,function(t){if("$key"===t)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===t)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===t)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return ti("orderByChild","path",t,!1),new yo(t)}(e)))},t.prototype.orderByKey=function(){return(0,o.Dv)("Query.orderByKey",0,0,arguments.length),new t(this.database,wo(this._delegate,new vo))},t.prototype.orderByPriority=function(){return(0,o.Dv)("Query.orderByPriority",0,0,arguments.length),new t(this.database,wo(this._delegate,new go))},t.prototype.orderByValue=function(){return(0,o.Dv)("Query.orderByValue",0,0,arguments.length),new t(this.database,wo(this._delegate,new mo))},t.prototype.startAt=function(e,n){return void 0===e&&(e=null),(0,o.Dv)("Query.startAt",0,2,arguments.length),new t(this.database,wo(this._delegate,function(t,e){return void 0===t&&(t=null),Xr("startAt","key",e,!0),new ho(t,e)}(e,n)))},t.prototype.startAfter=function(e,n){return void 0===e&&(e=null),(0,o.Dv)("Query.startAfter",0,2,arguments.length),new t(this.database,wo(this._delegate,function(t,e){return Xr("startAfter","key",e,!0),new lo(t,e)}(e,n)))},t.prototype.endAt=function(e,n){return void 0===e&&(e=null),(0,o.Dv)("Query.endAt",0,2,arguments.length),new t(this.database,wo(this._delegate,function(t,e){return Xr("endAt","key",e,!0),new uo(t,e)}(e,n)))},t.prototype.endBefore=function(e,n){return void 0===e&&(e=null),(0,o.Dv)("Query.endBefore",0,2,arguments.length),new t(this.database,wo(this._delegate,function(t,e){return Xr("endBefore","key",e,!0),new co(t,e)}(e,n)))},t.prototype.equalTo=function(e,n){return(0,o.Dv)("Query.equalTo",1,2,arguments.length),new t(this.database,wo(this._delegate,function(t,e){return Xr("equalTo","key",e,!0),new _o(t,e)}(e,n)))},t.prototype.toString=function(){return(0,o.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()},t.prototype.toJSON=function(){return(0,o.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},t.prototype.isEqual=function(e){if((0,o.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof t))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:void 0,context:void 0};if(e&&n)r.cancel=e,(0,o.Wj)(t,"cancel",r.cancel,!0),r.context=n,(0,o.lb)(t,"context",r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error((0,o.gK)(t,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return new Ao(this.database,new zi(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),t}(),Ao=function(t){function e(e,n){var r=t.call(this,e,new Gi(n._repo,n._path,new Pe,!1))||this;return r.database=e,r._delegate=n,r}return(0,s.ZT)(e,t),e.prototype.getKey=function(){return(0,o.Dv)("Reference.key",0,0,arguments.length),this._delegate.key},e.prototype.child=function(t){return(0,o.Dv)("Reference.child",1,1,arguments.length),"number"==typeof t&&(t=String(t)),new e(this.database,Yi(this._delegate,t))},e.prototype.getParent=function(){(0,o.Dv)("Reference.parent",0,0,arguments.length);var t=this._delegate.parent;return t?new e(this.database,t):null},e.prototype.getRoot=function(){return(0,o.Dv)("Reference.root",0,0,arguments.length),new e(this.database,this._delegate.root)},e.prototype.set=function(t,e){(0,o.Dv)("Reference.set",1,2,arguments.length),(0,o.Wj)("Reference.set","onComplete",e,!0);var n=Zi(this._delegate,t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},e.prototype.update=function(t,e){if((0,o.Dv)("Reference.update",1,2,arguments.length),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,N("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}ni("Reference.update",this._delegate._path),(0,o.Wj)("Reference.update","onComplete",e,!0);var i=function(t,e){Yr("update",e,t._path,!1);var n=new o.BH;return function(t,e,n,r){Ci(t,"update",{path:e.toString(),value:n});var i=!0,s=yi(t),a={};if(F(n,function(n,r){i=!1,a[n]=xr(Nt(e,n),ye(r),t.serverSyncTree_,s)}),i)I("update() called with empty data.  Don't do anything."),Si(0,r,"ok",void 0);else{var u=_i(t),c=function(t,e,n,r){!function(t,e,n,r){(0,o.hu)(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=dn(t.visibleWrites,e,n),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r);var i=hn.fromObject(n);return pr(t,new Xe({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,i))}(t.serverSyncTree_,e,a,u);si(t.eventQueue_,c),t.server_.merge(e.toString(),n,function(n,i){var o="ok"===n;o||N("update at "+e+" failed: "+n);var s=cr(t.serverSyncTree_,u,!o),a=s.length>0?Di(t,e):e;ui(t.eventQueue_,a,s),Si(0,r,n,i)}),F(n,function(n){var r=Oi(t,Nt(e,n));Di(t,r)}),ui(t.eventQueue_,e,[])}}(t._repo,t._path,e,n.wrapCallback(function(){})),n.promise}(this._delegate,t);return e&&i.then(function(){return e(null)},function(t){return e(t)}),i},e.prototype.setWithPriority=function(t,e,n){(0,o.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,o.Wj)("Reference.setWithPriority","onComplete",n,!0);var r=function(t,e,n){if(ni("setWithPriority",t._path),Hr("setWithPriority",e,t._path,!1),Zr("setWithPriority",n,!1),".length"===t.key||".keys"===t.key)throw"setWithPriority failed: "+t.key+" is a read-only object.";var r=new o.BH;return wi(t._repo,t._path,e,n,r.wrapCallback(function(){})),r.promise}(this._delegate,t,e);return n&&r.then(function(){return n(null)},function(t){return n(t)}),r},e.prototype.remove=function(t){(0,o.Dv)("Reference.remove",0,1,arguments.length),(0,o.Wj)("Reference.remove","onComplete",t,!0);var e=function(t){return ni("remove",t._path),Zi(t,null)}(this._delegate);return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},e.prototype.transaction=function(t,e,n){var r=this;(0,o.Dv)("Reference.transaction",1,3,arguments.length),(0,o.Wj)("Reference.transaction","transactionUpdate",t,!1),(0,o.Wj)("Reference.transaction","onComplete",e,!0),ii("Reference.transaction","applyLocally",n,!0);var i=function(t,e,n){var r;if(t=(0,o.m9)(t),ni("Reference.transaction",t._path),".length"===t.key||".keys"===t.key)throw"Reference.transaction failed: "+t.key+" is a read-only object.";var i=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,s=new o.BH,a=eo(t,function(){});return function(e,n,r,i,a,u){Ci(e,"transaction on "+n);var c={path:n,update:r,onComplete:function(e,n,r){var i=null;e?s.reject(e):(i=new Qi(r,new zi(t._repo,t._path),se),s.resolve(new No(n,i)))},status:null,order:g(),applyLocally:u,retryCount:0,unwatcher:a,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=Ni(e,n,void 0);c.currentInputSnapshot=h;var l=c.update(h.val());if(void 0===l)c.unwatcher(),c.currentOutputSnapshotRaw=null,c.currentOutputSnapshotResolved=null,c.onComplete&&c.onComplete(null,!1,c.currentInputSnapshot);else{Jr("transaction failed: Data returned ",l,c.path),c.status=0;var f=Or(e.transactionQueueTree_,n),d=Lr(f)||[];d.push(c),Fr(f,d);var p=void 0;"object"==typeof l&&null!==l&&(0,o.r3)(l,".priority")?(p=(0,o.DV)(l,".priority"),(0,o.hu)(Qr(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(dr(e.serverSyncTree_,n)||fe.EMPTY_NODE).getPriority().val();var y=yi(e),v=ye(l,p),m=Pr(v,h,y);c.currentOutputSnapshotRaw=v,c.currentOutputSnapshotResolved=m,c.currentWriteId=_i(e);var _=ur(e.serverSyncTree_,n,m,c.currentWriteId,c.applyLocally);ui(e.eventQueue_,n,_),ki(e,e.transactionQueueTree_)}}(t._repo,t._path,e,0,a,i),s.promise}(this._delegate,t,{applyLocally:n}).then(function(t){return new Do(t.committed,new xo(r.database,t.snapshot))});return e&&i.then(function(t){return e(null,t.committed,t.snapshot)},function(t){return e(t,!1,null)}),i},e.prototype.setPriority=function(t,e){(0,o.Dv)("Reference.setPriority",1,2,arguments.length),(0,o.Wj)("Reference.setPriority","onComplete",e,!0);var n=function(t,e){t=(0,o.m9)(t),ni("setPriority",t._path),Zr("setPriority",e,!1);var n=new o.BH;return wi(t._repo,Nt(t._path,".priority"),e,null,n.wrapCallback(function(){})),n.promise}(this._delegate,t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},e.prototype.push=function(t,n){var r=this;(0,o.Dv)("Reference.push",0,2,arguments.length),(0,o.Wj)("Reference.push","onComplete",n,!0);var i=function(t,e){t=(0,o.m9)(t),ni("push",t._path),Hr("push",e,t._path,!0);var n,r=pi(t._repo),i=be(r),s=Yi(t,i),a=Yi(t,i);return n=null!=e?Zi(a,e).then(function(){return a}):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),s}(this._delegate,t),s=i.then(function(t){return new e(r.database,t)});n&&s.then(function(){return n(null)},function(t){return n(t)});var a=new e(this.database,i);return a.then=s.then.bind(s),a.catch=s.catch.bind(s,void 0),a},e.prototype.onDisconnect=function(){return ni("Reference.onDisconnect",this._delegate._path),new ko(new ji(this._delegate._repo,this._delegate._path))},Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Po),Ro=function(){function t(t,e){var n=this;this._delegate=t,this.app=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={}),(t=(0,o.m9)(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&S("Cannot call useEmulator() after instance has already been initialized.");var i=t._repoInternal,s=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&S('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new z(z.OWNER);else if(r.mockUserToken){var a=(0,o.Sg)(r.mockUserToken,t.app.options.projectId);s=new z(a)}!function(t,e,n,r){t.repoInfo_=new Z(e+":"+n,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams),r&&(t.authTokenProvider_=r)}(i,e,n,s)}(this._delegate,t,e,n)},t.prototype.ref=function(t){if((0,o.Dv)("database.ref",0,1,arguments.length),t instanceof Ao){var e=Ji(this._delegate,t.toString());return new Ao(this,e)}return e=Hi(this._delegate,t),new Ao(this,e)},t.prototype.refFromURL=function(t){(0,o.Dv)("database.refFromURL",1,1,arguments.length);var e=Ji(this._delegate,t);return new Ao(this,e)},t.prototype.goOffline=function(){return(0,o.Dv)("database.goOffline",0,0,arguments.length),(t=(0,o.m9)(t=this._delegate))._checkNotDeleted("goOffline"),void Ei(t._repo);var t},t.prototype.goOnline=function(){return(0,o.Dv)("database.goOnline",0,0,arguments.length),(t=(0,o.m9)(t=this._delegate))._checkNotDeleted("goOnline"),void((e=t._repo).persistentConnection_&&e.persistentConnection_.resume(li));var t,e},t.ServerValue={TIMESTAMP:So,increment:function(t){return function(t){return{".sv":{increment:t}}}(t)}},t}(),Oo=Object.freeze({__proto__:null,forceLongPolling:function(){lt.forceDisallow(),ut.forceAllow()},forceWebSockets:function(){ut.forceDisallow()},isWebSocketsAvailable:function(){return lt.isAvailable()},setSecurityDebugCallback:function(t,e){t._delegate._repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){!function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var n;e?(t.statsListener_||(t.statsListener_=new Be(t.stats_)),n=t.statsListener_.get()):n=t.stats_.get();var r=Object.keys(n).reduce(function(t,e){return Math.max(e.length,t)},0);F(n,function(t,e){for(var n=t,i=t.length;i<r+2;i++)n+=" ";console.log(n+e)})}}(t._delegate._repo,e)},statsIncrementCounter:function(t,e){!function(t,e){t.stats_.incrementCounter(e),t.statsReporter_.statsToReport_[e]=!0}(t._delegate._repo,e)},dataUpdateCount:function(t){return t._delegate._repo.dataUpdateCount},interceptServerData:function(t,e){return function(t,e){t.interceptServerDataCallback_=e}(t._delegate._repo,e)},initStandalone:function(t){var e=t.app,n=t.url,r=t.customAuthImpl,o=t.namespace,s=t.nodeAdmin,a=void 0!==s&&s;c(t.version);var u=new i.zt("auth-internal",new i.H0("database-standalone"));return u.setComponent(new i.wA("auth-internal",function(){return r},"PRIVATE")),{instance:new Ro(Eo(e,u,void 0,n,a),e),namespace:o}}}),Lo=jt;jt.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},jt.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var Fo=Object.freeze({__proto__:null,DataConnection:Lo,RealTimeConnection:dt,hijackHash:function(t){var e=jt.prototype.put;return jt.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){jt.prototype.put=e}},ConnectionTarget:Z,queryIdentifier:function(t){return t._delegate._queryIdentifier},forceRestClient:function(t){!function(t){Io=t}(t)}}),Mo=Ro.ServerValue;!function(e){c(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new i.wA("database",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new Ro(Eo(r,i,o,n),r)},"PUBLIC").setServiceProps({Reference:Ao,Query:Po,Database:Ro,DataSnapshot:xo,enableLogging:T,INTERNAL:Oo,ServerValue:Mo,TEST_ACCESS:Fo}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.10.8"),(0,o.Yr)()&&(t.exports=n)}(r.Z)},9328:(t,e,n)=>{"use strict";n.d(e,{G:()=>i});var r=n(7393);function i(){return t=>t.lift(new o)}class o{call(t,e){return e.subscribe(new s(t))}}class s extends r.L{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}},2482:(t,e,n)=>{"use strict";n.d(e,{h:()=>G});var r=n(4762),i=n(8002),o=n(8583),s=n(7716),a=n(3637),u=n(8891),c=n(5917),h=n(6682),l=n(8819),f=n(3190),d=n(2145),p=n(7519),y=n(5197),v=n(509);class g{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new m(t,this.observables,this.project))}}class m extends y.L{constructor(t,e,n){super(t),this.observables=e,this.project=n,this.toRespond=[];const r=e.length;this.values=new Array(r);for(let i=0;i<r;i++)this.toRespond.push(i);for(let i=0;i<r;i++)this.add((0,v.D)(this,e[i],void 0,i))}notifyNext(t,e,n){this.values[n]=e;const r=this.toRespond;if(r.length>0){const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}var _=n(7393);class w{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new b(t,this.predicate))}}class b extends _.L{constructor(t,e){super(t),this.predicate=e,this.skipping=!0,this.index=0}_next(t){const e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)}tryCallPredicate(t){try{const e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(e){this.destination.error(e)}}}var T=n(57),I=(n(9192),n(9829)),E=n(2329);function C(t){return null==t}function S(t){return"function"==typeof t.set}function N(t,e){return S(e)?e:t.ref(e)}function k(t,e){if("string"==typeof t)return e.stringCase();if(S(t))return e.firebaseCase();if("function"==typeof t.exportVal)return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof t)}function D(t,e,n="on",r=a.z){return new u.y(i=>{let o=null;return o=t[n](e,(t,e)=>{r.schedule(()=>{i.next({snapshot:t,prevKey:e})}),"once"===n&&r.schedule(()=>i.complete())},t=>{r.schedule(()=>i.error(t))}),"on"===n?{unsubscribe(){null!=o&&t.off(e,o)}}:{unsubscribe(){}}}).pipe((0,i.U)(t=>{const{snapshot:n,prevKey:r}=t;let i=null;return n.exists()&&(i=n.key),{type:e,payload:n,prevKey:r,key:i}}),(0,l.B)())}function x(t,e){const n=t.length;for(let r=0;r<n;r++)if(t[r].payload.key===e)return r;return-1}function P(t,e){const{payload:n,prevKey:r,key:i}=e,o=x(t,i),s=function(t,e){if(C(e))return 0;{const n=x(t,e);return-1===n?t.length:n+1}}(t,r);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let n=null;e.payload.forEach(e=>{const r={payload:e,type:"value",prevKey:n,key:e.key};return n=e.key,t=[...t,r],!1})}return t;case"child_added":if(o>-1){const i=t[o-1];(i&&i.key||null)!==r&&(t=t.filter(t=>t.payload.key!==n.key)).splice(s,0,e)}else{if(null==r)return[e,...t];(t=t.slice()).splice(s,0,e)}return t;case"child_removed":return t.filter(t=>t.payload.key!==n.key);case"child_changed":return t.map(t=>t.payload.key===i?e:t);case"child_moved":if(o>-1){const e=t.splice(o,1)[0];return(t=t.slice()).splice(s,0,e),t}return t;default:return t}}function A(t){return(C(t)||0===t.length)&&(t=["child_added","child_removed","child_changed","child_moved"]),t}function R(t,e,n){return function(t,e,n){return D(t,"value","once",n).pipe((0,f.w)(r=>{const i=[(0,c.of)(r)];return e.forEach(e=>i.push(D(t,e,"on",n))),(0,h.T)(...i).pipe((0,d.R)(P,[]))}),(0,p.x)())}(t,e=A(e),n)}function O(t,e,n){const r=(e=A(e)).map(e=>D(t,e,"on",n));return(0,h.T)(...r)}function L(t,e){return function(n,r){return k(n,{stringCase:()=>t.child(n)[e](r),firebaseCase:()=>n[e](r),snapshotCase:()=>n.ref[e](r)})}}function F(t,e){return function(){return D(t,"value","on",e)}}const M=new s.OlP("angularfire2.realtimeDatabaseURL"),q=new s.OlP("angularfire2.database.use-emulator");let U=(()=>{class t{constructor(t,e,n,r,i,o,s){this.schedulers=new T.HU(i),this.keepUnstableUntilFirst=(0,T.ss)(this.schedulers);const a=o,u=(0,T.on)(t,i,e);!E.Z.auth&&s&&(0,T.yq)(),this.database=(0,T.sI)(`${u.name}.database.${n}`,"AngularFireDatabase",u,()=>{const t=i.runOutsideAngular(()=>u.database(n||void 0));return a&&t.useEmulator(...a),t},[a])}list(t,e){const n=this.schedulers.ngZone.runOutsideAngular(()=>N(this.database,t));let r=n;return e&&(r=e(n)),function(t,e){const n=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>t.ref);return{query:t,update:L(r,"update"),set:L(r,"set"),push:t=>r.push(t),remove:(o=r,function(t){return t?k(t,{stringCase:()=>o.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):o.remove()}),snapshotChanges:r=>R(t,r,n).pipe(e.keepUnstableUntilFirst),stateChanges:r=>O(t,r,n).pipe(e.keepUnstableUntilFirst),auditTrail:r=>function(t,e,n){return function(t,e,n){const r=function(t,e){return D(t,"value","on",e).pipe((0,i.U)(t=>{let e;return t.payload.forEach(t=>(e=t.key,!1)),{data:t,lastKeyToLoad:e}}))}(t,n);return r.pipe(function(...t){return e=>{let n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new g(t,n))}}(e),(0,i.U)(([t,e])=>{const n=t.lastKeyToLoad,r=e.map(t=>t.key);return{actions:e,lastKeyToLoad:n,loadedKeys:r}}),(o=t=>-1===t.loadedKeys.indexOf(t.lastKeyToLoad),t=>t.lift(new w(o))),(0,i.U)(t=>t.actions));var o}(t,O(t,e).pipe((0,d.R)((t,e)=>[...t,e],[])),n)}(t,r,n).pipe(e.keepUnstableUntilFirst),valueChanges:(r,o)=>R(t,r,n).pipe((0,i.U)(t=>t.map(t=>o&&o.idField?Object.assign(Object.assign({},t.payload.val()),{[o.idField]:t.key}):t.payload.val())),e.keepUnstableUntilFirst)};var o}(r,this)}object(t){const e=this.schedulers.ngZone.runOutsideAngular(()=>N(this.database,t));return r=this,{query:n=e,snapshotChanges:()=>F(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>F(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst,(0,i.U)(t=>t.payload.exists()?t.payload.val():null))};var n,r}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(T.Dh),s.LFG(T.xv,8),s.LFG(M,8),s.LFG(s.Lbi),s.LFG(s.R0b),s.LFG(q,8),s.LFG(I.Qv,8))},t.\u0275prov=s.Yz7({factory:function(){return new t(s.LFG(T.Dh),s.LFG(T.xv,8),s.LFG(M,8),s.LFG(s.Lbi),s.LFG(s.R0b),s.LFG(q,8),s.LFG(I.Qv,8))},token:t,providedIn:"any"}),t})();var V=n(9493),j=n(3946);let G=(()=>{class t{constructor(t,e,n,r){this.db=t,this.router=e,this.firebaseAuth=n,this.afs=r,this.isLoggedIn=!1,this.userId="",this.item$=r.collection("user").valueChanges(),this.user=this.afs.collection("user"),this.users=this.user.snapshotChanges().pipe((0,i.U)(t=>t.map(t=>{const e=t.payload.doc.data();return Object.assign({id:t.payload.doc.id},e)}))),this.ideaCollection=this.afs.collection("ideas"),this.ideas=this.ideaCollection.snapshotChanges().pipe((0,i.U)(t=>t.map(t=>{const e=t.payload.doc.data();return Object.assign({id:t.payload.doc.id},e)})))}getIdeas(){return this.ideas}getUsers(){return this.users}getIdea(t){return this.ideaCollection.doc(t).valueChanges()}getIdeasArhive(t){return this.afs.collection("ideas",e=>e.where("user","==",t)).valueChanges()}getUser(t){return this.afs.collection("users/").doc(t).valueChanges()}getUsersNew(){return this.afs.collection("users")}getIventsNew(){return this.afs.collection("ideas")}getCategoryIventsNew(){return this.afs.collection("category_events")}getUserUid(){this.firebaseAuth.onAuthStateChanged(t=>{console.log(t.uid),this.getUser(t.uid).subscribe(t=>{console.log(t.email)})})}getUserEmail(){this.firebaseAuth.onAuthStateChanged(t=>{this.getUser(t.uid).subscribe(t=>{console.log(t.email)})})}addIdea(t){return this.ideaCollection.add(t)}updateIdea(t){return this.ideaCollection.doc(t.id).update({name:t.name,notes:t.notes})}deleteIdea(t){return this.ideaCollection.doc(t).delete()}registration(t){return this.user.add(t)}sendGeo(t,e){return this.afs.collection("users/").doc("9zq8NcgOQ2ZBuH1F2gtm6af3frD3").update({lat:t,lng:e})}signin(t,e){return(0,r.mG)(this,void 0,void 0,function*(){return this.firebaseAuth.signInWithEmailAndPassword(t,e).then(t=>{this.isLoggedIn=!0,console.log("\u0433\u0443\u0434")}).catch(t=>{let e=this.VerifyErroCode(t.code);return null==e&&(e=t.message),console.log(e),e})})}VerifyErroCode(t){return"auth/wrong-password"===t?"\u041d\u0435 \u0432\u0435\u0440\u043d\u044b\u0439  \u043f\u0430\u0440\u043e\u043b\u044c, \u043f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043d\u043e\u0432\u0430.":null}logout(){document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",this.router.navigateByUrl("/log-in")}getDateTime(){return(0,o.p6)(Date.now(),"yyyy-MM-dd HH-mm-ss","en-US")}getTestData(){return[{id:"93W1rfKLTDw3GM6VJeK6",login:"login",team:["nlvdjyVWN4NAv0VNBifBkyneDsU2","GaF6xHzsPWNTGbNAv52MdYRar283"],coordinates:[37.61778,55.75583],name:"\u0412\u043b\u0430\u0434",address:"\u043c\u043e\u0441\u043a\u0432\u0430",notes:"\u041f\u043e\u0443\u0436\u0438\u043d\u0430\u0442\u044c \u0432 \u0440\u0435\u0441\u0442\u043e\u0440\u0430\u043d\u0435 \u0432\u0435\u0447\u0435\u0440\u043e\u043c",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",DateTime:"2021-12-31T18:17:04.030+02:00",category:"\u041f\u043e\u0433\u0443\u043b\u044f\u0442\u044c/\u043f\u0435\u0440\u0435\u043a\u0443\u0441\u0438\u0442\u044c",user:"lagunovvlad1@gmail.com",image:"5.jpeg"},{id:"ODyHNnNPONOHN4Ryv1Tc",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",login:"login",name:"\u0412\u043b\u0430\u0434",DateTime:"2022-01-16T17:23:09.132+03:00",user:"lagunovvlad1@gmail.com",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],address:"\u041a\u0438\u0435\u0432",category:"\u041f\u043e\u0433\u0443\u043b\u044f\u0442\u044c",notes:"\u041f\u043e\u0433\u0443\u043b\u044f\u0442\u044c \u0432 \u043f\u0430\u0440\u043a\u0435, \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u044b\u0435 \u0434\u043d\u0438, \u043c\u043e\u0436\u043d\u043e \u0441\u0445\u043e\u0434\u0438\u0442\u044c \u043f\u043e\u043a\u0443\u0448\u0430\u0442\u044c \u043c\u043e\u0440\u043e\u0436\u0435\u043d\u043d\u043e\u0435 \u0438 \u0437\u0430\u0439\u0442\u0438 \u0432 \u043a\u0430\u043a\u043e\u0439 \u0442\u043e \u043c\u0443\u0437\u0435\u0439",coordinates:[37.88,45.04],image:"5pe5.jpeg"},{id:"eiJqlABC0Z3aItjS14ON",login:"login",notes:"\u0425\u043e\u0447\u0443 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043d\u0438\u043c\u0430\u0442\u044c\u0441\u044f \u0419\u043e\u0433\u043e\u0439",coordinates:[37.61778,55.75583],name:"\u0412\u043b\u0430\u0434",address:"\u043c\u043e\u0441\u043a\u0432\u0430 \u043c\u0435\u0442\u0440\u043e \u0446\u0441\u043a\u0430",DateTime:"2022-01-16T18:21:49.562+03:00",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],category:"\u0421\u043f\u043e\u0440\u0442",user:"lagunovvlad1@gmail.com",image:"727424ee87d534220ac1.jpeg"},{id:"fvNrHRrJU8G6u9pqS4Tl",notes:"\u041f\u043e\u0439\u0434\u0435\u043c\u0442\u0435 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043a\u0430\u043a\u043e\u0439 \u0442\u043e \u043d\u043e\u0432\u044b\u0439 \u0444\u0438\u043b\u044c\u043c \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0435\u0439\u0447\u0430\u0441 \u0432 \u043a\u0438\u043d\u043e \u0438\u0434\u0435\u0442",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],category:"\u041a\u0438\u043d\u043e",coordinates:[37.61778,55.75583],name:"\u0412\u043b\u0430\u0434",address:"\u041c\u043e\u0441\u043a\u0432\u0430 \u043a\u0438\u0440\u043e\u0432\u043e\u0433\u0440\u0430\u0434\u0441\u043a\u0430\u044f \u0443\u043b\u0438\u0446\u0430 24 \u043a\u043e\u0440\u043f\u0443\u0441 2 ",login:"login",user:"lagunovvlad1@gmail.com",DateTime:"2022-01-20T16:20:44.700+03:00",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",image:"20181227modely-06.jpeg"},{id:"xoo50eB0Mmlma2EaKrLL",category:"\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0434\u044b\u0445",login:"\u041c\u043e\u0436\u043d\u043e \u0430\u0440\u0435\u043d\u0434\u043e\u0432\u0430\u0442\u044c \u0431\u0430\u0439\u0434\u0430\u0440\u043a\u0443 \u0438 \u043f\u043e\u043a\u0430\u0442\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u0435\u0439",team:[],user:"vvll@gmail.com",DateTime:"2022-01-08T23:29:05.684+02:00",uid:"nlvdjyVWN4NAv0VNBifBkyneDsU2",notes:"dsadas",name:"Kolua",address:"\u041a\u0438\u0435\u0432",coordinates:[37.88,45.04],image:"67477036_19116253623.jpeg"}]}getTestGeo(){return{type:"FeatureCollection",features:[{type:"Feature",properties:{id:"eiJqlABC0Z3aItjS14ON",login:"login",notes:"\u0425\u043e\u0447\u0443 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043d\u0438\u043c\u0430\u0442\u044c\u0441\u044f \u0419\u043e\u0433\u043e\u0439",name:"\u0412\u043b\u0430\u0434",address:"\u043c\u043e\u0441\u043a\u0432\u0430 \u043c\u0435\u0442\u0440\u043e \u0446\u0441\u043a\u0430",DateTime:"2022-01-16T18:21:49.562+03:00",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],category:"\u0421\u043f\u043e\u0440\u0442",user:"lagunovvlad1@gmail.com",image:"727424ee87d534220ac1.jpeg"},geometry:{type:"Point",coordinates:[21.0042,52.2298,69.65]}},{type:"Feature",properties:{id:"ODyHNnNPONOHN4Ryv1Tc",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",login:"login",name:"\u0412\u043b\u0430\u0434",DateTime:"2022-01-16T17:23:09.132+03:00",user:"lagunovvlad1@gmail.com",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],address:"\u041a\u0438\u0435\u0432",category:"\u041f\u043e\u0433\u0443\u043b\u044f\u0442\u044c",notes:"\u041f\u043e\u0433\u0443\u043b\u044f\u0442\u044c \u0432 \u043f\u0430\u0440\u043a\u0435, \u043f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u044b\u0435 \u0434\u043d\u0438, \u043c\u043e\u0436\u043d\u043e \u0441\u0445\u043e\u0434\u0438\u0442\u044c \u043f\u043e\u043a\u0443\u0448\u0430\u0442\u044c \u043c\u043e\u0440\u043e\u0436\u0435\u043d\u043d\u043e\u0435 \u0438 \u0437\u0430\u0439\u0442\u0438 \u0432 \u043a\u0430\u043a\u043e\u0439 \u0442\u043e \u043c\u0443\u0437\u0435\u0439",image:"5pe5.jpeg"},geometry:{type:"Point",coordinates:[37.88,45.04,69.65]}},{type:"Feature",properties:{id:"eiJqlABC0Z3aItjS14ON",login:"login",notes:"\u0425\u043e\u0447\u0443 \u043d\u0430\u0447\u0430\u0442\u044c \u0437\u0430\u043d\u0438\u043c\u0430\u0442\u044c\u0441\u044f \u0419\u043e\u0433\u043e\u0439",name:"\u0412\u043b\u0430\u0434",address:"\u043c\u043e\u0441\u043a\u0432\u0430 \u043c\u0435\u0442\u0440\u043e \u0446\u0441\u043a\u0430",DateTime:"2022-01-16T18:21:49.562+03:00",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],category:"\u0421\u043f\u043e\u0440\u0442",user:"lagunovvlad1@gmail.com",image:"727424ee87d534220ac1.jpeg"},geometry:{type:"Point",coordinates:[37.61778,55.75583,69.65]}},{type:"Feature",properties:{id:"fvNrHRrJU8G6u9pqS4Tl",notes:"\u041f\u043e\u0439\u0434\u0435\u043c\u0442\u0435 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043a\u0430\u043a\u043e\u0439 \u0442\u043e \u043d\u043e\u0432\u044b\u0439 \u0444\u0438\u043b\u044c\u043c \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0441\u0435\u0439\u0447\u0430\u0441 \u0432 \u043a\u0438\u043d\u043e \u0438\u0434\u0435\u0442",team:["GaF6xHzsPWNTGbNAv52MdYRar283"],category:"\u041a\u0438\u043d\u043e",name:"\u0412\u043b\u0430\u0434",address:"\u041c\u043e\u0441\u043a\u0432\u0430 \u043a\u0438\u0440\u043e\u0432\u043e\u0433\u0440\u0430\u0434\u0441\u043a\u0430\u044f \u0443\u043b\u0438\u0446\u0430 24 \u043a\u043e\u0440\u043f\u0443\u0441 2 ",login:"login",user:"lagunovvlad1@gmail.com",DateTime:"2022-01-20T16:20:44.700+03:00",uid:"GaF6xHzsPWNTGbNAv52MdYRar283",image:"20181227modely-06.jpeg"},geometry:{type:"Point",coordinates:[37.31778,55.35583,69.65]}},{type:"Feature",properties:{id:"xoo50eB0Mmlma2EaKrLL",category:"\u0410\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0434\u044b\u0445",login:"\u041c\u043e\u0436\u043d\u043e \u0430\u0440\u0435\u043d\u0434\u043e\u0432\u0430\u0442\u044c \u0431\u0430\u0439\u0434\u0430\u0440\u043a\u0443 \u0438 \u043f\u043e\u043a\u0430\u0442\u0430\u0442\u044c\u0441\u044f \u043d\u0430 \u043d\u0435\u0439",team:[],user:"vvll@gmail.com",DateTime:"2022-01-08T23:29:05.684+02:00",uid:"nlvdjyVWN4NAv0VNBifBkyneDsU2",notes:"dsadas",name:"Kolua",address:"\u041a\u0438\u0435\u0432",image:"67477036_19116253623.jpeg"},geometry:{type:"Point",coordinates:[37.88,45.04,69.65]}}]}}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(U),s.LFG(V.F0),s.LFG(I.zQ),s.LFG(j.ST))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);